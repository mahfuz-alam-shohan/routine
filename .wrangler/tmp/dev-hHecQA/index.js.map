{
  "version": 3,
  "sources": ["../bundle-h83UVb/checked-fetch.js", "wrangler-modules-watch:wrangler:modules-watch", "../../../../../../../../AppData/Roaming/npm/node_modules/wrangler/templates/modules-watch-stub.js", "../../../src/ui/public/home.js", "../../../src/ui/public/login.js", "../bundle-h83UVb/middleware-loader.entry.ts", "../bundle-h83UVb/middleware-insertion-facade.js", "../../../src/index.js", "../../../src/routers/router_public.js", "../../../src/core/utils.js", "../../../src/ui/public/layout.js", "../../../src/core/auth.js", "../../../src/routers/router_admin.js", "../../../src/ui/admin/setup.js", "../../../src/ui/admin/layout.js", "../../../src/ui/admin/settings.js", "../../../src/ui/admin/schools.js", "../../../src/ui/admin/school_detail.js", "../../../src/ui/admin/school_classes.js", "../../../src/ui/admin/school_teachers.js", "../../../src/config.js", "../../../src/core/schema_manager.js", "../../../src/routers/router_institute.js", "../../../src/ui/institute/layout.js", "../../../src/ui/institute/dashboard.js", "../../../src/ui/institute/teachers.js", "../../../src/ui/institute/classes.js", "../../../src/ui/institute/subjects.js", "../../../src/ui/institute/schedules.js", "../../../src/routers/router_teacher.js", "../../../../../../../../AppData/Roaming/npm/node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts", "../../../../../../../../AppData/Roaming/npm/node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts", "../../../../../../../../AppData/Roaming/npm/node_modules/wrangler/templates/middleware/common.ts"],
  "sourceRoot": "C:\\Users\\mahfu\\OneDrive\\Desktop\\WorkStation\\WebDevelopment\\routine\\.wrangler\\tmp\\dev-hHecQA",
  "sourcesContent": ["const urls = new Set();\n\nfunction checkURL(request, init) {\n\tconst url =\n\t\trequest instanceof URL\n\t\t\t? request\n\t\t\t: new URL(\n\t\t\t\t\t(typeof request === \"string\"\n\t\t\t\t\t\t? new Request(request, init)\n\t\t\t\t\t\t: request\n\t\t\t\t\t).url\n\t\t\t\t);\n\tif (url.port && url.port !== \"443\" && url.protocol === \"https:\") {\n\t\tif (!urls.has(url.toString())) {\n\t\t\turls.add(url.toString());\n\t\t\tconsole.warn(\n\t\t\t\t`WARNING: known issue with \\`fetch()\\` requests to custom HTTPS ports in published Workers:\\n` +\n\t\t\t\t\t` - ${url.toString()} - the custom port will be ignored when the Worker is published using the \\`wrangler deploy\\` command.\\n`\n\t\t\t);\n\t\t}\n\t}\n}\n\nglobalThis.fetch = new Proxy(globalThis.fetch, {\n\tapply(target, thisArg, argArray) {\n\t\tconst [request, init] = argArray;\n\t\tcheckURL(request, init);\n\t\treturn Reflect.apply(target, thisArg, argArray);\n\t},\n});\n", "", "// `esbuild` doesn't support returning `watch*` options from `onStart()`\n// plugin callbacks. Instead, we define an empty virtual module that is\n// imported by this injected file. Importing the module registers watchers.\nimport \"wrangler:modules-watch\";\n", "// src/ui/public/home.js\r\n\r\nexport function HomeHTML(companyName) {\r\n    return `\r\n    <div class=\"animate-fade-in\">\r\n        \r\n        <div class=\"py-24 md:py-32 text-center max-w-5xl mx-auto px-6\">\r\n            <h1 class=\"text-5xl md:text-7xl font-bold tracking-tight text-gray-900 leading-tight mb-8\">\r\n                Smart Scheduling for <br>\r\n                <span class=\"text-blue-600\">Modern Education.</span>\r\n            </h1>\r\n            <p class=\"text-xl text-gray-600 mb-12 leading-relaxed max-w-3xl mx-auto font-light\">\r\n                ${companyName} helps institutions design conflict-free class routines, manage faculty workloads, and organize academic structures efficiently.\r\n            </p>\r\n            <div class=\"flex flex-col sm:flex-row gap-4 justify-center\">\r\n                <a href=\"/login\" class=\"px-10 py-4 text-lg font-bold text-white bg-blue-600 rounded-full hover:bg-blue-700 transition-all shadow-xl shadow-blue-200 hover:-translate-y-1\">\r\n                    Get Started\r\n                </a>\r\n                <a href=\"#features\" class=\"px-10 py-4 text-lg font-bold text-gray-700 bg-white border border-gray-200 rounded-full hover:bg-gray-50 transition-all\">\r\n                    Explore Features\r\n                </a>\r\n            </div>\r\n        </div>\r\n\r\n        <div id=\"features\" class=\"bg-blue-700 text-white py-24 relative overflow-hidden\">\r\n            <div class=\"absolute top-0 right-0 w-[600px] h-[600px] bg-white/5 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2\"></div>\r\n            \r\n            <div class=\"max-w-7xl mx-auto px-6 grid grid-cols-1 md:grid-cols-2 gap-20 items-center relative z-10\">\r\n                <div>\r\n                    <h2 class=\"text-3xl md:text-5xl font-bold mb-6 tracking-tight\">Automated Routine Engine</h2>\r\n                    <p class=\"text-blue-100 text-lg leading-relaxed mb-8 font-light\">\r\n                        Our core algorithm analyzes your teachers, subjects, and classrooms to build the perfect weekly schedule. It handles complex constraints like split shifts and teacher availability automatically.\r\n                    </p>\r\n                    <div class=\"flex gap-4\">\r\n                        <span class=\"px-4 py-2 bg-white/10 rounded-full border border-white/20 text-sm font-medium\">Conflict Detection</span>\r\n                        <span class=\"px-4 py-2 bg-white/10 rounded-full border border-white/20 text-sm font-medium\">Workload Balancing</span>\r\n                    </div>\r\n                </div>\r\n                <div class=\"bg-gradient-to-br from-white/10 to-transparent p-8 rounded-3xl border border-white/10 backdrop-blur-sm\">\r\n                     <div class=\"space-y-4\">\r\n                        <div class=\"h-32 bg-white/5 rounded-xl w-full flex items-center justify-center border border-white/5\">\r\n                            <span class=\"text-white/40 font-bold tracking-widest uppercase text-sm\">Algorithm Visualization</span>\r\n                        </div>\r\n                        <div class=\"flex gap-4\">\r\n                            <div class=\"h-16 bg-white/5 rounded-xl w-1/3\"></div>\r\n                            <div class=\"h-16 bg-white/5 rounded-xl w-2/3\"></div>\r\n                        </div>\r\n                     </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <div class=\"bg-white py-24\">\r\n            <div class=\"max-w-7xl mx-auto px-6\">\r\n                <div class=\"text-center mb-16\">\r\n                    <h2 class=\"text-3xl md:text-4xl font-bold text-gray-900\">Complete Academic Control</h2>\r\n                    <p class=\"text-gray-500 mt-4\">Everything you need to run your institution.</p>\r\n                </div>\r\n\r\n                <div class=\"grid grid-cols-1 md:grid-cols-3 gap-12\">\r\n                    <div class=\"group\">\r\n                        <div class=\"w-14 h-14 bg-blue-50 rounded-2xl flex items-center justify-center text-blue-600 mb-6 group-hover:bg-blue-600 group-hover:text-white transition-colors\">\r\n                            <svg class=\"w-7 h-7\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z\"></path></svg>\r\n                        </div>\r\n                        <h3 class=\"text-xl font-bold text-gray-900 mb-3\">Teacher Management</h3>\r\n                        <p class=\"text-gray-500 leading-relaxed\">Maintain detailed profiles, subjects, and contact info for all your faculty members.</p>\r\n                    </div>\r\n                    \r\n                    <div class=\"group\">\r\n                        <div class=\"w-14 h-14 bg-purple-50 rounded-2xl flex items-center justify-center text-purple-600 mb-6 group-hover:bg-purple-600 group-hover:text-white transition-colors\">\r\n                            <svg class=\"w-7 h-7\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10\"></path></svg>\r\n                        </div>\r\n                        <h3 class=\"text-xl font-bold text-gray-900 mb-3\">Class & Sectioning</h3>\r\n                        <p class=\"text-gray-500 leading-relaxed\">Organize your academic structure with flexible class and section configurations.</p>\r\n                    </div>\r\n\r\n                    <div class=\"group\">\r\n                        <div class=\"w-14 h-14 bg-green-50 rounded-2xl flex items-center justify-center text-green-600 mb-6 group-hover:bg-green-600 group-hover:text-white transition-colors\">\r\n                            <svg class=\"w-7 h-7\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\"></path></svg>\r\n                        </div>\r\n                        <h3 class=\"text-xl font-bold text-gray-900 mb-3\">Export Ready</h3>\r\n                        <p class=\"text-gray-500 leading-relaxed\">Download routines and reports in standard formats suitable for printing.</p>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n    </div>\r\n    `;\r\n}\r\n", "// src/ui/public/login.js\r\n\r\nexport function LOGIN_HTML(companyName) {\r\n    return `\r\n    <div class=\"flex min-h-screen bg-white\">\r\n        \r\n        <div class=\"hidden lg:flex lg:w-1/2 bg-blue-700 relative overflow-hidden items-center justify-center\">\r\n            \r\n            <div class=\"absolute top-0 left-0 w-full h-full overflow-hidden\">\r\n                <div class=\"absolute top-[-10%] left-[-10%] w-96 h-96 bg-blue-500/30 rounded-full mix-blend-overlay filter blur-3xl\"></div>\r\n                <div class=\"absolute bottom-[-10%] right-[-10%] w-[500px] h-[500px] bg-indigo-500/30 rounded-full mix-blend-overlay filter blur-3xl\"></div>\r\n                <div class=\"absolute top-[20%] right-[20%] w-32 h-32 bg-white/10 rounded-full mix-blend-overlay filter blur-2xl\"></div>\r\n            </div>\r\n            \r\n            <div class=\"relative z-10 p-12 text-white max-w-lg\">\r\n                <div class=\"mb-6 inline-block p-3 bg-white/10 backdrop-blur-md rounded-lg border border-white/20\">\r\n                    <svg class=\"w-8 h-8 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253\"></path></svg>\r\n                </div>\r\n                <h2 class=\"text-4xl font-bold mb-4 tracking-tight\">Academic Management Simplified.</h2>\r\n                <p class=\"text-blue-100 text-lg leading-relaxed\">\r\n                    Access your institution's dashboard to manage routines, teachers, and classes efficiently.\r\n                </p>\r\n            </div>\r\n        </div>\r\n\r\n        <div class=\"w-full lg:w-1/2 flex items-start pt-12 lg:pt-0 lg:items-center justify-center p-4\">\r\n            \r\n            <div class=\"w-full max-w-md bg-white border border-gray-200 shadow-2xl rounded-xl p-6 sm:p-10 relative z-10\">\r\n                \r\n                <div class=\"text-center mb-8\">\r\n                    <h1 class=\"text-2xl font-bold text-gray-900 tracking-tight\">Sign In</h1>\r\n                    <p class=\"mt-2 text-sm text-gray-500\">Welcome back to ${companyName}</p>\r\n                </div>\r\n\r\n                <form class=\"space-y-6\" id=\"loginForm\" onsubmit=\"handleLogin(event)\">\r\n                    \r\n                    <div class=\"space-y-5\">\r\n                        <div>\r\n                            <label for=\"email\" class=\"block text-xs font-bold text-gray-700 uppercase mb-1.5\">Email Address</label>\r\n                            <input id=\"email\" name=\"email\" type=\"email\" required \r\n                                class=\"appearance-none block w-full px-4 py-3 bg-white border border-gray-300 text-gray-900 rounded-lg text-base focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-transparent transition-all\" \r\n                                placeholder=\"admin@school.edu\">\r\n                        </div>\r\n\r\n                        <div>\r\n                            <label for=\"password\" class=\"block text-xs font-bold text-gray-700 uppercase mb-1.5\">Password</label>\r\n                            <div class=\"relative\">\r\n                                <input id=\"password\" name=\"password\" type=\"password\" required \r\n                                    class=\"appearance-none block w-full px-4 py-3 bg-white border border-gray-300 text-gray-900 rounded-lg text-base focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-transparent transition-all pr-12\" \r\n                                    placeholder=\"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\">\r\n                                \r\n                                <button type=\"button\" onclick=\"togglePassword()\" \r\n                                        class=\"absolute inset-y-0 right-0 px-3 flex items-center text-gray-400 hover:text-gray-600 focus:outline-none cursor-pointer\">\r\n                                    <svg id=\"eye-icon\" class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                        <path class=\"eye-open\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\" />\r\n                                        <path class=\"eye-open\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z\" />\r\n                                        <path class=\"eye-closed hidden\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21\" />\r\n                                    </svg>\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div class=\"flex items-center justify-between mt-2\">\r\n                        <label class=\"flex items-center cursor-pointer select-none\">\r\n                            <input id=\"remember-me\" name=\"remember-me\" type=\"checkbox\" class=\"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\">\r\n                            <span class=\"ml-2 text-sm text-gray-600\">Remember me</span>\r\n                        </label>\r\n                        <a href=\"#\" class=\"text-sm font-bold text-blue-600 hover:text-blue-500 hover:underline\">Forgot password?</a>\r\n                    </div>\r\n\r\n                    <button type=\"submit\" id=\"submitBtn\"\r\n                        class=\"w-full flex justify-center py-3.5 px-4 border border-transparent text-sm font-bold rounded-lg text-white bg-gray-900 hover:bg-black focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-900 transition-all shadow-md active:scale-[0.98]\">\r\n                        Sign In\r\n                    </button>\r\n                </form>\r\n\r\n                <p class=\"mt-6 text-center text-sm text-gray-500\">\r\n                    New here? \r\n                    <a href=\"#\" class=\"font-bold text-gray-900 hover:underline\">Create an account</a>\r\n                </p>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <script>\r\n        function togglePassword() {\r\n            const input = document.getElementById('password');\r\n            const icon = document.getElementById('eye-icon');\r\n            const eyeOpen = icon.querySelectorAll('.eye-open');\r\n            const eyeClosed = icon.querySelector('.eye-closed');\r\n            \r\n            if (input.type === 'password') {\r\n                input.type = 'text';\r\n                eyeOpen.forEach(p => p.classList.add('hidden'));\r\n                eyeClosed.classList.remove('hidden');\r\n            } else {\r\n                input.type = 'password';\r\n                eyeOpen.forEach(p => p.classList.remove('hidden'));\r\n                eyeClosed.classList.add('hidden');\r\n            }\r\n        }\r\n\r\n        async function handleLogin(e) {\r\n            e.preventDefault();\r\n            const btn = document.getElementById('submitBtn');\r\n            const originalText = btn.innerText;\r\n            btn.innerText = \"Verifying...\";\r\n            btn.disabled = true;\r\n\r\n            const formData = new FormData(e.target);\r\n            const data = Object.fromEntries(formData.entries());\r\n\r\n            try {\r\n                const response = await fetch('/login', {\r\n                    method: 'POST',\r\n                    headers: { 'Content-Type': 'application/json' },\r\n                    body: JSON.stringify(data)\r\n                });\r\n\r\n                if (response.ok) {\r\n                    const result = await response.json();\r\n                    if (result.role === 'admin') window.location.href = '/admin/dashboard';\r\n                    else if (result.role === 'institute') window.location.href = '/school/dashboard';\r\n                    else if (result.role === 'teacher') window.location.href = '/teacher/dashboard';\r\n                    else window.location.href = '/'; \r\n                } else {\r\n                    const errorData = await response.json();\r\n                    alert(errorData.error || \"Login failed\");\r\n                    btn.innerText = originalText;\r\n                    btn.disabled = false;\r\n                }\r\n            } catch (error) {\r\n                console.error('Login error:', error);\r\n                alert(\"Network error. Please try again.\");\r\n                btn.innerText = originalText;\r\n                btn.disabled = false;\r\n            }\r\n        }\r\n    </script>\r\n    `;\r\n}\r\n", "// This loads all middlewares exposed on the middleware object and then starts\n// the invocation chain. The big idea is that we can add these to the middleware\n// export dynamically through wrangler, or we can potentially let users directly\n// add them as a sort of \"plugin\" system.\n\nimport ENTRY, { __INTERNAL_WRANGLER_MIDDLEWARE__ } from \"C:\\\\Users\\\\mahfu\\\\OneDrive\\\\Desktop\\\\WorkStation\\\\WebDevelopment\\\\routine\\\\.wrangler\\\\tmp\\\\bundle-h83UVb\\\\middleware-insertion-facade.js\";\nimport { __facade_invoke__, __facade_register__, Dispatcher } from \"C:\\\\Users\\\\mahfu\\\\AppData\\\\Roaming\\\\npm\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\common.ts\";\nimport type { WorkerEntrypointConstructor } from \"C:\\\\Users\\\\mahfu\\\\OneDrive\\\\Desktop\\\\WorkStation\\\\WebDevelopment\\\\routine\\\\.wrangler\\\\tmp\\\\bundle-h83UVb\\\\middleware-insertion-facade.js\";\n\n// Preserve all the exports from the worker\nexport * from \"C:\\\\Users\\\\mahfu\\\\OneDrive\\\\Desktop\\\\WorkStation\\\\WebDevelopment\\\\routine\\\\.wrangler\\\\tmp\\\\bundle-h83UVb\\\\middleware-insertion-facade.js\";\n\nclass __Facade_ScheduledController__ implements ScheduledController {\n\treadonly #noRetry: ScheduledController[\"noRetry\"];\n\n\tconstructor(\n\t\treadonly scheduledTime: number,\n\t\treadonly cron: string,\n\t\tnoRetry: ScheduledController[\"noRetry\"]\n\t) {\n\t\tthis.#noRetry = noRetry;\n\t}\n\n\tnoRetry() {\n\t\tif (!(this instanceof __Facade_ScheduledController__)) {\n\t\t\tthrow new TypeError(\"Illegal invocation\");\n\t\t}\n\t\t// Need to call native method immediately in case uncaught error thrown\n\t\tthis.#noRetry();\n\t}\n}\n\nfunction wrapExportedHandler(worker: ExportedHandler): ExportedHandler {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn worker;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\tconst fetchDispatcher: ExportedHandlerFetchHandler = function (\n\t\trequest,\n\t\tenv,\n\t\tctx\n\t) {\n\t\tif (worker.fetch === undefined) {\n\t\t\tthrow new Error(\"Handler does not export a fetch() function.\");\n\t\t}\n\t\treturn worker.fetch(request, env, ctx);\n\t};\n\n\treturn {\n\t\t...worker,\n\t\tfetch(request, env, ctx) {\n\t\t\tconst dispatcher: Dispatcher = function (type, init) {\n\t\t\t\tif (type === \"scheduled\" && worker.scheduled !== undefined) {\n\t\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\t\tDate.now(),\n\t\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t\t() => {}\n\t\t\t\t\t);\n\t\t\t\t\treturn worker.scheduled(controller, env, ctx);\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn __facade_invoke__(request, env, ctx, dispatcher, fetchDispatcher);\n\t\t},\n\t};\n}\n\nfunction wrapWorkerEntrypoint(\n\tklass: WorkerEntrypointConstructor\n): WorkerEntrypointConstructor {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn klass;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\t// `extend`ing `klass` here so other RPC methods remain callable\n\treturn class extends klass {\n\t\t#fetchDispatcher: ExportedHandlerFetchHandler<Record<string, unknown>> = (\n\t\t\trequest,\n\t\t\tenv,\n\t\t\tctx\n\t\t) => {\n\t\t\tthis.env = env;\n\t\t\tthis.ctx = ctx;\n\t\t\tif (super.fetch === undefined) {\n\t\t\t\tthrow new Error(\"Entrypoint class does not define a fetch() function.\");\n\t\t\t}\n\t\t\treturn super.fetch(request);\n\t\t};\n\n\t\t#dispatcher: Dispatcher = (type, init) => {\n\t\t\tif (type === \"scheduled\" && super.scheduled !== undefined) {\n\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\tDate.now(),\n\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t() => {}\n\t\t\t\t);\n\t\t\t\treturn super.scheduled(controller);\n\t\t\t}\n\t\t};\n\n\t\tfetch(request: Request<unknown, IncomingRequestCfProperties>) {\n\t\t\treturn __facade_invoke__(\n\t\t\t\trequest,\n\t\t\t\tthis.env,\n\t\t\t\tthis.ctx,\n\t\t\t\tthis.#dispatcher,\n\t\t\t\tthis.#fetchDispatcher\n\t\t\t);\n\t\t}\n\t};\n}\n\nlet WRAPPED_ENTRY: ExportedHandler | WorkerEntrypointConstructor | undefined;\nif (typeof ENTRY === \"object\") {\n\tWRAPPED_ENTRY = wrapExportedHandler(ENTRY);\n} else if (typeof ENTRY === \"function\") {\n\tWRAPPED_ENTRY = wrapWorkerEntrypoint(ENTRY);\n}\nexport default WRAPPED_ENTRY;\n", "\t\t\t\timport worker, * as OTHER_EXPORTS from \"C:\\\\Users\\\\mahfu\\\\OneDrive\\\\Desktop\\\\WorkStation\\\\WebDevelopment\\\\routine\\\\src\\\\index.js\";\n\t\t\t\timport * as __MIDDLEWARE_0__ from \"C:\\\\Users\\\\mahfu\\\\AppData\\\\Roaming\\\\npm\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\middleware-ensure-req-body-drained.ts\";\nimport * as __MIDDLEWARE_1__ from \"C:\\\\Users\\\\mahfu\\\\AppData\\\\Roaming\\\\npm\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\middleware-miniflare3-json-error.ts\";\n\n\t\t\t\texport * from \"C:\\\\Users\\\\mahfu\\\\OneDrive\\\\Desktop\\\\WorkStation\\\\WebDevelopment\\\\routine\\\\src\\\\index.js\";\n\t\t\t\tconst MIDDLEWARE_TEST_INJECT = \"__INJECT_FOR_TESTING_WRANGLER_MIDDLEWARE__\";\n\t\t\t\texport const __INTERNAL_WRANGLER_MIDDLEWARE__ = [\n\t\t\t\t\t\n\t\t\t\t\t__MIDDLEWARE_0__.default,__MIDDLEWARE_1__.default\n\t\t\t\t]\n\t\t\t\texport default worker;", "import { handlePublicRequest } from './routers/router_public.js';\r\nimport { handleAdminRequest } from './routers/router_admin.js';\r\nimport { handleInstituteRequest } from './routers/router_institute.js'; // <--- ENABLED\r\nimport { handleTeacherRequest } from './routers/router_teacher.js';     // <--- ENABLED\r\nimport { syncDatabase } from './core/schema_manager.js';\r\n\r\nexport default {\r\n  async fetch(request, env) {\r\n    const url = new URL(request.url);\r\n    const path = url.pathname;\r\n\r\n    try {\r\n      await syncDatabase(env);\r\n    } catch (error) {\r\n      console.error('Database sync failed', error);\r\n    }\r\n\r\n    // --- ROUTING LOGIC ---\r\n\r\n    // A. Admin Area\r\n    if (path.startsWith('/admin')) {\r\n      return await handleAdminRequest(request, env);\r\n    }\r\n\r\n    // B. Institute Area (This was disabled!)\r\n    if (path.startsWith('/school')) {\r\n      return await handleInstituteRequest(request, env);\r\n    }\r\n\r\n    // C. Teacher Area (Placeholder)\r\n    if (path.startsWith('/teacher')) {\r\n      return await handleTeacherRequest(request, env);\r\n    }\r\n\r\n    // D. Public Area (Login, Home)\r\n    return await handlePublicRequest(request, env);\r\n  }\r\n};\r\n", "import { htmlResponse, jsonResponse, getCookie, getCompanyName } from '../core/utils.js';\r\nimport { PublicLayout } from '../ui/public/layout.js';\r\nimport { verifyPassword } from '../core/auth.js';\r\n\r\nexport async function handlePublicRequest(request, env) {\r\n  const url = new URL(request.url);\r\n  const companyName = await getCompanyName(env);\r\n\r\n  // AUTH STATUS CHECK\r\n  let email = getCookie(request, 'user_email');\r\n  let role = getCookie(request, 'user_role');\r\n  if (role) role = role.replace(/['\"]+/g, '').trim(); \r\n  if (email) email = email.replace(/['\"]+/g, '').trim();\r\n\r\n  const isLoggedIn = !!(email && role);\r\n  const currentUser = isLoggedIn ? { email, role } : null;\r\n\r\n  // --- HOME PAGE ---\r\n  if (url.pathname === '/') {\r\n    const { HomeHTML } = await import('../ui/public/home.js');\r\n    return htmlResponse(PublicLayout(HomeHTML(companyName), \"Home\", companyName, currentUser));\r\n  }\r\n  \r\n  // --- LOGIN PAGE ---\r\n  if (url.pathname === '/login') {\r\n    \r\n    // STRICT REDIRECT: If logged in, go to dashboard\r\n    if (isLoggedIn) {\r\n        if (role === 'admin') return Response.redirect(url.origin + '/admin/dashboard', 302);\r\n        if (role === 'institute') return Response.redirect(url.origin + '/school/dashboard', 302);\r\n        if (role === 'teacher') return Response.redirect(url.origin + '/teacher/dashboard', 302);\r\n        return Response.redirect(url.origin + '/', 302);\r\n    }\r\n\r\n    if (request.method === 'POST') {\r\n        try {\r\n            const { email, password } = await request.json();\r\n            const user = await env.DB.prepare(\"SELECT * FROM auth_accounts WHERE email = ?\").bind(email).first();\r\n            \r\n            if (!user) return jsonResponse({ error: \"Account not found\" }, 401);\r\n\r\n            const isValid = await verifyPassword(password, user.password_hash, user.salt);\r\n            if (!isValid) return jsonResponse({ error: \"Wrong password\" }, 401);\r\n\r\n            const headers = new Headers();\r\n            const safeRole = user.role || 'unknown'; \r\n            const isSecure = url.protocol === 'https:';\r\n            const secureFlag = isSecure ? 'Secure;' : ''; \r\n            // 7-Day Persistence\r\n            const cookieSettings = `Path=/; HttpOnly; ${secureFlag} SameSite=Lax; Max-Age=604800`;\r\n\r\n            headers.set('Content-Type', 'application/json');\r\n            headers.append(\"Set-Cookie\", `user_role=${safeRole}; ${cookieSettings}`);\r\n            headers.append(\"Set-Cookie\", `user_email=${user.email}; ${cookieSettings}`); \r\n            headers.append(\"Set-Cookie\", `auth_status=active; ${cookieSettings}`);\r\n\r\n            return new Response(JSON.stringify({ success: true, role: safeRole }), { headers });\r\n\r\n        } catch (e) { return jsonResponse({ error: e.message }, 500); }\r\n    }\r\n\r\n    const { LOGIN_HTML } = await import('../ui/public/login.js');\r\n    return htmlResponse(PublicLayout(LOGIN_HTML(companyName), \"Sign In\", companyName, null));\r\n  }\r\n\r\n  // --- LOGOUT ---\r\n  if (url.pathname === '/logout') {\r\n    const headers = new Headers();\r\n    headers.append(\"Set-Cookie\", \"user_role=; Path=/; Max-Age=0; HttpOnly; SameSite=Lax\");\r\n    headers.append(\"Set-Cookie\", \"user_email=; Path=/; Max-Age=0; HttpOnly; SameSite=Lax\");\r\n    headers.append(\"Set-Cookie\", \"auth_status=; Path=/; Max-Age=0; HttpOnly; SameSite=Lax\");\r\n    headers.append(\"Location\", \"/login\"); \r\n    return new Response(\"Logging out...\", { status: 302, headers: headers });\r\n  }\r\n\r\n  return new Response(\"Page Not Found\", { status: 404 });\r\n}\r\n", "// Append this to the bottom of src/core/utils.js\r\n\r\nexport function jsonResponse(data, status = 200) {\r\n  return new Response(JSON.stringify(data), {\r\n    status: status,\r\n    headers: { 'Content-Type': 'application/json' }\r\n  });\r\n}\r\n\r\nexport function htmlResponse(html) {\r\n  return new Response(html, {\r\n    headers: { 'Content-Type': 'text/html' }\r\n  });\r\n}\r\n\r\n// NEW: Helper to get the Company Name (SaaS Provider Name)\r\nexport async function getCompanyName(env) {\r\n  try {\r\n    const result = await env.DB.prepare(\"SELECT value FROM system_settings WHERE key = 'site_name'\").first();\r\n    return result ? result.value : 'RoutineAI SaaS'; // Default Name\r\n  } catch (e) {\r\n    return 'RoutineAI SaaS';\r\n  }\r\n}\r\n\r\n// ... (keep existing code) ...\r\n\r\n// NEW: Helper to read a specific cookie from the request\r\nexport function getCookie(request, name) {\r\n  const cookieString = request.headers.get('Cookie');\r\n  if (!cookieString) return null;\r\n  \r\n  const cookies = cookieString.split(';');\r\n  for (let cookie of cookies) {\r\n    const [key, value] = cookie.trim().split('=');\r\n    if (key === name) return value;\r\n  }\r\n  return null;\r\n}", "// src/ui/public/layout.js\r\n\r\nexport function PublicLayout(contentHTML, title = \"Home\", companyName = \"RoutineAI\", user = null) {\r\n  \r\n  // ROBUST LINK LOGIC\r\n  let dashboardLink = '/login'; // Default\r\n  if (user && user.role) {\r\n      const r = user.role.toLowerCase(); // Handle 'Institute' vs 'institute'\r\n      if (r === 'admin') dashboardLink = '/admin/dashboard';\r\n      else if (r === 'institute') dashboardLink = '/school/dashboard';\r\n      else if (r === 'teacher') dashboardLink = '/teacher/dashboard';\r\n  }\r\n\r\n  return `\r\n  <!DOCTYPE html>\r\n  <html lang=\"en\">\r\n  <head>\r\n      <meta charset=\"UTF-8\">\r\n      <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0\">\r\n      <title>${title} - ${companyName}</title>\r\n      <script src=\"https://cdn.tailwindcss.com\"></script>\r\n      <link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap\" rel=\"stylesheet\">\r\n      <style>\r\n        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }\r\n        .smooth-scroll { -webkit-overflow-scrolling: touch; }\r\n        .page-shell { animation: pageFadeIn 320ms ease-out both; }\r\n        .page-leave .page-shell { opacity: 0; transform: translateY(6px); transition: opacity 180ms ease, transform 180ms ease; }\r\n        .ui-glow::before {\r\n          content: \"\";\r\n          position: fixed;\r\n          inset: -10% -10% auto -10%;\r\n          height: 40vh;\r\n          background:\r\n            radial-gradient(circle at top left, rgba(59, 130, 246, 0.18), transparent 55%),\r\n            radial-gradient(circle at top right, rgba(168, 85, 247, 0.16), transparent 55%),\r\n            radial-gradient(circle at 40% 10%, rgba(16, 185, 129, 0.12), transparent 50%);\r\n          pointer-events: none;\r\n          z-index: 0;\r\n        }\r\n        @keyframes pageFadeIn {\r\n          from { opacity: 0; transform: translateY(10px); }\r\n          to { opacity: 1; transform: translateY(0); }\r\n        }\r\n        @media (prefers-reduced-motion: reduce) {\r\n          .page-shell { animation: none; }\r\n          .page-leave .page-shell { transition: none; }\r\n        }\r\n      </style>\r\n  </head>\r\n  <body class=\"ui-glow bg-slate-50 text-gray-900 flex flex-col min-h-screen relative overflow-x-hidden\">\r\n\r\n      <nav class=\"sticky top-0 z-50 bg-white/90 backdrop-blur-md border-b border-gray-100 transition-all\">\r\n          <div class=\"h-0.5 w-full bg-gradient-to-r from-blue-500 via-purple-500 to-emerald-400\"></div>\r\n          <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\r\n              <div class=\"flex justify-between items-center h-16\">\r\n                  \r\n                  <div class=\"flex items-center\">\r\n                      <a href=\"/\" class=\"text-xl font-bold text-gray-900 tracking-tight hover:opacity-80 transition-opacity\">\r\n                          ${companyName}\r\n                      </a>\r\n                  </div>\r\n\r\n                  <div class=\"flex items-center gap-6\">\r\n                      \r\n                      ${user ? `\r\n                        <div class=\"flex items-center gap-3\">\r\n                            <a href=\"${dashboardLink}\" class=\"group flex items-center gap-3 hover:opacity-80 transition-opacity\">\r\n                                <span class=\"hidden md:block text-sm font-medium text-gray-700 group-hover:text-blue-600\">\r\n                                    My Dashboard\r\n                                </span>\r\n                                <div class=\"w-9 h-9 rounded-full bg-blue-600 text-white flex items-center justify-center font-bold text-sm shadow-sm ring-2 ring-white\">\r\n                                    ${user.email.charAt(0).toUpperCase()}\r\n                                </div>\r\n                            </a>\r\n                        </div>\r\n                      ` : `\r\n                        <div class=\"flex items-center gap-4\">\r\n                            <a href=\"/login\" class=\"text-sm font-medium text-gray-600 hover:text-gray-900 transition-colors\">Log in</a>\r\n                            <a href=\"/login\" class=\"hidden sm:inline-flex items-center justify-center px-5 py-2 text-sm font-medium rounded-lg text-white bg-gray-900 hover:bg-black transition-all shadow-sm\">\r\n                                Get Started\r\n                            </a>\r\n                        </div>\r\n                      `}\r\n                      \r\n                  </div>\r\n              </div>\r\n          </div>\r\n      </nav>\r\n\r\n      <main class=\"page-shell flex-grow w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 smooth-scroll relative z-10\">\r\n          ${contentHTML}\r\n      </main>\r\n\r\n      <footer class=\"bg-gray-50 border-t border-gray-200 mt-auto\">\r\n          <div class=\"max-w-7xl mx-auto py-10 px-4 sm:px-6 lg:px-8 flex flex-col md:flex-row justify-between items-center gap-6\">\r\n              <p class=\"text-sm text-gray-500\">\u00A9 ${new Date().getFullYear()} ${companyName}. All rights reserved.</p>\r\n              <div class=\"flex gap-6 text-sm text-gray-500\">\r\n                  <a href=\"#\" class=\"hover:text-gray-900 transition-colors\">Privacy Policy</a>\r\n                  <a href=\"#\" class=\"hover:text-gray-900 transition-colors\">Terms of Service</a>\r\n                  <a href=\"#\" class=\"hover:text-gray-900 transition-colors\">Contact Support</a>\r\n              </div>\r\n          </div>\r\n      </footer>\r\n\r\n      <script>\r\n        const enablePageTransitions = () => {\r\n          if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;\r\n          document.addEventListener('click', (event) => {\r\n            const link = event.target.closest('a');\r\n            if (!link || link.target === '_blank' || link.hasAttribute('download')) return;\r\n            const href = link.getAttribute('href') || '';\r\n            if (href.startsWith('#') || href.startsWith('mailto:') || href.startsWith('tel:')) return;\r\n            if (event.metaKey || event.ctrlKey || event.shiftKey || event.altKey || event.button !== 0) return;\r\n            const url = new URL(link.href, window.location.href);\r\n            if (url.origin !== window.location.origin) return;\r\n            event.preventDefault();\r\n            document.body.classList.add('page-leave');\r\n            setTimeout(() => { window.location.href = link.href; }, 180);\r\n          });\r\n        };\r\n\r\n        const enableAutoRefresh = () => {\r\n          let lastInteraction = Date.now();\r\n          const mark = () => { lastInteraction = Date.now(); };\r\n          ['click', 'keydown', 'scroll', 'mousemove', 'touchstart'].forEach((evt) => {\r\n            document.addEventListener(evt, mark, { passive: true });\r\n          });\r\n          const intervalMs = 120000;\r\n          setInterval(() => {\r\n            if (document.hidden) return;\r\n            const active = document.activeElement;\r\n            if (active && ['INPUT', 'TEXTAREA', 'SELECT'].includes(active.tagName)) return;\r\n            if (Date.now() - lastInteraction < intervalMs) return;\r\n            window.location.reload();\r\n          }, intervalMs);\r\n        };\r\n\r\n        window.addEventListener('DOMContentLoaded', () => {\r\n          enablePageTransitions();\r\n          enableAutoRefresh();\r\n        });\r\n      </script>\r\n  </body>\r\n  </html>\r\n  `;\r\n}\r\n", "// src/core/auth.js\r\n\r\n// 1. Hash a new password (for Setup/Registration)\r\nexport async function hashPassword(password) {\r\n  const encoder = new TextEncoder();\r\n  const salt = crypto.getRandomValues(new Uint8Array(16));\r\n  const saltHex = [...salt].map(b => b.toString(16).padStart(2, '0')).join('');\r\n  \r\n  const data = encoder.encode(password + saltHex);\r\n  const hashBuffer = await crypto.subtle.digest('SHA-256', data);\r\n  const hashHex = Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, '0')).join('');\r\n\r\n  return { hash: hashHex, salt: saltHex };\r\n}\r\n\r\n// 2. Verify a password (for Login)\r\n// We take the input password, mix it with the STORED salt, and see if it matches the STORED hash.\r\nexport async function verifyPassword(inputPassword, storedHash, storedSalt) {\r\n  const encoder = new TextEncoder();\r\n  const data = encoder.encode(inputPassword + storedSalt);\r\n  \r\n  const hashBuffer = await crypto.subtle.digest('SHA-256', data);\r\n  const computedHash = Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, '0')).join('');\r\n\r\n  return computedHash === storedHash;\r\n}", "import { htmlResponse, jsonResponse, getCookie, getCompanyName } from '../core/utils.js';\r\nimport { hashPassword } from '../core/auth.js';\r\nimport { ADMIN_SETUP_HTML } from '../ui/admin/setup.js';\r\nimport { AdminLayout } from '../ui/admin/layout.js';\r\nimport { SettingsPageHTML } from '../ui/admin/settings.js';\r\nimport { SchoolsPageHTML } from '../ui/admin/schools.js'; \r\nimport { SchoolDetailHTML } from '../ui/admin/school_detail.js'; \r\nimport { SchoolClassesHTML } from '../ui/admin/school_classes.js'; \r\nimport { SchoolTeachersHTML } from '../ui/admin/school_teachers.js'; \r\nimport { ROLES } from '../config.js';\r\nimport { syncDatabase } from '../core/schema_manager.js';\r\n\r\nexport async function handleAdminRequest(request, env) {\r\n  const url = new URL(request.url);\r\n  const companyName = await getCompanyName(env);\r\n\r\n  // 1. AUTH CHECK\r\n  const email = getCookie(request, 'user_email');\r\n  if (!email && url.pathname !== '/admin/setup') {\r\n      return htmlResponse(\"<h1>Unauthorized</h1><p>Please log in.</p>\", 401);\r\n  }\r\n\r\n  // --- DASHBOARD ---\r\n  if (url.pathname === '/admin/dashboard') {\r\n    const content = `\r\n    <div class=\"p-6 bg-white rounded-lg shadow-sm border border-gray-200\">\r\n        <h3 class=\"text-lg font-bold text-gray-900 mb-2\">Welcome to your Control Center</h3>\r\n        <p class=\"text-gray-500\">Select an option from the sidebar to manage schools, settings, or view reports.</p>\r\n    </div>`;\r\n    return htmlResponse(AdminLayout(content, \"Dashboard\", companyName, {email}));\r\n  }\r\n\r\n  // --- SETTINGS (The New Profile Page) ---\r\n  if (url.pathname === '/admin/settings') {\r\n      const admin = await env.DB.prepare(\"SELECT * FROM auth_accounts WHERE email = ?\").bind(email).first();\r\n      \r\n      if (request.method === 'POST') {\r\n          try {\r\n              const body = await request.json();\r\n              \r\n              if (body.action === 'update_profile') {\r\n                  const exists = await env.DB.prepare(\"SELECT id FROM profiles_admin WHERE auth_id = ?\").bind(admin.id).first();\r\n                  if (exists) {\r\n                      await env.DB.prepare(\"UPDATE profiles_admin SET full_name=?, phone=?, dob=? WHERE auth_id=?\").bind(body.full_name, body.phone, body.dob, admin.id).run();\r\n                  } else {\r\n                      await env.DB.prepare(\"INSERT INTO profiles_admin (auth_id, full_name, phone, dob) VALUES (?, ?, ?, ?)\").bind(admin.id, body.full_name, body.phone, body.dob).run();\r\n                  }\r\n                  return jsonResponse({ success: true });\r\n              }\r\n\r\n              if (body.action === 'change_password') {\r\n                  const { hash, salt } = await hashPassword(body.password);\r\n                  await env.DB.prepare(\"UPDATE auth_accounts SET password_hash=?, salt=? WHERE id=?\").bind(hash, salt, admin.id).run();\r\n                  return jsonResponse({ success: true });\r\n              }\r\n          } catch(e) { \r\n              if(e.message.includes(\"no such table\")) await syncDatabase(env);\r\n              return jsonResponse({ error: e.message }, 500); \r\n          }\r\n      }\r\n\r\n      let profile = {};\r\n      try { profile = await env.DB.prepare(\"SELECT * FROM profiles_admin WHERE auth_id = ?\").bind(admin.id).first(); } catch(e) {}\r\n      return htmlResponse(AdminLayout(SettingsPageHTML(profile, email), \"Settings\", companyName, {email}));\r\n  }\r\n\r\n  // --- MANAGE SCHOOLS ---\r\n  if (url.pathname === '/admin/schools') {\r\n    if (request.method === 'POST') {\r\n        try {\r\n            const body = await request.json();\r\n            if (!body.email || !body.password || !body.school_name) return jsonResponse({ error: \"Missing fields\" }, 400);\r\n            \r\n            const exists = await env.DB.prepare(\"SELECT id FROM auth_accounts WHERE email = ?\").bind(body.email).first();\r\n            if (exists) return jsonResponse({ error: \"Email exists\" }, 400);\r\n\r\n            const { hash, salt } = await hashPassword(body.password);\r\n            const authResult = await env.DB.prepare(\"INSERT INTO auth_accounts (email, password_hash, salt, role) VALUES (?, ?, ?, ?) RETURNING id\").bind(body.email, hash, salt, ROLES.INSTITUTE).first();\r\n            await env.DB.prepare(\"INSERT INTO profiles_institution (auth_id, school_name, eiin_code, address) VALUES (?, ?, ?, ?)\").bind(authResult.id, body.school_name, body.eiin || '', body.address || '').run();\r\n            return jsonResponse({ success: true });\r\n        } catch(e) { return jsonResponse({ error: e.message }, 500); }\r\n    }\r\n    const result = await env.DB.prepare(`SELECT p.auth_id, p.school_name, p.eiin_code, a.email FROM profiles_institution p JOIN auth_accounts a ON p.auth_id = a.id ORDER BY p.id DESC`).all();\r\n    return htmlResponse(AdminLayout(SchoolsPageHTML(result.results || []), \"Schools\", companyName, {email}));\r\n  }\r\n\r\n  // --- SCHOOL MENU (The Settings List) ---\r\n  if (url.pathname === '/admin/school/view') {\r\n    const authId = url.searchParams.get('id');\r\n    const school = await env.DB.prepare(`SELECT * FROM profiles_institution WHERE auth_id = ?`).bind(authId).first();\r\n    if(school) school.email = (await env.DB.prepare(\"SELECT email FROM auth_accounts WHERE id=?\").bind(authId).first()).email;\r\n    return htmlResponse(AdminLayout(SchoolDetailHTML(school), \"Manage Client\", companyName, {email}));\r\n  }\r\n\r\n  // --- SCHOOL TEACHERS (Limits & List) ---\r\n  if (url.pathname === '/admin/school/teachers') {\r\n      if(request.method === 'POST') {\r\n          const body = await request.json();\r\n          if(body.action === 'update_limit') {\r\n              await env.DB.prepare(\"UPDATE profiles_institution SET max_teachers = ? WHERE id = ?\").bind(body.max_val, body.school_id).run();\r\n              return jsonResponse({success:true});\r\n          }\r\n      }\r\n      const authId = url.searchParams.get('id');\r\n      const school = await env.DB.prepare(`SELECT * FROM profiles_institution WHERE auth_id = ?`).bind(authId).first();\r\n      const teachers = await env.DB.prepare(\"SELECT * FROM profiles_teacher WHERE school_id = ?\").bind(school.id).all();\r\n      return htmlResponse(AdminLayout(SchoolTeachersHTML(school, teachers.results), \"Teachers\", companyName, {email}));\r\n  }\r\n\r\n  // --- SCHOOL CLASSES (New Logic) ---\r\n  if (url.pathname === '/admin/school/classes') {\r\n      if(request.method === 'POST') {\r\n          try {\r\n              const body = await request.json();\r\n              \r\n              if(body.action === 'create_class') {\r\n                  // Create new class\r\n                  await env.DB.prepare(\"INSERT INTO academic_classes (school_id, class_name, has_groups) VALUES (?, ?, ?)\")\r\n                      .bind(body.school_id, body.class_name, body.has_groups ? 1 : 0).run();\r\n                  return jsonResponse({success:true});\r\n              }\r\n              \r\n              if(body.action === 'add_group') {\r\n                  // Add group to existing class\r\n                  await env.DB.prepare(\"INSERT INTO class_groups (school_id, class_id, group_name) VALUES (?, ?, ?)\")\r\n                      .bind(body.school_id, body.class_id, body.group_name).run();\r\n                  return jsonResponse({success:true});\r\n              }\r\n              \r\n              if(body.action === 'add_section') {\r\n                  // Add section to class (with optional group) - single shift only\r\n                  await env.DB.prepare(\"INSERT INTO class_sections (school_id, class_id, group_id, section_name) VALUES (?, ?, ?, ?)\")\r\n                      .bind(body.school_id, body.class_id, body.group_id || null, body.section_name).run();\r\n                  return jsonResponse({success:true});\r\n              }\r\n          } catch(e) {\r\n              console.error('Classes API Error:', e);\r\n              // If tables don't exist, try to sync database\r\n              if(e.message.includes(\"no such table\")) {\r\n                  await syncDatabase(env);\r\n                  return jsonResponse({error: \"Database tables are being created. Please try again in a moment.\"}, 500);\r\n              }\r\n              return jsonResponse({error: e.message}, 500);\r\n          }\r\n      }\r\n      \r\n      if(request.method === 'DELETE') {\r\n          const body = await request.json();\r\n          \r\n          if(body.action === 'delete_class') {\r\n              await env.DB.prepare(\"DELETE FROM academic_classes WHERE id=?\").bind(body.id).run();\r\n              return jsonResponse({success:true});\r\n          }\r\n          \r\n          if(body.action === 'delete_group') {\r\n              await env.DB.prepare(\"DELETE FROM class_groups WHERE id=?\").bind(body.id).run();\r\n              return jsonResponse({success:true});\r\n          }\r\n          \r\n          if(body.action === 'delete_section') {\r\n              await env.DB.prepare(\"DELETE FROM class_sections WHERE id=?\").bind(body.id).run();\r\n              return jsonResponse({success:true});\r\n          }\r\n      }\r\n      \r\n      const authId = url.searchParams.get('id');\r\n      const school = await env.DB.prepare(`SELECT * FROM profiles_institution WHERE auth_id = ?`).bind(authId).first();\r\n      \r\n      // Get all data (MAIN ADMIN: Only classes, groups, sections)\r\n      const classes = await env.DB.prepare(\"SELECT * FROM academic_classes WHERE school_id = ? ORDER BY class_name ASC\").bind(school.id).all();\r\n      const groups = await env.DB.prepare(\"SELECT * FROM class_groups WHERE school_id = ? ORDER BY class_id, group_name\").bind(school.id).all();\r\n      const sections = await env.DB.prepare(\"SELECT * FROM class_sections WHERE school_id = ? ORDER BY class_id, section_name\").bind(school.id).all();\r\n      \r\n      return htmlResponse(AdminLayout(\r\n        SchoolClassesHTML(\r\n          school, \r\n          classes.results, \r\n          groups.results, \r\n          sections.results\r\n        ), \r\n        \"Classes\", \r\n        companyName, \r\n        {email}\r\n      ));\r\n  }\r\n\r\n  // --- SETUP ---\r\n  if (url.pathname === '/admin/setup') {\r\n    try { await syncDatabase(env); } catch (e) {}\r\n    if (request.method === 'POST') {\r\n        const { email, password } = await request.json();\r\n        const { hash, salt } = await hashPassword(password);\r\n        await env.DB.prepare(\"INSERT INTO auth_accounts (email, password_hash, salt, role) VALUES (?, ?, ?, ?)\").bind(email, hash, salt, ROLES.ADMIN).run();\r\n        return jsonResponse({ success: true });\r\n    }\r\n    return htmlResponse(ADMIN_SETUP_HTML);\r\n  }\r\n\r\n  return new Response(\"Page Not Found\", { status: 404 });\r\n}\r\n", "export const ADMIN_SETUP_HTML = `\r\n<!DOCTYPE html>\r\n<html>\r\n<head>\r\n  <title>Admin Setup</title>\r\n  <style>\r\n    body { font-family: sans-serif; display: flex; justify-content: center; padding-top: 50px; background: #f4f4f4; }\r\n    form { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); width: 300px; }\r\n    input { width: 100%; padding: 8px; margin: 10px 0; box-sizing: border-box; }\r\n    button { width: 100%; padding: 10px; background: #007bff; color: white; border: none; cursor: pointer; }\r\n    button:hover { background: #0056b3; }\r\n  </style>\r\n</head>\r\n<body>\r\n  <form onsubmit=\"createAdmin(event)\">\r\n    <h2>Create Root Admin</h2>\r\n    <input type=\"email\" id=\"email\" placeholder=\"Email\" required />\r\n    <input type=\"password\" id=\"password\" placeholder=\"Password\" required />\r\n    <button type=\"submit\">Create Admin</button>\r\n  </form>\r\n\r\n  <script>\r\n    async function createAdmin(e) {\r\n      e.preventDefault();\r\n      const email = document.getElementById('email').value;\r\n      const password = document.getElementById('password').value;\r\n      \r\n      const res = await fetch('/admin/setup', {\r\n        method: 'POST',\r\n        headers: {'Content-Type': 'application/json'},\r\n        body: JSON.stringify({ email, password })\r\n      });\r\n      \r\n      const data = await res.json();\r\n      if(data.success) {\r\n        alert(\"Admin Created! You can now login.\");\r\n        window.location.href = '/admin/dashboard';\r\n      } else {\r\n        alert(\"Error: \" + data.error);\r\n      }\r\n    }\r\n  </script>\r\n</body>\r\n</html>\r\n`;", "// src/ui/admin/layout.js\r\n\r\nexport function AdminLayout(contentHTML, title = \"Dashboard\", companyName = \"RoutineAI\", user = {email: 'A'}) {\r\n  const initial = (user.email || 'A').charAt(0).toUpperCase();\r\n\r\n  return `\r\n  <!DOCTYPE html>\r\n  <html lang=\"en\">\r\n  <head>\r\n      <meta charset=\"UTF-8\">\r\n      <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover\">\r\n      <title>${title} - ${companyName}</title>\r\n      <script src=\"https://cdn.tailwindcss.com\"></script>\r\n      <link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap\" rel=\"stylesheet\">\r\n      <style>\r\n        body { \r\n          font-family: 'Inter', sans-serif; \r\n          -webkit-tap-highlight-color: transparent;\r\n          padding-top: env(safe-area-inset-top);\r\n        }\r\n        .sidebar-transition { transition: transform 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); }\r\n        .no-scrollbar::-webkit-scrollbar { display: none; }\r\n        .page-shell { animation: pageFadeIn 320ms ease-out both; }\r\n        .page-leave .page-shell { opacity: 0; transform: translateY(6px); transition: opacity 180ms ease, transform 180ms ease; }\r\n        \r\n        /* Mobile optimizations */\r\n        @media (max-width: 768px) {\r\n          .mobile-header {\r\n            padding-top: env(safe-area-inset-top);\r\n            background: white;\r\n            position: sticky;\r\n            top: 0;\r\n            z-index: 40;\r\n          }\r\n          .mobile-content {\r\n            padding-bottom: env(safe-area-inset-bottom);\r\n          }\r\n        }\r\n        \r\n        /* Prevent zoom on input focus */\r\n        input, select, textarea {\r\n          font-size: 16px !important;\r\n        }\r\n        \r\n        /* Smooth transitions */\r\n        * {\r\n          -webkit-touch-callout: none;\r\n          -webkit-user-select: none;\r\n          -khtml-user-select: none;\r\n          -moz-user-select: none;\r\n          -ms-user-select: none;\r\n          user-select: none;\r\n        }\r\n        \r\n        input, textarea {\r\n          -webkit-user-select: text;\r\n          -moz-user-select: text;\r\n          -ms-user-select: text;\r\n          user-select: text;\r\n        }\r\n        .ui-glow::before {\r\n          content: \"\";\r\n          position: fixed;\r\n          inset: -10% -10% auto -10%;\r\n          height: 40vh;\r\n          background:\r\n            radial-gradient(circle at top left, rgba(59, 130, 246, 0.14), transparent 55%),\r\n            radial-gradient(circle at top right, rgba(168, 85, 247, 0.14), transparent 55%),\r\n            radial-gradient(circle at 40% 10%, rgba(16, 185, 129, 0.1), transparent 50%);\r\n          pointer-events: none;\r\n          z-index: 0;\r\n        }\r\n        @keyframes pageFadeIn {\r\n          from { opacity: 0; transform: translateY(10px); }\r\n          to { opacity: 1; transform: translateY(0); }\r\n        }\r\n        @media (prefers-reduced-motion: reduce) {\r\n          .page-shell { animation: none; }\r\n          .page-leave .page-shell { transition: none; }\r\n        }\r\n      </style>\r\n  </head>\r\n  <body class=\"ui-glow bg-gray-50 h-[100dvh] overflow-hidden flex flex-col text-gray-900 relative\">\r\n\r\n      <header class=\"md:hidden bg-white border-b border-gray-200 h-16 flex items-center justify-between px-4 z-30 shrink-0\">\r\n          <div class=\"absolute inset-x-0 top-0 h-0.5 bg-gradient-to-r from-blue-500 via-purple-500 to-emerald-400\"></div>\r\n          <div class=\"flex items-center gap-3\">\r\n              <button onclick=\"toggleSidebar()\" class=\"text-gray-500 hover:text-gray-900 p-2 -ml-2\">\r\n                  <svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 6h16M4 12h16M4 18h16\"></path></svg>\r\n              </button>\r\n              <span class=\"text-sm font-bold text-gray-800 truncate max-w-[150px]\">${companyName}</span>\r\n          </div>\r\n          <a href=\"/admin/settings\" class=\"w-8 h-8 rounded-full bg-gray-900 text-white flex items-center justify-center text-xs font-bold shadow-sm\">\r\n              ${initial}\r\n          </a>\r\n      </header>\r\n\r\n      <div class=\"flex flex-1 overflow-hidden relative\">\r\n          \r\n          <div id=\"sidebar-overlay\" onclick=\"toggleSidebar()\" class=\"fixed inset-0 bg-black/20 z-40 hidden md:hidden transition-opacity\"></div>\r\n\r\n          <aside id=\"sidebar\" class=\"sidebar-transition fixed inset-y-0 left-0 w-64 bg-white border-r border-gray-200 z-50 transform -translate-x-full md:relative md:translate-x-0 flex flex-col h-full\">\r\n              \r\n              <div class=\"h-16 hidden md:flex items-center border-b border-gray-100 px-6 shrink-0\">\r\n                  <span class=\"text-sm font-bold text-gray-900 tracking-wide uppercase\">${companyName}</span>\r\n              </div>\r\n\r\n              <nav class=\"flex-1 overflow-y-auto py-6 px-3 space-y-1 no-scrollbar\">\r\n                  \r\n                  <div class=\"px-3 mb-2 text-[10px] font-bold text-gray-400 uppercase tracking-wider\">Overview</div>\r\n                  <a href=\"/admin/dashboard\" class=\"flex items-center px-3 py-2 text-[13px] font-medium text-gray-600 rounded-md hover:bg-gray-50 hover:text-gray-900 transition-colors\">\r\n                      <svg class=\"w-4 h-4 mr-3 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z\"></path></svg>\r\n                      Dashboard\r\n                  </a>\r\n\r\n                  <div class=\"px-3 mt-6 mb-2 text-[10px] font-bold text-gray-400 uppercase tracking-wider\">Management</div>\r\n                  <a href=\"/admin/schools\" class=\"flex items-center px-3 py-2 text-[13px] font-medium text-gray-600 rounded-md hover:bg-gray-50 hover:text-gray-900 transition-colors\">\r\n                      <svg class=\"w-4 h-4 mr-3 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4\"></path></svg>\r\n                      Schools & Clients\r\n                  </a>\r\n\r\n                  <div class=\"px-3 mt-6 mb-2 text-[10px] font-bold text-gray-400 uppercase tracking-wider\">Account</div>\r\n                  <a href=\"/admin/settings\" class=\"flex items-center px-3 py-2 text-[13px] font-medium text-gray-600 rounded-md hover:bg-gray-50 hover:text-gray-900 transition-colors\">\r\n                      <svg class=\"w-4 h-4 mr-3 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z\"></path><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\"></path></svg>\r\n                      Admin Settings\r\n                  </a>\r\n                  \r\n              </nav>\r\n\r\n              <div class=\"p-4 border-t border-gray-100 shrink-0\">\r\n                  <a href=\"/logout\" class=\"flex items-center gap-2 px-3 py-2 text-[13px] font-medium text-red-600 hover:bg-red-50 rounded-md transition-colors\">\r\n                      <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1\"></path></svg>\r\n                      Sign Out\r\n                  </a>\r\n              </div>\r\n          </aside>\r\n\r\n          <div class=\"flex-1 flex flex-col min-w-0 bg-gray-50\">\r\n              <main class=\"page-shell flex-1 overflow-y-auto p-4 md:p-8 pb-20 relative z-10\">\r\n                  ${contentHTML}\r\n              </main>\r\n          </div>\r\n      </div>\r\n\r\n      <script>\r\n        const enablePageTransitions = () => {\r\n            if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;\r\n            document.addEventListener('click', (event) => {\r\n                const link = event.target.closest('a');\r\n                if (!link || link.target === '_blank' || link.hasAttribute('download')) return;\r\n                const href = link.getAttribute('href') || '';\r\n                if (href.startsWith('#') || href.startsWith('mailto:') || href.startsWith('tel:')) return;\r\n                if (event.metaKey || event.ctrlKey || event.shiftKey || event.altKey || event.button !== 0) return;\r\n                const url = new URL(link.href, window.location.href);\r\n                if (url.origin !== window.location.origin) return;\r\n                event.preventDefault();\r\n                document.body.classList.add('page-leave');\r\n                setTimeout(() => { window.location.href = link.href; }, 180);\r\n            });\r\n        };\r\n\r\n        const enableAutoRefresh = () => {\r\n            let lastInteraction = Date.now();\r\n            const mark = () => { lastInteraction = Date.now(); };\r\n            ['click', 'keydown', 'scroll', 'mousemove', 'touchstart'].forEach((evt) => {\r\n                document.addEventListener(evt, mark, { passive: true });\r\n            });\r\n            const intervalMs = 120000;\r\n            setInterval(() => {\r\n                if (document.hidden) return;\r\n                const active = document.activeElement;\r\n                if (active && ['INPUT', 'TEXTAREA', 'SELECT'].includes(active.tagName)) return;\r\n                if (Date.now() - lastInteraction < intervalMs) return;\r\n                window.location.reload();\r\n            }, intervalMs);\r\n        };\r\n\r\n        function toggleSidebar() {\r\n            const sidebar = document.getElementById('sidebar');\r\n            const overlay = document.getElementById('sidebar-overlay');\r\n            const isClosed = sidebar.classList.contains('-translate-x-full');\r\n            if (isClosed) { sidebar.classList.remove('-translate-x-full'); overlay.classList.remove('hidden'); }\r\n            else { sidebar.classList.add('-translate-x-full'); overlay.classList.add('hidden'); }\r\n        }\r\n\r\n        window.addEventListener('DOMContentLoaded', () => {\r\n            enablePageTransitions();\r\n            enableAutoRefresh();\r\n        });\r\n      </script>\r\n  </body>\r\n  </html>\r\n  `;\r\n}\r\n", "// src/ui/admin/settings.js\r\n\r\nexport function SettingsPageHTML(profile = {}, email = '') {\r\n    const p = profile || {};\r\n    \r\n    return `\r\n      <div class=\"max-w-2xl mx-auto space-y-8\">\r\n          \r\n          <div class=\"text-center mb-8\">\r\n              <h1 class=\"text-2xl font-bold text-gray-900\">Account Settings</h1>\r\n              <p class=\"text-sm text-gray-500 mt-1\">Manage your profile information and security.</p>\r\n          </div>\r\n\r\n          <div class=\"bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden\">\r\n              <div class=\"p-6 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center\">\r\n                  <h2 class=\"text-sm font-bold text-gray-800 uppercase tracking-wide\">Personal Information</h2>\r\n                  <span class=\"text-xs text-gray-400\">Admin ID: ${p.auth_id || '-'}</span>\r\n              </div>\r\n              \r\n              <div class=\"p-8\">\r\n                  <div class=\"flex flex-col items-center mb-8\">\r\n                      <div class=\"w-24 h-24 rounded-full bg-gray-900 text-white flex items-center justify-center text-3xl font-bold mb-4 ring-4 ring-gray-100\">\r\n                          ${(p.full_name || email || 'A').charAt(0).toUpperCase()}\r\n                      </div>\r\n                      <h3 class=\"text-lg font-bold text-gray-900\">${p.full_name || 'Admin User'}</h3>\r\n                      <p class=\"text-sm text-gray-500\">${email}</p>\r\n                  </div>\r\n\r\n                  <form onsubmit=\"updateProfile(event)\" class=\"space-y-5\">\r\n                      <div class=\"grid grid-cols-1 md:grid-cols-2 gap-5\">\r\n                          <div>\r\n                              <label class=\"block text-xs font-bold text-gray-500 uppercase mb-1.5\">Full Name</label>\r\n                              <input type=\"text\" name=\"full_name\" value=\"${p.full_name || ''}\" placeholder=\"Enter your name\" \r\n                                     class=\"w-full border border-gray-300 rounded-lg px-3 py-2.5 text-sm focus:ring-2 focus:ring-gray-900 focus:border-gray-900 outline-none transition-all\">\r\n                          </div>\r\n                          <div>\r\n                              <label class=\"block text-xs font-bold text-gray-500 uppercase mb-1.5\">Phone Number</label>\r\n                              <input type=\"text\" name=\"phone\" value=\"${p.phone || ''}\" placeholder=\"+880...\" \r\n                                     class=\"w-full border border-gray-300 rounded-lg px-3 py-2.5 text-sm focus:ring-2 focus:ring-gray-900 focus:border-gray-900 outline-none transition-all\">\r\n                          </div>\r\n                      </div>\r\n\r\n                      <div class=\"grid grid-cols-1 md:grid-cols-2 gap-5\">\r\n                          <div>\r\n                              <label class=\"block text-xs font-bold text-gray-500 uppercase mb-1.5\">Date of Birth</label>\r\n                              <input type=\"date\" name=\"dob\" value=\"${p.dob || ''}\" \r\n                                     class=\"w-full border border-gray-300 rounded-lg px-3 py-2.5 text-sm focus:ring-2 focus:ring-gray-900 focus:border-gray-900 outline-none transition-all\">\r\n                          </div>\r\n                          <div>\r\n                              <label class=\"block text-xs font-bold text-gray-500 uppercase mb-1.5\">Email (Read Only)</label>\r\n                              <input type=\"text\" value=\"${email}\" disabled \r\n                                     class=\"w-full border border-gray-200 bg-gray-50 text-gray-500 rounded-lg px-3 py-2.5 text-sm cursor-not-allowed\">\r\n                          </div>\r\n                      </div>\r\n\r\n                      <div class=\"pt-4 flex justify-end\">\r\n                          <button type=\"submit\" class=\"bg-gray-900 text-white px-6 py-2.5 rounded-lg text-sm font-bold hover:bg-black transition-transform active:scale-95 shadow-sm\">\r\n                              Save Changes\r\n                          </button>\r\n                      </div>\r\n                  </form>\r\n              </div>\r\n          </div>\r\n\r\n          <div class=\"bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden\">\r\n              <div class=\"p-6 border-b border-gray-100 bg-gray-50/50\">\r\n                  <h2 class=\"text-sm font-bold text-red-600 uppercase tracking-wide\">Security</h2>\r\n              </div>\r\n              <div class=\"p-8\">\r\n                  <form onsubmit=\"changePassword(event)\" class=\"space-y-5\">\r\n                      <div>\r\n                          <label class=\"block text-xs font-bold text-gray-500 uppercase mb-1.5\">New Password</label>\r\n                          <input type=\"password\" name=\"password\" required placeholder=\"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\" \r\n                                 class=\"w-full border border-gray-300 rounded-lg px-3 py-2.5 text-sm focus:ring-2 focus:ring-red-500 focus:border-red-500 outline-none\">\r\n                      </div>\r\n                      <div class=\"flex justify-end\">\r\n                          <button type=\"submit\" class=\"bg-white border border-gray-300 text-gray-700 px-6 py-2.5 rounded-lg text-sm font-bold hover:bg-gray-50 transition-colors\">\r\n                              Update Password\r\n                          </button>\r\n                      </div>\r\n                  </form>\r\n              </div>\r\n          </div>\r\n\r\n      </div>\r\n\r\n      <script>\r\n        async function updateProfile(e) {\r\n            e.preventDefault();\r\n            const btn = e.target.querySelector('button');\r\n            const originalText = btn.innerText;\r\n            btn.innerText = \"Saving...\";\r\n            \r\n            const formData = new FormData(e.target);\r\n            const data = Object.fromEntries(formData.entries());\r\n            data.action = 'update_profile';\r\n\r\n            try {\r\n                const res = await fetch('/admin/settings', {\r\n                    method: 'POST',\r\n                    headers: {'Content-Type': 'application/json'},\r\n                    body: JSON.stringify(data)\r\n                });\r\n                if(res.ok) alert(\"Profile updated successfully!\");\r\n                else alert(\"Error saving profile\");\r\n            } catch(e) { alert(\"Network error\"); }\r\n            finally { btn.innerText = originalText; }\r\n        }\r\n\r\n        async function changePassword(e) {\r\n            e.preventDefault();\r\n            if(!confirm(\"Are you sure you want to change your password?\")) return;\r\n            \r\n            const formData = new FormData(e.target);\r\n            const data = Object.fromEntries(formData.entries());\r\n            data.action = 'change_password';\r\n\r\n            try {\r\n                const res = await fetch('/admin/settings', {\r\n                    method: 'POST',\r\n                    headers: {'Content-Type': 'application/json'},\r\n                    body: JSON.stringify(data)\r\n                });\r\n                if(res.ok) { alert(\"Password changed!\"); e.target.reset(); }\r\n                else alert(\"Error changing password\");\r\n            } catch(e) { alert(\"Network error\"); }\r\n        }\r\n      </script>\r\n    `;\r\n}\r\n", "export function SchoolsPageHTML(schoolsList = []) {\r\n  const rows = schoolsList.map(school => `\r\n    <tr class=\"hover:bg-gray-50 transition-colors border-b border-gray-100 last:border-0 group\">\r\n        <td class=\"px-6 py-4 whitespace-nowrap\">\r\n            <div class=\"text-sm font-medium text-gray-900\">${school.school_name}</div>\r\n            <div class=\"text-xs text-gray-500 md:hidden\">EIIN: ${school.eiin_code || 'N/A'}</div>\r\n        </td>\r\n        <td class=\"px-6 py-4 whitespace-nowrap hidden md:table-cell text-sm text-gray-500\">${school.eiin_code || 'N/A'}</td>\r\n        <td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">${school.email}</td>\r\n        <td class=\"px-6 py-4 whitespace-nowrap\">\r\n            <span class=\"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800\">\r\n                Active\r\n            </span>\r\n        </td>\r\n        <td class=\"px-6 py-4 whitespace-nowrap text-right text-sm font-medium\">\r\n            <a href=\"/admin/school/view?id=${school.auth_id}\" class=\"text-blue-600 hover:text-blue-900 bg-blue-50 hover:bg-blue-100 px-3 py-1 rounded-md transition-colors\">\r\n                Manage\r\n            </a>\r\n        </td>\r\n    </tr>\r\n  `).join('');\r\n\r\n  const mobileCards = schoolsList.map(school => `\r\n    <div class=\"border border-gray-200 rounded-lg p-4 bg-white shadow-sm\">\r\n        <div class=\"flex items-start justify-between gap-3\">\r\n            <div>\r\n                <div class=\"text-sm font-semibold text-gray-900\">${school.school_name}</div>\r\n                <div class=\"text-xs text-gray-500 mt-1\">EIIN: ${school.eiin_code || 'N/A'}</div>\r\n                <div class=\"text-xs text-gray-500 mt-1\">${school.email}</div>\r\n            </div>\r\n            <span class=\"px-2 inline-flex text-[10px] leading-5 font-semibold rounded-full bg-green-100 text-green-800\">\r\n                Active\r\n            </span>\r\n        </div>\r\n        <div class=\"mt-3\">\r\n            <a href=\"/admin/school/view?id=${school.auth_id}\" class=\"inline-flex items-center text-xs font-semibold text-blue-600 bg-blue-50 hover:bg-blue-100 px-3 py-1 rounded\">\r\n                Manage\r\n            </a>\r\n        </div>\r\n    </div>\r\n  `).join('');\r\n\r\n  return `\r\n    <div class=\"space-y-6\">\r\n        \r\n        <div class=\"flex flex-col md:flex-row md:items-center justify-between gap-4\">\r\n            <div>\r\n                <h2 class=\"text-2xl font-bold text-gray-900\">Schools</h2>\r\n                <p class=\"text-sm text-gray-500 mt-1\">Manage all registered institutions.</p>\r\n            </div>\r\n            \r\n            <button onclick=\"toggleForm()\" id=\"add-btn\" class=\"w-full md:w-auto bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 flex items-center justify-center shadow-sm transition-all focus:ring-2 focus:ring-blue-200 text-sm\">\r\n                <svg class=\"w-5 h-5 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"></path></svg>\r\n                Add New School\r\n            </button>\r\n        </div>\r\n\r\n        <div id=\"list-view\" class=\"bg-white shadow-sm rounded-xl border border-gray-200 overflow-hidden\">\r\n            <div class=\"md:hidden space-y-3 p-4\">\r\n                ${mobileCards.length > 0 ? mobileCards : '<div class=\"py-10 text-center text-gray-500 text-sm\">No schools found.</div>'}\r\n            </div>\r\n            <div class=\"hidden md:block overflow-x-auto\">\r\n                <table class=\"min-w-full divide-y divide-gray-200\">\r\n                    <thead class=\"bg-gray-50\">\r\n                        <tr>\r\n                            <th scope=\"col\" class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">School Name</th>\r\n                            <th scope=\"col\" class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden md:table-cell\">EIIN Code</th>\r\n                            <th scope=\"col\" class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Admin Email</th>\r\n                            <th scope=\"col\" class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Status</th>\r\n                            <th scope=\"col\" class=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">Actions</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody class=\"bg-white divide-y divide-gray-200\">\r\n                        ${rows.length > 0 ? rows : '<tr><td colspan=\"5\" class=\"px-6 py-12 text-center text-gray-500\">No schools found. <br><span class=\"text-sm\">Click \"Add New School\" to create one.</span></td></tr>'}\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n        </div>\r\n\r\n        <div id=\"add-form\" class=\"hidden fixed inset-0 z-50 overflow-y-auto\" aria-labelledby=\"modal-title\" role=\"dialog\" aria-modal=\"true\">\r\n            <div class=\"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity\" onclick=\"toggleForm()\"></div>\r\n\r\n            <div class=\"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0\">\r\n                <div class=\"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-2xl\">\r\n                    \r\n                    <div class=\"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4\">\r\n                        <div class=\"sm:flex sm:items-start\">\r\n                            <div class=\"mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left w-full\">\r\n                                <h3 class=\"text-xl font-semibold leading-6 text-gray-900\" id=\"modal-title\">Register New Institution</h3>\r\n                                <div class=\"mt-4\">\r\n                                    <form onsubmit=\"createSchool(event)\" class=\"space-y-4\">\r\n                                        <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                                            <div class=\"col-span-2\">\r\n                                                <label class=\"block text-sm font-medium text-gray-700\">School Name</label>\r\n                                                <input type=\"text\" name=\"school_name\" required class=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm border p-2 focus:border-blue-500 focus:ring-blue-500 sm:text-sm\">\r\n                                            </div>\r\n                                            <div>\r\n                                                <label class=\"block text-sm font-medium text-gray-700\">EIIN Code</label>\r\n                                                <input type=\"text\" name=\"eiin\" class=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm border p-2 focus:border-blue-500 focus:ring-blue-500 sm:text-sm\">\r\n                                            </div>\r\n                                            <div>\r\n                                                <label class=\"block text-sm font-medium text-gray-700\">Address</label>\r\n                                                <input type=\"text\" name=\"address\" class=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm border p-2 focus:border-blue-500 focus:ring-blue-500 sm:text-sm\">\r\n                                            </div>\r\n\r\n                                            <div class=\"col-span-2 border-t pt-4 mt-2\">\r\n                                                <span class=\"text-xs font-bold text-gray-500 uppercase\">Admin Account</span>\r\n                                            </div>\r\n\r\n                                            <div>\r\n                                                <label class=\"block text-sm font-medium text-gray-700\">Email</label>\r\n                                                <input type=\"email\" name=\"email\" required class=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm border p-2 focus:border-blue-500 focus:ring-blue-500 sm:text-sm\">\r\n                                            </div>\r\n                                            <div>\r\n                                                <label class=\"block text-sm font-medium text-gray-700\">Password</label>\r\n                                                <input type=\"password\" name=\"password\" required class=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm border p-2 focus:border-blue-500 focus:ring-blue-500 sm:text-sm\">\r\n                                            </div>\r\n                                        </div>\r\n                                        \r\n                                        <div class=\"mt-6 sm:flex sm:flex-row-reverse\">\r\n                                            <button type=\"submit\" class=\"inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-500 sm:ml-3 sm:w-auto\">Create School</button>\r\n                                            <button type=\"button\" onclick=\"toggleForm()\" class=\"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto\">Cancel</button>\r\n                                        </div>\r\n                                    </form>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n    </div>\r\n\r\n    <script>\r\n        function toggleForm() {\r\n            const form = document.getElementById('add-form');\r\n            form.classList.toggle('hidden');\r\n        }\r\n\r\n        async function createSchool(e) {\r\n            e.preventDefault();\r\n            const btn = e.target.querySelector('button[type=\"submit\"]');\r\n            const originalText = btn.innerText;\r\n            btn.innerText = \"Creating...\";\r\n            btn.disabled = true;\r\n\r\n            const formData = new FormData(e.target);\r\n            const data = Object.fromEntries(formData.entries());\r\n\r\n            try {\r\n                const res = await fetch('/admin/schools', {\r\n                    method: 'POST',\r\n                    headers: { 'Content-Type': 'application/json' },\r\n                    body: JSON.stringify(data)\r\n                });\r\n\r\n                const result = await res.json();\r\n                \r\n                if (result.success) {\r\n                    window.location.reload(); \r\n                } else {\r\n                    alert(\"Error: \" + result.error);\r\n                    btn.innerText = originalText;\r\n                    btn.disabled = false;\r\n                }\r\n            } catch (err) {\r\n                alert(\"Network Error\");\r\n                btn.innerText = originalText;\r\n                btn.disabled = false;\r\n            }\r\n        }\r\n    </script>\r\n  `;\r\n}\r\n", "// src/ui/admin/school_detail.js\r\n\r\nexport function SchoolDetailHTML(school) {\r\n    return `\r\n      <div class=\"space-y-8\">\r\n          \r\n          <div class=\"border-b pb-6\">\r\n              <h1 class=\"text-3xl font-bold text-gray-900\">${school.school_name}</h1>\r\n              <div class=\"flex items-center gap-2 mt-2\">\r\n                  <span class=\"px-2 py-0.5 rounded text-xs font-semibold bg-blue-100 text-blue-800\">EIIN: ${school.eiin_code || 'N/A'}</span>\r\n                  <span class=\"text-sm text-gray-500\">Auth ID: ${school.auth_id}</span>\r\n              </div>\r\n          </div>\r\n          \r\n          <div class=\"bg-white rounded-xl border border-gray-200 shadow-sm p-6 grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n               <div>\r\n                 <p class=\"text-xs font-bold text-gray-400 uppercase\">Contact Email</p>\r\n                 <p class=\"text-gray-900\">${school.email}</p>\r\n               </div>\r\n               <div>\r\n                 <p class=\"text-xs font-bold text-gray-400 uppercase\">Address</p>\r\n                 <p class=\"text-gray-900\">${school.address || 'N/A'}</p>\r\n               </div>\r\n          </div>\r\n\r\n          <div>\r\n              <h3 class=\"font-bold text-gray-900 mb-4 text-lg\">Configuration</h3>\r\n              <div class=\"bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden divide-y divide-gray-100\">\r\n                  \r\n                  <a href=\"/admin/school/teachers?id=${school.auth_id}\" class=\"block hover:bg-gray-50 transition-colors p-4 group\">\r\n                      <div class=\"flex items-center justify-between\">\r\n                          <div class=\"flex items-center gap-4\">\r\n                              <div class=\"bg-purple-100 p-2 rounded-lg text-purple-600 group-hover:bg-purple-600 group-hover:text-white transition-colors\">\r\n                                  <svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z\"></path></svg>\r\n                              </div>\r\n                              <div>\r\n                                  <h4 class=\"font-bold text-gray-900\">Teachers</h4>\r\n                                  <p class=\"text-sm text-gray-500\">Set limits and view staff list</p>\r\n                              </div>\r\n                          </div>\r\n                          <svg class=\"w-5 h-5 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 5l7 7-7 7\"></path></svg>\r\n                      </div>\r\n                  </a>\r\n\r\n                  <a href=\"/admin/school/classes?id=${school.auth_id}\" class=\"block hover:bg-gray-50 transition-colors p-4 group\">\r\n                      <div class=\"flex items-center justify-between\">\r\n                          <div class=\"flex items-center gap-4\">\r\n                              <div class=\"bg-blue-100 p-2 rounded-lg text-blue-600 group-hover:bg-blue-600 group-hover:text-white transition-colors\">\r\n                                  <svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10\"></path></svg>\r\n                              </div>\r\n                              <div>\r\n                                  <h4 class=\"font-bold text-gray-900\">Classes & Sections</h4>\r\n                                  <p class=\"text-sm text-gray-500\">Hierarchy view and structure management</p>\r\n                              </div>\r\n                          </div>\r\n                          <svg class=\"w-5 h-5 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 5l7 7-7 7\"></path></svg>\r\n                      </div>\r\n                  </a>\r\n\r\n                  </div>\r\n          </div>\r\n      </div>\r\n    `;\r\n}", "// src/ui/admin/school_classes.js - MAIN ADMIN: Classes, Groups & Sections ONLY\n\nexport function SchoolClassesHTML(school, classesData = [], groupsData = [], sectionsData = []) {\n    \n    // Group data for easier access\n    const classGroups = {};\n    groupsData.forEach(g => {\n        if (!classGroups[g.class_id]) classGroups[g.class_id] = [];\n        classGroups[g.class_id].push(g);\n    });\n    \n    const classSections = {};\n    sectionsData.forEach(s => {\n        if (!classSections[s.class_id]) classSections[s.class_id] = [];\n        classSections[s.class_id].push(s);\n    });\n\n    // Build hierarchical display\n    const classHierarchy = classesData.map(cls => {\n        const groups = classGroups[cls.id] || [];\n        const sections = classSections[cls.id] || [];\n        \n        // Group sections by their group\n        const sectionsByGroup = {};\n        groups.forEach(g => {\n            sectionsByGroup[g.id] = {\n                group: g,\n                sections: sections.filter(s => s.group_id === g.id)\n            };\n        });\n        \n        // Sections without groups\n        const sectionsWithoutGroup = sections.filter(s => !s.group_id);\n\n        return `\n            <div class=\"mb-4 border border-gray-300\">\n                <!-- Class Header -->\n                <div class=\"bg-gray-100 px-3 py-2 border-b\">\n                    <div class=\"flex flex-col md:flex-row md:items-center md:justify-between gap-2\">\n                        <div class=\"flex items-center gap-2\">\n                            <span class=\"font-bold text-sm md:text-base\">${cls.class_name}</span>\n                            <span class=\"text-xs text-gray-500\">(${groups.length} groups, ${sections.length} sections)</span>\n                        </div>\n                        <div class=\"flex flex-col sm:flex-row sm:items-center gap-2\">\n                            ${cls.has_groups ? `\n                                <button onclick=\"openAddGroupModal(${cls.id}, '${cls.class_name}')\" class=\"text-xs bg-green-600 text-white px-2 py-1 hover-lift\">\n                                    + Add Group\n                                </button>\n                            ` : `\n                                <button onclick=\"openAddSectionModal(${cls.id}, '${cls.class_name}', ${cls.has_groups})\" class=\"text-xs bg-blue-600 text-white px-2 py-1 hover-lift\">\n                                    + Add Section\n                                </button>\n                            `}\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Groups and Sections -->\n                <div class=\"p-2\">\n                    ${groups.length > 0 ? `\n                        <div class=\"space-y-2\">\n                            ${groups.map(g => {\n                                const groupSections = sectionsByGroup[g.id]?.sections || [];\n                                \n                                return `\n                                    <div class=\"border-l-2 border-gray-400 pl-2\">\n                                        <div class=\"flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-1\">\n                                            <div class=\"flex flex-col sm:flex-row sm:items-center gap-2\">\n                                                <span class=\"font-semibold text-sm md:text-base\">${g.group_name}</span>\n                                                <span class=\"text-xs text-gray-500\">(${groupSections.length} sections)</span>\n                                            </div>\n                                            <div class=\"flex flex-col sm:flex-row sm:items-center gap-1\">\n                                                <button onclick=\"openAddSectionModalForGroup(${cls.id}, '${cls.class_name}', ${g.id}, '${g.group_name}')\" class=\"text-xs bg-blue-600 text-white px-2 py-1\">\n                                                    + Add Section\n                                                </button>\n                                                <button onclick=\"deleteGroup(${g.id})\" class=\"text-xs text-red-600\">\n                                                    Delete\n                                                </button>\n                                            </div>\n                                        </div>\n                                        <div class=\"flex flex-wrap gap-1\">\n                                            ${groupSections.map(s => `\n                                                <span class=\"border border-gray-300 px-2 py-1 text-sm\">\n                                                    ${s.section_name}\n                                                    <button onclick=\"deleteSection(${s.id})\" class=\"text-xs text-red-500 ml-1\">\u00D7</button>\n                                                </span>\n                                            `).join('')}\n                                        </div>\n                                    </div>\n                                `;\n                            }).join('')}\n                        </div>\n                    ` : ''}\n                    \n                    ${sectionsWithoutGroup.length > 0 ? `\n                        <div class=\"border-l-2 border-gray-400 pl-2\">\n                            <div class=\"mb-1\">\n                                <span class=\"font-semibold\">No Group</span>\n                                <span class=\"text-xs text-gray-500 ml-2\">(${sectionsWithoutGroup.length} sections)</span>\n                            </div>\n                            <div class=\"flex flex-wrap gap-1\">\n                                ${sectionsWithoutGroup.map(s => `\n                                    <span class=\"border border-gray-300 px-2 py-1 text-sm\">\n                                        ${s.section_name}\n                                        <button onclick=\"deleteSection(${s.id})\" class=\"text-xs text-red-500 ml-1\">\u00D7</button>\n                                    </span>\n                                `).join('')}\n                            </div>\n                        </div>\n                    ` : ''}\n                    \n                    ${groups.length === 0 && sectionsWithoutGroup.length === 0 ? `\n                        <div class=\"text-center py-4 text-gray-400 text-sm\">\n                            No groups or sections added yet\n                        </div>\n                    ` : ''}\n                </div>\n            </div>\n        `;\n    }).join('');\n\n    return `\n      <style>\n        /* Enhanced animations and transitions */\n        .btn-primary {\n          transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n          transform: translateY(0);\n        }\n        .btn-primary:hover {\n          transform: translateY(-1px);\n          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n        }\n        .btn-primary:active {\n          transform: translateY(0);\n          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n        }\n        \n        .section-badge {\n          transition: all 0.2s ease;\n        }\n        .section-badge:hover {\n          transform: scale(1.05);\n          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n        }\n        \n        /* Loading skeleton */\n        @keyframes shimmer {\n          0% { background-position: -200% 0; }\n          100% { background-position: 200% 0; }\n        }\n        .skeleton {\n          background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);\n          background-size: 200% 100%;\n          animation: shimmer 1.5s infinite;\n        }\n        \n        /* Success animations */\n        @keyframes slideInSuccess {\n          from {\n            opacity: 0;\n            transform: translateY(-10px);\n          }\n          to {\n            opacity: 1;\n            transform: translateY(0);\n          }\n        }\n        .success-message {\n          animation: slideInSuccess 0.3s ease-out;\n        }\n        \n        /* Smooth focus states */\n        input:focus, select:focus, textarea:focus {\n          outline: none;\n          border-color: #3b82f6;\n          box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);\n          transition: all 0.2s ease;\n        }\n        \n        /* Hover states for interactive elements */\n        .hover-lift {\n          transition: transform 0.2s ease, box-shadow 0.2s ease;\n        }\n        .hover-lift:hover {\n          transform: translateY(-2px);\n          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n        }\n        \n        /* Mobile responsive design */\n        @media (max-width: 768px) {\n          .class-header {\n            flex-direction: column;\n            align-items: flex-start;\n            gap: 8px;\n          }\n          \n          .class-header button {\n            width: 100%;\n            justify-content: center;\n          }\n          \n          .group-header {\n            flex-direction: column;\n            align-items: flex-start;\n            gap: 8px;\n          }\n          \n          .group-header button {\n            width: 100%;\n            justify-content: center;\n          }\n        }\n        \n        /* Prevent zoom on input focus */\n        input, select, textarea {\n          font-size: 16px !important;\n        }\n      </style>\n      \n      <div>\n         <div class=\"flex items-center gap-2 text-sm text-gray-500 mb-6\">\n            <a href=\"/admin/school/view?id=${school.auth_id}\" class=\"hover:text-blue-600\">Back to Menu</a>\n            <span>/</span>\n            <span class=\"text-gray-900 font-bold\">Classes & Sections</span>\n         </div>\n\n         <div class=\"mb-4\">\n             <form onsubmit=\"createClass(event)\" class=\"border border-gray-300 p-3\">\n                 <div class=\"flex flex-col md:flex-row gap-2 items-end\">\n                     <div class=\"flex-1\">\n                         <input type=\"text\" name=\"class_name\" placeholder=\"Class Name (e.g. Class 10)\" required class=\"w-full border border-gray-300 px-2 py-1 text-sm\">\n                     </div>\n                     <div class=\"flex items-center gap-1\">\n                         <input type=\"checkbox\" name=\"has_groups\" id=\"has_groups\">\n                         <label for=\"has_groups\" class=\"text-sm\">Has Groups</label>\n                     </div>\n                     <button type=\"submit\" class=\"bg-gray-800 text-white px-3 py-1 text-sm\">\n                         Create Class\n                     </button>\n                 </div>\n             </form>\n         </div>\n\n         <div class=\"space-y-4\">\n             ${classHierarchy.length > 0 ? classHierarchy : `\n                 <div class=\"bg-white border border-gray-200 rounded-lg p-8 text-center\">\n                     <p class=\"text-gray-400\">No classes found</p>\n                 </div>\n             `}\n         </div>\n      </div>\n\n      <!-- Add Group Modal -->\n      <div id=\"addGroupModal\" class=\"fixed inset-0 bg-black/60 z-[9999] hidden flex items-center justify-center px-4\">\n          <div class=\"bg-white border border-gray-300 w-full max-w-md p-4 relative\">\n              <h3 class=\"font-bold mb-3\">Add Group</h3>\n              <form onsubmit=\"addGroup(event)\">\n                  <input type=\"hidden\" name=\"class_id\" id=\"group_class_id\">\n                  <div class=\"mb-3\">\n                      <input type=\"text\" name=\"group_name\" required class=\"w-full border border-gray-300 px-2 py-1\" placeholder=\"e.g. Science, Arts\">\n                  </div>\n                  <div class=\"flex gap-2\">\n                      <button type=\"submit\" class=\"bg-green-600 text-white px-3 py-1 text-sm\" id=\"addGroupBtn\">Add Group</button>\n                      <button type=\"button\" onclick=\"closeModal('addGroupModal')\" class=\"bg-gray-200 text-gray-800 px-3 py-1 text-sm\">Cancel</button>\n                  </div>\n              </form>\n          </div>\n      </div>\n\n      <!-- Add Section Modal -->\n      <div id=\"addSectionModal\" class=\"fixed inset-0 bg-black/60 z-[9999] hidden flex items-center justify-center px-4\">\n          <div class=\"bg-white border border-gray-300 w-full max-w-md p-4 relative\">\n              <h3 class=\"font-bold mb-3\">Add Section</h3>\n              <form onsubmit=\"addSection(event)\">\n                  <input type=\"hidden\" name=\"class_id\" id=\"section_class_id\">\n                  <input type=\"hidden\" name=\"group_id\" id=\"section_group_id\">\n                  \n                  <div class=\"mb-3\">\n                      <input type=\"text\" name=\"section_name\" required class=\"w-full border border-gray-300 px-2 py-1\" placeholder=\"e.g. A, B\">\n                  </div>\n                  \n                  <div class=\"flex gap-2\">\n                      <button type=\"submit\" class=\"bg-blue-600 text-white px-3 py-1 text-sm\" id=\"addSectionBtn\">Add Section</button>\n                      <button type=\"button\" onclick=\"closeModal('addSectionModal')\" class=\"bg-gray-200 text-gray-800 px-3 py-1 text-sm\">Cancel</button>\n                  </div>\n              </form>\n          </div>\n      </div>\n\n      <script>\n        const SCHOOL_ID = ${school.id};\n        const CLASS_GROUPS = ${JSON.stringify(classGroups)};\n\n        function createClass(e) {\n            e.preventDefault();\n            const submitBtn = e.target.querySelector('button[type=\"submit\"]');\n            if (submitBtn.disabled) return; // Prevent multiple submissions\n            \n            submitBtn.disabled = true;\n            submitBtn.textContent = 'Creating...';\n            \n            const formData = new FormData(e.target);\n            const data = Object.fromEntries(formData.entries());\n            data.action = 'create_class';\n            data.school_id = SCHOOL_ID;\n            data.has_groups = formData.has('has_groups');\n\n            fetch('/admin/school/classes', {\n                method: 'POST',\n                headers: {'Content-Type': 'application/json'},\n                body: JSON.stringify(data)\n            }).then(res => res.json()).then(response => {\n                if(response.success) {\n                    window.location.reload();\n                } else {\n                    showToast('Error creating class: ' + (response.error || 'Unknown error'), 'error');\n                    submitBtn.disabled = false;\n                    submitBtn.textContent = 'Create Class';\n                }\n            }).catch(error => {\n                console.error('Network error:', error);\n                showToast('Network error. Please check your connection and try again.', 'error');\n                submitBtn.disabled = false;\n                submitBtn.textContent = 'Create Class';\n            });\n        }\n\n        function openAddGroupModal(classId, className) {\n            document.getElementById('group_class_id').value = classId;\n            openModal('addGroupModal');\n            setTimeout(() => {\n                document.querySelector('#addGroupModal input[name=\"group_name\"]').focus();\n            }, 100);\n        }\n\n        function openAddSectionModalForGroup(classId, className, groupId, groupName) {\n            document.getElementById('section_class_id').value = classId;\n            document.getElementById('section_group_id').value = groupId;\n            openModal('addSectionModal');\n            setTimeout(() => {\n                document.querySelector('#addSectionModal input[name=\"section_name\"]').focus();\n            }, 100);\n        }\n\n        function openAddSectionModal(classId, className, hasGroups) {\n            document.getElementById('section_class_id').value = classId;\n            document.getElementById('section_group_id').value = '';\n            openModal('addSectionModal');\n            setTimeout(() => {\n                document.querySelector('#addSectionModal input[name=\"section_name\"]').focus();\n            }, 100);\n        }\n\n        function addGroup(e) {\n            e.preventDefault();\n            const submitBtn = document.getElementById('addGroupBtn');\n            if (submitBtn.disabled) return; // Prevent multiple submissions\n            \n            submitBtn.disabled = true;\n            submitBtn.textContent = 'Adding...';\n            \n            const formData = new FormData(e.target);\n            const data = Object.fromEntries(formData.entries());\n            data.action = 'add_group';\n            data.school_id = SCHOOL_ID;\n\n            fetch('/admin/school/classes', {\n                method: 'POST',\n                headers: {'Content-Type': 'application/json'},\n                body: JSON.stringify(data)\n            }).then(res => res.json()).then(response => {\n                if(response.success) {\n                    window.location.reload();\n                } else {\n                    showToast('Error adding group: ' + (response.error || 'Unknown error'), 'error');\n                    submitBtn.disabled = false;\n                    submitBtn.textContent = 'Add Group';\n                }\n            }).catch(error => {\n                console.error('Network error:', error);\n                showToast('Network error. Please check your connection and try again.', 'error');\n                submitBtn.disabled = false;\n                submitBtn.textContent = 'Add Group';\n            });\n        }\n\n        function addSection(e) {\n            e.preventDefault();\n            const submitBtn = document.getElementById('addSectionBtn');\n            if (submitBtn.disabled) return; // Prevent multiple submissions\n            \n            submitBtn.disabled = true;\n            submitBtn.textContent = 'Adding...';\n            \n            const formData = new FormData(e.target);\n            const data = Object.fromEntries(formData.entries());\n            data.action = 'add_section';\n            data.school_id = SCHOOL_ID;\n\n            fetch('/admin/school/classes', {\n                method: 'POST',\n                headers: {'Content-Type': 'application/json'},\n                body: JSON.stringify(data)\n            }).then(res => res.json()).then(response => {\n                if(response.success) {\n                    window.location.reload();\n                } else {\n                    showToast('Error adding section: ' + (response.error || 'Unknown error'), 'error');\n                    submitBtn.disabled = false;\n                    submitBtn.textContent = 'Add Section';\n                }\n            }).catch(error => {\n                console.error('Network error:', error);\n                showToast('Network error. Please check your connection and try again.', 'error');\n                submitBtn.disabled = false;\n                submitBtn.textContent = 'Add Section';\n            });\n        }\n\n        function deleteGroup(id) {\n            if(!confirm(\"Delete this group and all its sections?\")) return;\n            \n            fetch('/admin/school/classes', {\n                method: 'DELETE',\n                headers: {'Content-Type': 'application/json'},\n                body: JSON.stringify({action: 'delete_group', id: id})\n            }).then(res => res.json()).then(response => {\n                if(response.success) {\n                    window.location.reload();\n                } else {\n                    showToast('Error deleting group: ' + (response.error || 'Unknown error'), 'error');\n                }\n            }).catch(error => {\n                console.error('Network error:', error);\n                showToast('Network error. Please check your connection and try again.', 'error');\n            });\n        }\n\n        function deleteSection(id) {\n            if(!confirm(\"Delete this section?\")) return;\n            \n            fetch('/admin/school/classes', {\n                method: 'DELETE',\n                headers: {'Content-Type': 'application/json'},\n                body: JSON.stringify({action: 'delete_section', id: id})\n            }).then(res => res.json()).then(response => {\n                if(response.success) {\n                    window.location.reload();\n                } else {\n                    showToast('Error deleting section: ' + (response.error || 'Unknown error'), 'error');\n                }\n            }).catch(error => {\n                console.error('Network error:', error);\n                showToast('Network error. Please check your connection and try again.', 'error');\n            });\n        }\n\n        // Modal management\n        function openModal(modalId) {\n            document.getElementById(modalId).classList.remove('hidden');\n            document.body.style.overflow = 'hidden';\n        }\n\n        function closeModal(modalId) {\n            document.getElementById(modalId).classList.add('hidden');\n            document.body.style.overflow = '';\n            const modal = document.getElementById(modalId);\n            const submitBtn = modal.querySelector('button[type=\"submit\"]');\n            if (submitBtn) {\n                submitBtn.disabled = false;\n                submitBtn.textContent = submitBtn.id === 'addGroupBtn' ? 'Add Group' : 'Add Section';\n            }\n            modal.querySelector('form').reset();\n        }\n\n        // Close modal on Escape key\n        document.addEventListener('keydown', function(e) {\n            if (e.key === 'Escape') {\n                const modals = document.querySelectorAll('.fixed.inset-0');\n                modals.forEach(modal => {\n                    if (!modal.classList.contains('hidden')) {\n                        closeModal(modal.id);\n                    }\n                });\n            }\n        });\n\n        // Close modal on background click\n        document.addEventListener('click', function(e) {\n            if (e.target.classList.contains('fixed') && e.target.classList.contains('inset-0')) {\n                closeModal(e.target.id);\n            }\n        });\n\n        // Toast notification system\n        function showToast(message, type = 'success') {\n            const toast = document.createElement('div');\n            const bgColor = type === 'success' ? 'bg-green-600' : \n                          type === 'error' ? 'bg-red-600' : \n                          type === 'info' ? 'bg-blue-600' : 'bg-gray-600';\n            \n            toast.className = 'fixed top-4 right-4 px-4 py-2 rounded-lg text-white z-[10000] success-message ' + bgColor;\n            toast.textContent = message;\n            document.body.appendChild(toast);\n            \n            setTimeout(() => {\n                toast.style.opacity = '0';\n                setTimeout(() => toast.remove(), 300);\n            }, 3000);\n        }\n\n        // Keyboard shortcuts\n        document.addEventListener('keydown', function(e) {\n            if ((e.ctrlKey || e.metaKey) && e.key === 'n') {\n                e.preventDefault();\n                document.querySelector('input[name=\"class_name\"]').focus();\n            }\n        });\n      </script>\n    `;\n}\n", "// src/ui/admin/school_teachers.js\r\n\r\nexport function SchoolTeachersHTML(school, teachers = []) {\r\n    return `\r\n      <div>\r\n         <div class=\"flex items-center gap-2 text-sm text-gray-500 mb-6\">\r\n            <a href=\"/admin/school/view?id=${school.auth_id}\" class=\"hover:text-blue-600\">Back to Menu</a>\r\n            <span>/</span>\r\n            <span class=\"text-gray-900 font-bold\">Teacher Management</span>\r\n         </div>\r\n\r\n         <div class=\"bg-purple-50 border border-purple-200 rounded-xl p-4 mb-6 flex flex-col md:flex-row justify-between items-start md:items-center gap-4\">\r\n             <div>\r\n                 <h2 class=\"text-purple-900 font-bold text-lg\">Teacher Limit Control</h2>\r\n                 <p class=\"text-purple-700 text-sm\">Enforce limits based on payment plan.</p>\r\n             </div>\r\n             <form onsubmit=\"updateLimit(event)\" class=\"flex flex-col sm:flex-row items-stretch sm:items-center gap-2 w-full md:w-auto\">\r\n                 <div class=\"bg-white border border-purple-200 rounded px-3 py-2 text-sm w-full sm:w-auto\">\r\n                    <span class=\"text-gray-500 mr-2\">Max Allowed:</span>\r\n                    <input type=\"number\" name=\"max_teachers\" value=\"${school.max_teachers || 10}\" class=\"w-16 font-bold text-center outline-none\">\r\n                 </div>\r\n                 <button type=\"submit\" class=\"bg-purple-600 text-white px-4 py-2 rounded text-sm font-bold hover:bg-purple-700 w-full sm:w-auto\">Save Limit</button>\r\n             </form>\r\n         </div>\r\n\r\n         <div class=\"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden\">\r\n             <div class=\"bg-gray-50 px-4 py-3 border-b border-gray-200 flex flex-col sm:flex-row justify-between sm:items-center gap-2\">\r\n                 <h3 class=\"font-bold text-gray-700\">Registered Teachers</h3>\r\n                 <span class=\"text-xs bg-gray-200 text-gray-700 px-2 py-1 rounded-full\">\r\n                    Count: ${teachers.length} / ${school.max_teachers || 10}\r\n                 </span>\r\n             </div>\r\n             <div class=\"md:hidden p-4 space-y-3\">\r\n                ${teachers.map(t => `\r\n                    <div class=\"border border-gray-200 rounded-lg p-3\">\r\n                        <div class=\"flex items-start justify-between gap-3\">\r\n                            <div>\r\n                                <div class=\"text-sm font-semibold text-gray-900\">${t.full_name}</div>\r\n                                <div class=\"text-xs text-gray-500\">${t.email || '-'}</div>\r\n                            </div>\r\n                            <span class=\"bg-blue-50 text-blue-700 px-2 py-1 rounded text-[10px]\">${t.subject || '-'}</span>\r\n                        </div>\r\n                        <div class=\"text-xs font-mono text-gray-600 mt-2\">${t.phone || '-'}</div>\r\n                    </div>\r\n                `).join('')}\r\n                ${teachers.length === 0 ? '<div class=\"py-6 text-center text-gray-400 text-sm\">No teachers added yet.</div>' : ''}\r\n             </div>\r\n             <div class=\"hidden md:block overflow-x-auto\">\r\n                 <table class=\"min-w-full divide-y divide-gray-200\">\r\n                     <thead class=\"bg-gray-50\">\r\n                        <tr>\r\n                            <th class=\"px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase\">Name & Email</th>\r\n                            <th class=\"px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase\">Subject</th>\r\n                            <th class=\"px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase\">Phone</th>\r\n                        </tr>\r\n                     </thead>\r\n                     <tbody class=\"bg-white divide-y divide-gray-200\">\r\n                        ${teachers.map(t => `\r\n                            <tr>\r\n                                <td class=\"px-6 py-4 whitespace-nowrap\">\r\n                                    <div class=\"text-sm font-bold text-gray-900\">${t.full_name}</div>\r\n                                    <div class=\"text-xs text-gray-500\">${t.email || '-'}</div>\r\n                                </td>\r\n                                <td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                                    <span class=\"bg-blue-50 text-blue-700 px-2 py-1 rounded text-xs\">${t.subject || '-'}</span>\r\n                                </td>\r\n                                <td class=\"px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-600\">\r\n                                    ${t.phone || '-'}\r\n                                </td>\r\n                            </tr>\r\n                        `).join('')}\r\n                        ${teachers.length === 0 ? '<tr><td colspan=\"3\" class=\"px-6 py-4 text-center text-gray-400\">No teachers added yet.</td></tr>' : ''}\r\n                     </tbody>\r\n                 </table>\r\n             </div>\r\n         </div>\r\n      </div>\r\n\r\n      <script>\r\n        async function updateLimit(e) {\r\n            e.preventDefault();\r\n            const form = new FormData(e.target);\r\n            const val = form.get('max_teachers');\r\n            \r\n            try {\r\n                const res = await fetch('/admin/school/teachers', {\r\n                    method: 'POST',\r\n                    headers: {'Content-Type': 'application/json'},\r\n                    body: JSON.stringify({ \r\n                        action: 'update_limit', \r\n                        school_id: ${school.id}, \r\n                        max_val: val \r\n                    })\r\n                });\r\n                if(res.ok) alert(\"Limit Updated!\");\r\n                else alert(\"Error\");\r\n            } catch(e) { alert(\"Network Error\"); }\r\n        }\r\n      </script>\r\n    `;\r\n}\r\n", "export const ROLES = {\r\n    ADMIN: 'admin',\r\n    INSTITUTE: 'institute',  // <--- ensuring this is lowercase 'institute'\r\n    TEACHER: 'teacher',\r\n    STUDENT: 'student'\r\n};\r\n\r\nexport const SITE_CONFIG = {\r\n    NAME: 'RoutineAI',\r\n    VERSION: '1.0.0'\r\n};", "// src/core/schema_manager.js\r\n\r\n// 1. THE DEFINITION\r\nconst DEFINED_SCHEMA = {\r\n  \r\n  auth_accounts: {\r\n    id: \"INTEGER PRIMARY KEY AUTOINCREMENT\",\r\n    email: \"TEXT UNIQUE NOT NULL\",\r\n    password_hash: \"TEXT NOT NULL\",\r\n    salt: \"TEXT NOT NULL\",\r\n    role: \"TEXT NOT NULL\",\r\n    is_active: \"BOOLEAN DEFAULT 1\",\r\n    created_at: \"TIMESTAMP DEFAULT CURRENT_TIMESTAMP\"\r\n  },\r\n\r\n  profiles_institution: {\r\n    id: \"INTEGER PRIMARY KEY AUTOINCREMENT\",\r\n    auth_id: \"INTEGER\",\r\n    school_name: \"TEXT\",\r\n    eiin_code: \"TEXT\",\r\n    address: \"TEXT\", \r\n    max_teachers: \"INTEGER DEFAULT 10\", \r\n    \"FOREIGN KEY(auth_id)\": \"REFERENCES auth_accounts(id)\" \r\n  },\r\n\r\n  profiles_admin: {\r\n    id: \"INTEGER PRIMARY KEY AUTOINCREMENT\",\r\n    auth_id: \"INTEGER\",\r\n    full_name: \"TEXT\",\r\n    phone: \"TEXT\",\r\n    dob: \"DATE\",\r\n    \"FOREIGN KEY(auth_id)\": \"REFERENCES auth_accounts(id)\"\r\n  },\r\n\r\n  profiles_teacher: {\r\n    id: \"INTEGER PRIMARY KEY AUTOINCREMENT\",\r\n    auth_id: \"INTEGER\",\r\n    school_id: \"INTEGER\",\r\n    full_name: \"TEXT\",\r\n    subject: \"TEXT\", // Keep for backward compatibility\r\n    email: \"TEXT\",\r\n    phone: \"TEXT\",\r\n    \"FOREIGN KEY(auth_id)\": \"REFERENCES auth_accounts(id)\"\r\n  },\r\n\r\n  // --- TEACHER SUBJECT ASSIGNMENTS ---\r\n  teacher_subjects: {\r\n    id: \"INTEGER PRIMARY KEY AUTOINCREMENT\",\r\n    school_id: \"INTEGER\",\r\n    teacher_id: \"INTEGER\",\r\n    subject_id: \"INTEGER\",\r\n    is_primary: \"BOOLEAN DEFAULT 0\", // Main subject vs additional subjects\r\n    \"FOREIGN KEY(school_id)\": \"REFERENCES profiles_institution(id)\",\r\n    \"FOREIGN KEY(teacher_id)\": \"REFERENCES profiles_teacher(id)\",\r\n    \"FOREIGN KEY(subject_id)\": \"REFERENCES academic_subjects(id)\"\r\n  },\r\n\r\n  academic_classes: {\r\n    id: \"INTEGER PRIMARY KEY AUTOINCREMENT\",\r\n    school_id: \"INTEGER\",\r\n    class_name: \"TEXT\",\r\n    has_groups: \"INTEGER DEFAULT 0\", // 0 = no groups, 1 = has groups\r\n    \"FOREIGN KEY(school_id)\": \"REFERENCES profiles_institution(id)\"\r\n  },\r\n\r\n  class_groups: {\r\n    id: \"INTEGER PRIMARY KEY AUTOINCREMENT\",\r\n    school_id: \"INTEGER\",\r\n    class_id: \"INTEGER\",\r\n    group_name: \"TEXT\",\r\n    \"FOREIGN KEY(school_id)\": \"REFERENCES profiles_institution(id)\",\r\n    \"FOREIGN KEY(class_id)\": \"REFERENCES academic_classes(id)\"\r\n  },\r\n\r\n  class_sections: {\r\n    id: \"INTEGER PRIMARY KEY AUTOINCREMENT\",\r\n    school_id: \"INTEGER\",\r\n    class_id: \"INTEGER\",\r\n    group_id: \"INTEGER\", // null if class has no groups\r\n    section_name: \"TEXT\",\r\n    \"FOREIGN KEY(school_id)\": \"REFERENCES profiles_institution(id)\",\r\n    \"FOREIGN KEY(class_id)\": \"REFERENCES academic_classes(id)\",\r\n    \"FOREIGN KEY(group_id)\": \"REFERENCES class_groups(id)\"\r\n  },\r\n\r\n  academic_subjects: {\r\n    id: \"INTEGER PRIMARY KEY AUTOINCREMENT\",\r\n    school_id: \"INTEGER\",\r\n    subject_name: \"TEXT\" \r\n  },\r\n\r\n  // --- SUBJECT ASSIGNMENT TABLES ---\r\n  class_subjects: {\r\n    id: \"INTEGER PRIMARY KEY AUTOINCREMENT\",\r\n    school_id: \"INTEGER\",\r\n    class_id: \"INTEGER\",\r\n    subject_id: \"INTEGER\",\r\n    classes_per_week: \"INTEGER\", // Actual number of classes assigned\r\n    min_classes: \"INTEGER\", // Minimum required classes per week\r\n    max_classes: \"INTEGER\", // Maximum allowed classes per week\r\n    \"FOREIGN KEY(school_id)\": \"REFERENCES profiles_institution(id)\",\r\n    \"FOREIGN KEY(class_id)\": \"REFERENCES academic_classes(id)\",\r\n    \"FOREIGN KEY(subject_id)\": \"REFERENCES academic_subjects(id)\"\r\n  },\r\n\r\n  group_subjects: {\r\n    id: \"INTEGER PRIMARY KEY AUTOINCREMENT\",\r\n    school_id: \"INTEGER\",\r\n    group_id: \"INTEGER\",\r\n    subject_id: \"INTEGER\",\r\n    classes_per_week: \"INTEGER\", // Actual number of classes assigned\r\n    min_classes: \"INTEGER\", // Minimum required classes per week\r\n    max_classes: \"INTEGER\", // Maximum allowed classes per week\r\n    \"FOREIGN KEY(school_id)\": \"REFERENCES profiles_institution(id)\",\r\n    \"FOREIGN KEY(group_id)\": \"REFERENCES class_groups(id)\",\r\n    \"FOREIGN KEY(subject_id)\": \"REFERENCES academic_subjects(id)\"\r\n  },\r\n\r\n  // --- SIMPLIFIED SCHEDULE CONFIGURATION ---\r\n  schedule_config: {\r\n    id: \"INTEGER PRIMARY KEY AUTOINCREMENT\",\r\n    school_id: \"INTEGER UNIQUE\", // One config per school\r\n    strategy: \"TEXT\", // Keep for backward compatibility\r\n    shifts_json: \"TEXT\", // Keep for backward compatibility  \r\n    start_time: \"TEXT DEFAULT '08:00'\", // School start time\r\n    active_days: \"INTEGER DEFAULT 5\", // Keep for backward compatibility\r\n    periods_per_day: \"INTEGER DEFAULT 8\", // Keep for backward compatibility\r\n    // New working days fields\r\n    working_days: \"TEXT DEFAULT '[\\\"monday\\\",\\\"tuesday\\\",\\\"wednesday\\\",\\\"thursday\\\",\\\"friday\\\"]'\", // JSON array of working days\r\n    off_days: \"TEXT DEFAULT '[\\\"saturday\\\",\\\"sunday\\\"]'\" // JSON array of off days\r\n  },\r\n\r\n  schedule_slots: {\r\n    id: \"INTEGER PRIMARY KEY AUTOINCREMENT\",\r\n    school_id: \"INTEGER\",\r\n    slot_index: \"INTEGER\", // Keep for backward compatibility\r\n    start_time: \"TEXT\", // \"08:00\"\r\n    end_time: \"TEXT\",   // \"08:45\"\r\n    duration: \"INTEGER\", // Duration in minutes\r\n    type: \"TEXT\",       // 'class', 'break'\r\n    label: \"TEXT\",      // \"1st Period\", \"Tiffin\"\r\n    applicable_shifts: \"TEXT\", // Keep for backward compatibility\r\n    \"FOREIGN KEY(school_id)\": \"REFERENCES profiles_institution(id)\"\r\n  },\r\n\r\n  system_settings: {\r\n    key: \"TEXT PRIMARY KEY\",\r\n    value: \"TEXT\"\r\n  }\r\n};\r\n\r\n// 2. THE SYNC LOGIC\r\nexport async function syncDatabase(env) {\r\n  const report = []; \r\n  const existingTablesResult = await env.DB.prepare(\"PRAGMA table_list\").all();\r\n  const existingTables = existingTablesResult.results.map(t => t.name).filter(n => !n.startsWith(\"_\") && !n.startsWith(\"sqlite\") && !n.startsWith(\"d1\"));\r\n\r\n  for (const [tableName, columns] of Object.entries(DEFINED_SCHEMA)) {\r\n    if (!existingTables.includes(tableName)) {\r\n      await createTable(env, tableName, columns);\r\n      report.push(`Created table: ${tableName}`);\r\n    } else {\r\n      await syncColumns(env, tableName, columns, report);\r\n    }\r\n  }\r\n\r\n  for (const existingTable of existingTables) {\r\n    if (!DEFINED_SCHEMA[existingTable]) {\r\n      try { await env.DB.prepare(`DROP TABLE \"${existingTable}\"`).run(); } catch(e) {}\r\n    }\r\n  }\r\n  return report;\r\n}\r\n\r\nasync function createTable(env, tableName, columns) {\r\n  const colDefs = Object.entries(columns).map(([colName, colType]) => {\r\n    if (colName.includes(\" \")) return `${colName} ${colType}`; \r\n    return `\"${colName}\" ${colType}`;\r\n  }).join(\", \");\r\n  await env.DB.prepare(`CREATE TABLE IF NOT EXISTS \"${tableName}\" (${colDefs});`).run();\r\n}\r\n\r\nasync function syncColumns(env, tableName, schemaColumns, report) {\r\n  const dbColsResult = await env.DB.prepare(`PRAGMA table_info(\"${tableName}\")`).all();\r\n  const dbColNames = dbColsResult.results.map(c => c.name);\r\n  for (const [colName, colType] of Object.entries(schemaColumns)) {\r\n    if (colName.includes(\" \")) continue; \r\n    if (!dbColNames.includes(colName)) {\r\n        try { await env.DB.prepare(`ALTER TABLE \"${tableName}\" ADD COLUMN \"${colName}\" ${colType}`).run(); } catch (e) {}\r\n    }\r\n  }\r\n}\r\n", "import { htmlResponse, jsonResponse, getCookie } from '../core/utils.js';\r\nimport { InstituteLayout } from '../ui/institute/layout.js';\r\nimport { InstituteDashboardHTML } from '../ui/institute/dashboard.js';\r\nimport { TeachersPageHTML } from '../ui/institute/teachers.js'; \r\nimport { ClassesPageHTML } from '../ui/institute/classes.js'; \r\nimport { SubjectsPageHTML } from '../ui/institute/subjects.js'; \r\nimport { SchedulesPageHTML } from '../ui/institute/schedules.js'; \r\nimport { syncDatabase } from '../core/schema_manager.js';\r\n\r\nexport async function handleInstituteRequest(request, env) {\r\n  const url = new URL(request.url);\r\n  const email = getCookie(request, 'user_email');\r\n  if (!email) return htmlResponse(\"<h1>Login Failed</h1>\");\r\n\r\n  const school = await env.DB.prepare(`SELECT p.* FROM profiles_institution p JOIN auth_accounts a ON p.auth_id = a.id WHERE a.email = ?`).bind(email).first();\r\n  if(!school) return new Response(\"Error\", {status: 404});\r\n\r\n  // --- DASHBOARD ---\r\n  if (url.pathname === '/school/dashboard') {\r\n    const tCount = await env.DB.prepare(\"SELECT count(*) as count FROM profiles_teacher WHERE school_id = ?\").bind(school.id).first();\r\n    const cCount = await env.DB.prepare(\"SELECT count(*) as count FROM academic_classes WHERE school_id = ?\").bind(school.id).first();\r\n    return htmlResponse(InstituteLayout(InstituteDashboardHTML({teachers: tCount.count, classes: cCount.count}), \"Dashboard\", school.school_name));\r\n  }\r\n\r\n  // --- MASTER SCHEDULE ---\r\n  if (url.pathname === '/school/schedules') {\r\n      \r\n      if (request.method === 'POST') {\r\n          try {\r\n              const body = await request.json();\r\n              if(body.action === 'save_schedule') {\r\n                  // Clear existing slots\r\n                  await env.DB.prepare(\"DELETE FROM schedule_slots WHERE school_id = ?\").bind(school.id).run();\r\n                  \r\n                  // Insert new slots with proper slot_index\r\n                  for(let i = 0; i < body.slots.length; i++) {\r\n                      const slot = body.slots[i];\r\n                      await env.DB.prepare(\"INSERT INTO schedule_slots (school_id, slot_index, start_time, end_time, label, duration, type, applicable_shifts) VALUES (?, ?, ?, ?, ?, ?, ?, ?)\")\r\n                          .bind(school.id, i, slot.start_time, slot.end_time, slot.label, slot.duration, slot.type, JSON.stringify([\"all\"])).run();\r\n                  }\r\n                  \r\n                  // Update working days in schedule config\r\n                  const workingDays = JSON.stringify(body.working_days || [\"monday\",\"tuesday\",\"wednesday\",\"thursday\",\"friday\"]);\r\n                  const allDays = [\"monday\",\"tuesday\",\"wednesday\",\"thursday\",\"friday\",\"saturday\",\"sunday\"];\r\n                  const offDays = JSON.stringify(allDays.filter(day => !body.working_days?.includes(day)));\r\n                  const workingDaysCount = body.working_days?.length || 5;\r\n                  \r\n                  // Update both fields for consistency\r\n                  await env.DB.prepare(\"UPDATE schedule_config SET working_days = ?, off_days = ?, active_days = ? WHERE school_id = ?\")\r\n                      .bind(workingDays, offDays, workingDaysCount, school.id).run();\r\n              }\r\n              return jsonResponse({ success: true });\r\n          } catch(e) { \r\n              if(e.message.includes(\"no such table\")) await syncDatabase(env);\r\n              return jsonResponse({ error: e.message }, 500); \r\n          }\r\n      }\r\n\r\n      // RESET SCHEDULE\r\n      if (request.method === 'DELETE') {\r\n          await env.DB.prepare(\"DELETE FROM schedule_slots WHERE school_id = ?\").bind(school.id).run();\r\n          await env.DB.prepare(\"DELETE FROM schedule_config WHERE school_id = ?\").bind(school.id).run();\r\n          return jsonResponse({ success: true });\r\n      }\r\n\r\n      // LOAD DATA\r\n      let config = null;\r\n      let slots = [];\r\n      try { \r\n          config = await env.DB.prepare(\"SELECT * FROM schedule_config WHERE school_id = ?\").bind(school.id).first(); \r\n          slots = (await env.DB.prepare(\"SELECT * FROM schedule_slots WHERE school_id = ? ORDER BY slot_index ASC\").bind(school.id).all()).results;\r\n          \r\n          // Handle existing data format - ensure duration is calculated if missing\r\n          slots = slots.map(slot => {\r\n              if (!slot.duration && slot.start_time && slot.end_time) {\r\n                  const [h1, m1] = slot.start_time.split(':').map(Number);\r\n                  const [h2, m2] = slot.end_time.split(':').map(Number);\r\n                  slot.duration = Math.round((new Date(2000, 0, 1, h2, m2) - new Date(2000, 0, 1, h1, m1)) / 60000);\r\n              }\r\n              return slot;\r\n          });\r\n      } catch(e) { \r\n          console.error('Database error:', e);\r\n          await syncDatabase(env); \r\n      }\r\n      \r\n      return htmlResponse(InstituteLayout(SchedulesPageHTML(config, slots), \"Master Schedule\", school.school_name));\r\n  }\r\n\r\n  // --- SUBJECTS (NEW STRUCTURE: Subject Bank + Class Curriculum) ---\r\n  if (url.pathname === '/school/subjects') {\r\n      if(request.method === 'POST') {\r\n          try {\r\n              const body = await request.json();\r\n              \r\n              // Subject Bank actions\r\n              if(body.action === 'create') {\r\n                  await env.DB.prepare(\"INSERT INTO academic_subjects (school_id, subject_name) VALUES (?, ?)\").bind(school.id, body.name).run();\r\n                  return jsonResponse({success:true});\r\n              }\r\n              if(body.action === 'rename') {\r\n                  await env.DB.prepare(\"UPDATE academic_subjects SET subject_name = ? WHERE id = ?\").bind(body.name, body.id).run();\r\n                  return jsonResponse({success:true});\r\n              }\r\n              \r\n              // Class Curriculum actions\r\n              if(body.action === 'add_class_subject') {\r\n                  await env.DB.prepare(\"INSERT INTO class_subjects (school_id, class_id, subject_id, classes_per_week, min_classes, max_classes) VALUES (?, ?, ?, ?, ?, ?)\")\r\n                      .bind(body.school_id, body.class_id, body.subject_id, body.classes_per_week, body.min_classes, body.max_classes).run();\r\n                  return jsonResponse({success:true});\r\n              }\r\n              if(body.action === 'add_group_subject') {\r\n                  await env.DB.prepare(\"INSERT INTO group_subjects (school_id, group_id, subject_id, classes_per_week, min_classes, max_classes) VALUES (?, ?, ?, ?, ?, ?)\")\r\n                      .bind(body.school_id, body.group_id, body.subject_id, body.classes_per_week, body.min_classes, body.max_classes).run();\r\n                  return jsonResponse({success:true});\r\n              }\r\n              \r\n              return jsonResponse({error:\"Invalid action\"},400);\r\n          } catch(e) {\r\n              console.error('Subjects API Error:', e);\r\n              return jsonResponse({error: e.message}, 500);\r\n          }\r\n      }\r\n      \r\n      if(request.method === 'DELETE') {\r\n          const body = await request.json();\r\n          \r\n          // Subject Bank actions\r\n          if(body.type === 'bank') {\r\n              await env.DB.prepare(\"DELETE FROM academic_subjects WHERE id = ?\").bind(body.id).run();\r\n              await env.DB.prepare(\"DELETE FROM class_subjects WHERE subject_id = ?\").bind(body.id).run(); \r\n              await env.DB.prepare(\"DELETE FROM group_subjects WHERE subject_id = ?\").bind(body.id).run(); \r\n              return jsonResponse({success:true});\r\n          }\r\n          \r\n          // Class Curriculum actions\r\n          if(body.action === 'delete_class_subject') {\r\n              await env.DB.prepare(\"DELETE FROM class_subjects WHERE id=?\").bind(body.id).run();\r\n              return jsonResponse({success:true});\r\n          }\r\n          if(body.action === 'delete_group_subject') {\r\n              await env.DB.prepare(\"DELETE FROM group_subjects WHERE id=?\").bind(body.id).run();\r\n              return jsonResponse({success:true});\r\n          }\r\n      }\r\n      \r\n      // Get all data for subjects page\r\n      const subjects = await env.DB.prepare(\"SELECT * FROM academic_subjects WHERE school_id = ? ORDER BY subject_name ASC\").bind(school.id).all();\r\n      const classes = await env.DB.prepare(\"SELECT * FROM academic_classes WHERE school_id = ? ORDER BY class_name ASC\").bind(school.id).all();\r\n      const groups = await env.DB.prepare(\"SELECT * FROM class_groups WHERE school_id = ? ORDER BY class_id, group_name\").bind(school.id).all();\r\n      const sections = await env.DB.prepare(\"SELECT cs.*, cg.group_name FROM class_sections cs LEFT JOIN class_groups cg ON cs.group_id = cg.id WHERE cs.school_id = ?\").bind(school.id).all();\r\n      \r\n      // Get subject assignments\r\n      const classSubjects = await env.DB.prepare(`\r\n        SELECT cs.*, sub.subject_name \r\n        FROM class_subjects cs \r\n        JOIN academic_subjects sub ON cs.subject_id = sub.id \r\n        WHERE cs.school_id = ?\r\n      `).bind(school.id).all();\r\n      \r\n      const groupSubjects = await env.DB.prepare(`\r\n        SELECT gs.*, sub.subject_name, g.group_name, g.class_id\r\n        FROM group_subjects gs \r\n        JOIN academic_subjects sub ON gs.subject_id = sub.id\r\n        JOIN class_groups g ON gs.group_id = g.id\r\n        WHERE gs.school_id = ?\r\n      `).bind(school.id).all();\r\n      \r\n      // Get schedule configuration for capacity display\r\n      let scheduleConfig = await env.DB.prepare(\"SELECT * FROM schedule_config WHERE school_id = ?\").bind(school.id).first();\r\n      if (!scheduleConfig) {\r\n        await env.DB.prepare(\"INSERT INTO schedule_config (school_id, active_days, periods_per_day, working_days, off_days) VALUES (?, ?, ?, ?, ?)\")\r\n          .bind(school.id, 5, 8, '[\"monday\",\"tuesday\",\"wednesday\",\"thursday\",\"friday\"]', '[\"saturday\",\"sunday\"]').run();\r\n        scheduleConfig = await env.DB.prepare(\"SELECT * FROM schedule_config WHERE school_id = ?\").bind(school.id).first();\r\n      }\r\n      \r\n      // Parse working days and calculate capacity\r\n      const workingDaysArray = scheduleConfig.working_days ? JSON.parse(scheduleConfig.working_days) : [\"monday\",\"tuesday\",\"wednesday\",\"thursday\",\"friday\"];\r\n      const workingDaysCount = workingDaysArray.length; // Dynamic from user input\r\n      const scheduleSlots = await env.DB.prepare(\"SELECT * FROM schedule_slots WHERE school_id = ? AND type = 'class'\").bind(school.id).all();\r\n      const actualClassPeriodsPerDay = scheduleSlots.results.length || 8;\r\n      const maxClassesPerSection = workingDaysCount * actualClassPeriodsPerDay;\r\n      \r\n      scheduleConfig.actualClassPeriodsPerDay = actualClassPeriodsPerDay;\r\n      scheduleConfig.maxClassesPerSection = maxClassesPerSection;\r\n      scheduleConfig.workingDaysCount = workingDaysCount;\r\n      scheduleConfig.workingDaysArray = workingDaysArray;\r\n      \r\n      return htmlResponse(InstituteLayout(\r\n        SubjectsPageHTML(\r\n          school,\r\n          subjects.results, \r\n          classes.results,\r\n          groups.results,\r\n          sections.results,\r\n          classSubjects.results,\r\n          groupSubjects.results,\r\n          scheduleConfig\r\n        ), \r\n        \"Subjects Management\", \r\n        school.school_name\r\n      ));\r\n  }\r\n\r\n  // --- TEACHERS (NEW SYSTEM: Table Interface + Subject Assignment) ---\r\n  if (url.pathname === '/school/teachers') {\r\n      if (request.method === 'POST') {\r\n          const body = await request.json();\r\n          \r\n          // Add new teacher (without subjects)\r\n          if (body.full_name && body.email && body.phone_digits) {\r\n              const current = await env.DB.prepare(\"SELECT count(*) as count FROM profiles_teacher WHERE school_id = ?\").bind(school.id).first();\r\n              if (current.count >= (school.max_teachers || 10)) return jsonResponse({ error: \"Limit Reached\" }, 403);\r\n              \r\n              const cleanPhone = body.phone_digits.replace(/\\D/g, ''); \r\n              await env.DB.prepare(\"INSERT INTO profiles_teacher (school_id, full_name, subject, email, phone) VALUES (?, ?, ?, ?, ?)\")\r\n                  .bind(school.id, body.full_name, '', body.email, `880-${cleanPhone}`).run();\r\n              return jsonResponse({ success: true });\r\n          }\r\n          \r\n          // Assign subjects to teacher\r\n          if (body.action === 'assign_subjects') {\r\n              // Clear existing assignments for this teacher\r\n              await env.DB.prepare(\"DELETE FROM teacher_subjects WHERE teacher_id = ?\").bind(body.teacher_id).run();\r\n              \r\n              // Add main subject\r\n              if (body.main_subject) {\r\n                  await env.DB.prepare(\"INSERT INTO teacher_subjects (school_id, teacher_id, subject_id, is_primary) VALUES (?, ?, ?, 1)\")\r\n                      .bind(school.id, body.teacher_id, body.main_subject, 1).run();\r\n              }\r\n              \r\n              // Add additional subjects\r\n              if (body.additional_subjects && Array.isArray(body.additional_subjects)) {\r\n                  for (const subjectId of body.additional_subjects) {\r\n                      await env.DB.prepare(\"INSERT INTO teacher_subjects (school_id, teacher_id, subject_id, is_primary) VALUES (?, ?, ?, 0)\")\r\n                          .bind(school.id, body.teacher_id, subjectId, 0).run();\r\n                  }\r\n              }\r\n              \r\n              return jsonResponse({ success: true });\r\n          }\r\n          \r\n          return jsonResponse({ error: \"Invalid action\" }, 400);\r\n      }\r\n      \r\n      if (request.method === 'DELETE') {\r\n          const body = await request.json();\r\n          \r\n          // Remove teacher\r\n          if (body.id) {\r\n              await env.DB.prepare(\"DELETE FROM profiles_teacher WHERE id = ?\").bind(body.id).run();\r\n              await env.DB.prepare(\"DELETE FROM teacher_subjects WHERE teacher_id = ?\").bind(body.id).run();\r\n              return jsonResponse({ success: true });\r\n          }\r\n          \r\n          return jsonResponse({ error: \"Invalid request\" }, 400);\r\n      }\r\n      \r\n      // Get all data for teachers page\r\n      const teachers = await env.DB.prepare(\"SELECT * FROM profiles_teacher WHERE school_id = ? ORDER BY id DESC\").bind(school.id).all();\r\n      const allSubjects = await env.DB.prepare(\"SELECT * FROM academic_subjects WHERE school_id = ? ORDER BY subject_name ASC\").bind(school.id).all();\r\n      const teacherSubjects = await env.DB.prepare(`\r\n        SELECT ts.*, sub.subject_name \r\n        FROM teacher_subjects ts \r\n        JOIN academic_subjects sub ON ts.subject_id = sub.id \r\n        WHERE ts.school_id = ?\r\n        ORDER BY ts.is_primary DESC, sub.subject_name ASC\r\n      `).bind(school.id).all();\r\n      \r\n      return htmlResponse(InstituteLayout(\r\n        TeachersPageHTML(\r\n          school,\r\n          teachers.results, \r\n          allSubjects.results,\r\n          teacherSubjects.results\r\n        ), \r\n        \"Teachers Management\", \r\n        school.school_name\r\n      ));\r\n  }\r\n  \r\n  // --- CLASSES (READ-ONLY HIERARCHY VIEW) ---\r\n  if (url.pathname === '/school/classes') {\r\n      // Get all data for read-only classes view\r\n      const classes = await env.DB.prepare(\"SELECT * FROM academic_classes WHERE school_id = ? ORDER BY class_name ASC\").bind(school.id).all();\r\n      const groups = await env.DB.prepare(\"SELECT * FROM class_groups WHERE school_id = ? ORDER BY class_id, group_name\").bind(school.id).all();\r\n      const sections = await env.DB.prepare(\"SELECT cs.*, cg.group_name FROM class_sections cs LEFT JOIN class_groups cg ON cs.group_id = cg.id WHERE cs.school_id = ?\").bind(school.id).all();\r\n      \r\n      // Get subjects for capacity display\r\n      const subjects = await env.DB.prepare(\"SELECT * FROM academic_subjects WHERE school_id = ? ORDER BY subject_name ASC\").bind(school.id).all();\r\n      const classSubjects = await env.DB.prepare(`\r\n        SELECT cs.*, sub.subject_name \r\n        FROM class_subjects cs \r\n        JOIN academic_subjects sub ON cs.subject_id = sub.id \r\n        WHERE cs.school_id = ?\r\n      `).bind(school.id).all();\r\n      \r\n      const groupSubjects = await env.DB.prepare(`\r\n        SELECT gs.*, sub.subject_name, g.group_name, g.class_id\r\n        FROM group_subjects gs \r\n        JOIN academic_subjects sub ON gs.subject_id = sub.id\r\n        JOIN class_groups g ON gs.group_id = g.id\r\n        WHERE gs.school_id = ?\r\n      `).bind(school.id).all();\r\n      \r\n      // Get schedule configuration for capacity display\r\n      let scheduleConfig = await env.DB.prepare(\"SELECT * FROM schedule_config WHERE school_id = ?\").bind(school.id).first();\r\n      if (!scheduleConfig) {\r\n        await env.DB.prepare(\"INSERT INTO schedule_config (school_id, active_days, periods_per_day, working_days, off_days) VALUES (?, ?, ?, ?, ?)\")\r\n          .bind(school.id, 5, 8, '[\"monday\",\"tuesday\",\"wednesday\",\"thursday\",\"friday\"]', '[\"saturday\",\"sunday\"]').run();\r\n        scheduleConfig = await env.DB.prepare(\"SELECT * FROM schedule_config WHERE school_id = ?\").bind(school.id).first();\r\n      }\r\n      \r\n      // Parse working days and calculate capacity\r\n      const workingDaysArray = scheduleConfig.working_days ? JSON.parse(scheduleConfig.working_days) : [\"monday\",\"tuesday\",\"wednesday\",\"thursday\",\"friday\"];\r\n      const workingDaysCount = workingDaysArray.length; // Dynamic from user input\r\n      const scheduleSlots = await env.DB.prepare(\"SELECT * FROM schedule_slots WHERE school_id = ? AND type = 'class'\").bind(school.id).all();\r\n      const actualClassPeriodsPerDay = scheduleSlots.results.length || 8;\r\n      const maxClassesPerSection = workingDaysCount * actualClassPeriodsPerDay;\r\n      \r\n      scheduleConfig.actualClassPeriodsPerDay = actualClassPeriodsPerDay;\r\n      scheduleConfig.maxClassesPerSection = maxClassesPerSection;\r\n      scheduleConfig.workingDaysCount = workingDaysCount;\r\n      scheduleConfig.workingDaysArray = workingDaysArray;\r\n      \r\n      return htmlResponse(InstituteLayout(\r\n        ClassesPageHTML(\r\n          school,\r\n          classes.results, \r\n          groups.results, \r\n          sections.results,\r\n          subjects.results,\r\n          classSubjects.results,\r\n          groupSubjects.results,\r\n          scheduleConfig\r\n        ), \r\n        \"Classes & Groups\", \r\n        school.school_name\r\n      ));\r\n  }\r\n\r\n  return new Response(\"Not Found\", {status:404});\r\n}\r\n", "export function InstituteLayout(content, title, schoolName) {\r\n    return `\r\n    <!DOCTYPE html>\r\n    <html lang=\"en\">\r\n    <head>\r\n        <meta charset=\"UTF-8\">\r\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\">\r\n        <title>${title} - ${schoolName}</title>\r\n        <script src=\"https://cdn.tailwindcss.com\"></script>\r\n        <link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap\" rel=\"stylesheet\">\r\n        <style>\r\n            body { font-family: 'Inter', sans-serif; font-size: 0.875rem; } \r\n            \r\n            /* Hide Scrollbar for Chrome/Safari/Opera */\r\n            .no-scrollbar::-webkit-scrollbar { display: none; }\r\n            /* Hide Scrollbar for IE, Edge and Firefox */\r\n            .no-scrollbar { -ms-overflow-style: none;  scrollbar-width: none; }\r\n\r\n            /* Professional custom scrollbar for main content */\r\n            ::-webkit-scrollbar { width: 6px; height: 6px; }\r\n            ::-webkit-scrollbar-track { background: transparent; }\r\n            ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }\r\n            ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }\r\n\r\n            /* Prevent iOS Zoom on inputs */\r\n            @media screen and (max-width: 768px) {\r\n                input, select, textarea { font-size: 16px !important; }\r\n            }\r\n\r\n            .page-shell { animation: pageFadeIn 320ms ease-out both; }\r\n            .page-leave .page-shell { opacity: 0; transform: translateY(6px); transition: opacity 180ms ease, transform 180ms ease; }\r\n            .ui-glow::before {\r\n                content: \"\";\r\n                position: fixed;\r\n                inset: -10% -10% auto -10%;\r\n                height: 40vh;\r\n                background:\r\n                  radial-gradient(circle at top left, rgba(59, 130, 246, 0.14), transparent 55%),\r\n                  radial-gradient(circle at top right, rgba(168, 85, 247, 0.14), transparent 55%),\r\n                  radial-gradient(circle at 40% 10%, rgba(16, 185, 129, 0.1), transparent 50%);\r\n                pointer-events: none;\r\n                z-index: 0;\r\n            }\r\n            @keyframes pageFadeIn {\r\n                from { opacity: 0; transform: translateY(10px); }\r\n                to { opacity: 1; transform: translateY(0); }\r\n            }\r\n            @media (prefers-reduced-motion: reduce) {\r\n                .page-shell { animation: none; }\r\n                .page-leave .page-shell { transition: none; }\r\n            }\r\n        </style>\r\n    </head>\r\n    <body class=\"ui-glow bg-gray-50 text-gray-800 antialiased h-screen flex flex-col md:flex-row overflow-hidden relative\">\r\n\r\n        <header class=\"md:hidden h-14 bg-white border-b border-gray-200 flex items-center justify-between px-4 z-30 flex-shrink-0 relative\">\r\n            <div class=\"absolute inset-x-0 top-0 h-0.5 bg-gradient-to-r from-blue-500 via-purple-500 to-emerald-400\"></div>\r\n            <div class=\"flex items-center gap-3\">\r\n                <button onclick=\"toggleSidebar()\" class=\"p-2 -ml-2 text-gray-600 hover:bg-gray-100 rounded-lg\">\r\n                    <svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 6h16M4 12h16M4 18h16\"></path></svg>\r\n                </button>\r\n                <span class=\"font-bold text-gray-900 truncate max-w-[200px]\">${schoolName}</span>\r\n            </div>\r\n            <div class=\"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-700 font-bold text-xs\">\r\n                ${schoolName.charAt(0)}\r\n            </div>\r\n        </header>\r\n\r\n        <div id=\"sidebar-backdrop\" onclick=\"toggleSidebar()\" class=\"fixed inset-0 bg-gray-900/50 z-40 hidden transition-opacity opacity-0\"></div>\r\n\r\n        <aside id=\"sidebar\" class=\"fixed md:static inset-y-0 left-0 z-50 w-64 bg-white border-r border-gray-200 transform -translate-x-full md:translate-x-0 transition-transform duration-200 ease-in-out flex flex-col shadow-2xl md:shadow-none\">\r\n            <div class=\"h-14 flex items-center px-4 border-b border-gray-200 flex-shrink-0 justify-between\">\r\n                <div class=\"flex items-center\">\r\n                    <div class=\"w-6 h-6 bg-blue-600 rounded flex items-center justify-center text-white font-bold text-xs mr-2\">S</div>\r\n                    <span class=\"font-bold text-gray-900 truncate text-sm max-w-[150px]\">${schoolName}</span>\r\n                </div>\r\n                <button onclick=\"toggleSidebar()\" class=\"md:hidden p-1 text-gray-400 hover:text-gray-600\">\r\n                    <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path></svg>\r\n                </button>\r\n            </div>\r\n\r\n            <nav class=\"flex-1 overflow-y-auto py-3 space-y-1 px-3\">\r\n                <a href=\"/school/dashboard\" class=\"nav-link flex items-center px-3 py-2 text-gray-600 hover:bg-gray-100 rounded-md text-sm font-medium\" data-page=\"dashboard\">Dashboard</a>\r\n                <div class=\"pt-4 pb-2 px-3 text-xs font-bold text-gray-400 uppercase\">Academic</div>\r\n                <a href=\"/school/schedules\" class=\"nav-link flex items-center px-3 py-2 text-gray-600 hover:bg-gray-100 rounded-md text-sm font-medium\" data-page=\"schedules\">Master Schedule</a>\r\n                <a href=\"/school/teachers\" class=\"nav-link flex items-center px-3 py-2 text-gray-600 hover:bg-gray-100 rounded-md text-sm font-medium\" data-page=\"teachers\">Teachers</a>\r\n                <a href=\"/school/subjects\" class=\"nav-link flex items-center px-3 py-2 text-gray-600 hover:bg-gray-100 rounded-md text-sm font-medium\" data-page=\"subjects\">Subjects</a>\r\n                <a href=\"/school/classes\" class=\"nav-link flex items-center px-3 py-2 text-gray-600 hover:bg-gray-100 rounded-md text-sm font-medium\" data-page=\"classes\">Classes</a>\r\n                <div class=\"mt-auto pt-4 border-t\">\r\n                    <a href=\"/logout\" class=\"flex items-center px-3 py-2 text-red-600 hover:bg-red-50 rounded-md text-sm font-medium\">Sign Out</a>\r\n                </div>\r\n            </nav>\r\n        </aside>\r\n\r\n        <main class=\"page-shell flex-1 flex flex-col min-w-0 bg-gray-50 overflow-hidden relative z-10\">\r\n            <div class=\"flex-1 overflow-auto p-4 pb-20 md:pb-6\">\r\n                ${content}\r\n            </div>\r\n        </main>\r\n\r\n        <script>\r\n            const enablePageTransitions = () => {\r\n                if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;\r\n                document.addEventListener('click', (event) => {\r\n                    const link = event.target.closest('a');\r\n                    if (!link || link.target === '_blank' || link.hasAttribute('download')) return;\r\n                    const href = link.getAttribute('href') || '';\r\n                    if (href.startsWith('#') || href.startsWith('mailto:') || href.startsWith('tel:')) return;\r\n                    if (event.metaKey || event.ctrlKey || event.shiftKey || event.altKey || event.button !== 0) return;\r\n                    const url = new URL(link.href, window.location.href);\r\n                    if (url.origin !== window.location.origin) return;\r\n                    event.preventDefault();\r\n                    document.body.classList.add('page-leave');\r\n                    setTimeout(() => { window.location.href = link.href; }, 180);\r\n                });\r\n            };\r\n\r\n            const enableAutoRefresh = () => {\r\n                let lastInteraction = Date.now();\r\n                const mark = () => { lastInteraction = Date.now(); };\r\n                ['click', 'keydown', 'scroll', 'mousemove', 'touchstart'].forEach((evt) => {\r\n                    document.addEventListener(evt, mark, { passive: true });\r\n                });\r\n                const intervalMs = 120000;\r\n                setInterval(() => {\r\n                    if (document.hidden) return;\r\n                    const active = document.activeElement;\r\n                    if (active && ['INPUT', 'TEXTAREA', 'SELECT'].includes(active.tagName)) return;\r\n                    if (Date.now() - lastInteraction < intervalMs) return;\r\n                    window.location.reload();\r\n                }, intervalMs);\r\n            };\r\n\r\n            function toggleSidebar() {\r\n                const sb = document.getElementById('sidebar');\r\n                const bd = document.getElementById('sidebar-backdrop');\r\n                const isClosed = sb.classList.contains('-translate-x-full');\r\n                if (isClosed) {\r\n                    sb.classList.remove('-translate-x-full');\r\n                    bd.classList.remove('hidden');\r\n                    setTimeout(() => bd.classList.remove('opacity-0'), 10);\r\n                } else {\r\n                    sb.classList.add('-translate-x-full');\r\n                    bd.classList.add('opacity-0');\r\n                    setTimeout(() => bd.classList.add('hidden'), 200);\r\n                }\r\n            }\r\n\r\n            function setActiveNav() {\r\n                const currentPath = window.location.pathname;\r\n                const navLinks = document.querySelectorAll('.nav-link');\r\n                \r\n                navLinks.forEach(link => {\r\n                    const page = link.getAttribute('data-page');\r\n                    link.classList.remove('bg-blue-50', 'text-blue-600');\r\n                    link.classList.add('text-gray-600');\r\n                    \r\n                    if (currentPath.includes(\\`/school/\\${page}\\`)) {\r\n                        link.classList.remove('text-gray-600');\r\n                        link.classList.add('bg-blue-50', 'text-blue-600');\r\n                    }\r\n                });\r\n            }\r\n\r\n            window.addEventListener('DOMContentLoaded', () => {\r\n                enablePageTransitions();\r\n                enableAutoRefresh();\r\n                setActiveNav();\r\n            });\r\n        </script>\r\n    </body>\r\n    </html>\r\n    `;\r\n}\r\n", "export function InstituteDashboardHTML(stats) {\r\n    return `\r\n      <div class=\"space-y-6 max-w-6xl mx-auto pt-4 md:pt-6\">\r\n          \r\n          <div>\r\n            <h1 class=\"text-xl md:text-3xl font-semibold text-gray-900\">Overview</h1>\r\n            <p class=\"text-sm md:text-base text-gray-500 mt-1\">Welcome to your academic control center.</p>\r\n          </div>\r\n\r\n          <div class=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 md:gap-6 border-t border-b border-gray-100 py-4 md:py-6\">\r\n              <div>\r\n                  <div class=\"text-xs md:text-sm uppercase tracking-widest text-gray-400 mb-1 md:mb-2\">Total Teachers</div>\r\n                  <div class=\"text-3xl md:text-4xl font-light text-gray-900\">${stats.teachers || 0}</div>\r\n              </div>\r\n              <div>\r\n                  <div class=\"text-xs md:text-sm uppercase tracking-widest text-gray-400 mb-1 md:mb-2\">Active Classes</div>\r\n                  <div class=\"text-3xl md:text-4xl font-light text-gray-900\">${stats.classes || 0}</div>\r\n              </div>\r\n              <div>\r\n                  <div class=\"text-xs md:text-sm uppercase tracking-widest text-gray-400 mb-1 md:mb-2\">Routines</div>\r\n                  <div class=\"text-3xl md:text-4xl font-light text-gray-900\">0</div>\r\n              </div>\r\n              <div>\r\n                  <div class=\"text-xs md:text-sm uppercase tracking-widest text-gray-400 mb-1 md:mb-2\">System Status</div>\r\n                  <div class=\"text-sm md:text-base font-medium text-green-600 mt-1 flex items-center\">\r\n                    <span class=\"w-2 md:w-3 h-2 md:h-3 bg-green-500 rounded-full mr-2\"></span> Operational\r\n                  </div>\r\n              </div>\r\n          </div>\r\n\r\n          <div>\r\n              <h3 class=\"text-xs md:text-sm font-semibold text-gray-900 uppercase tracking-widest mb-6\">Quick Actions</h3>\r\n              <div class=\"flex flex-col sm:flex-row gap-4 md:gap-6 text-sm md:text-base\">\r\n                  <a href=\"/school/teachers\" class=\"group flex items-center text-gray-600 hover:text-blue-600 transition-colors\">\r\n                      <span class=\"border-b border-gray-300 group-hover:border-blue-600 pb-0.5\">Add Staff Member</span>\r\n                      <svg class=\"w-4 md:w-5 h-4 md:h-5 ml-2 opacity-0 group-hover:opacity-100 transition-opacity\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 8l4 4m0 0l-4 4m4-4H3\"></path></svg>\r\n                  </a>\r\n                  <a href=\"/school/classes\" class=\"group flex items-center text-gray-600 hover:text-blue-600 transition-colors\">\r\n                      <span class=\"border-b border-gray-300 group-hover:border-blue-600 pb-0.5\">Configure Classes</span>\r\n                      <svg class=\"w-4 md:w-5 h-4 md:h-5 ml-2 opacity-0 group-hover:opacity-100 transition-opacity\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 8l4 4m0 0l-4 4m4-4H3\"></path></svg>\r\n                  </a>\r\n              </div>\r\n          </div>\r\n      </div>\r\n    `;\r\n}\r\n", "// src/ui/institute/teachers.js - REDESIGNED: Table Interface + Subject Assignment\n\nexport function TeachersPageHTML(school, teachers = [], allSubjects = [], teacherSubjects = []) {\n    \n    // Group subjects by teacher\n    const subjectsByTeacher = {};\n    teacherSubjects.forEach(ts => {\n        if (!subjectsByTeacher[ts.teacher_id]) subjectsByTeacher[ts.teacher_id] = [];\n        subjectsByTeacher[ts.teacher_id].push(ts);\n    });\n\n    // Build table rows\n    const teacherRows = teachers.map(t => {\n        const teacherSubjectsList = subjectsByTeacher[t.id] || [];\n        const mainSubject = teacherSubjectsList.find(ts => ts.is_primary)?.subject_name || 'Not Assigned';\n        const otherSubjects = teacherSubjectsList.filter(ts => !ts.is_primary).map(ts => ts.subject_name);\n        \n        return `\n            <tr class=\"hover:bg-gray-50\">\n                <td class=\"px-4 md:px-6 py-3 md:py-4 whitespace-nowrap\">\n                    <div class=\"text-sm md:text-base font-medium text-gray-900\">${t.full_name}</div>\n                    <div class=\"text-xs md:text-sm text-gray-500\">${t.email}</div>\n                </td>\n                <td class=\"px-4 md:px-6 py-3 md:py-4 whitespace-nowrap\">\n                    <div class=\"flex flex-col gap-1\">\n                        <span class=\"bg-green-50 text-green-700 px-2 py-1 rounded text-xs font-medium border border-green-100\">\n                            \uD83C\uDFAF ${mainSubject}\n                        </span>\n                        ${otherSubjects.length > 0 ? `\n                            <div class=\"flex flex-wrap gap-1\">\n                                ${otherSubjects.map(s => `\n                                    <span class=\"bg-blue-50 text-blue-700 px-1.5 py-0.5 rounded text-xs border border-blue-100\">${s}</span>\n                                `).join('')}\n                            </div>\n                        ` : '<span class=\"text-xs text-gray-400\">No other subjects</span>'}\n                    </div>\n                </td>\n                <td class=\"px-4 md:px-6 py-3 md:py-4 whitespace-nowrap text-sm md:text-base font-mono text-gray-600\">\n                    ${t.phone}\n                </td>\n                <td class=\"px-4 md:px-6 py-3 md:py-4 whitespace-nowrap\">\n                    <div class=\"flex gap-2\">\n                        <button onclick=\"openAssignSubjectsModal(${t.id}, '${t.full_name}')\" class=\"text-blue-600 hover:text-blue-900 text-xs md:text-sm font-medium\">\n                            Assign Subjects\n                        </button>\n                        <button onclick=\"removeTeacher(${t.id})\" class=\"text-red-600 hover:text-red-900 text-xs md:text-sm font-medium\">\n                            Remove\n                        </button>\n                    </div>\n                </td>\n            </tr>\n        `;\n    }).join('');\n\n    return `\n      <style>\n        /* Enhanced table styling */\n        .teacher-table {\n          border-collapse: separate;\n          border-spacing: 0;\n        }\n        \n        .teacher-table th {\n          background: linear-gradient(to bottom, #f9fafb, #f3f4f6);\n          border-bottom: 2px solid #e5e7eb;\n          font-weight: 600;\n        }\n        \n        .teacher-table td {\n          border-bottom: 1px solid #f3f4f6;\n        }\n        \n        /* Modal styling */\n        .modal-overlay {\n          background: rgba(0, 0, 0, 0.5);\n          backdrop-filter: blur(4px);\n        }\n        \n        .modal-content {\n          animation: modalSlideIn 0.3s ease-out;\n        }\n        \n        @keyframes modalSlideIn {\n          from {\n            opacity: 0;\n            transform: translateY(-20px) scale(0.95);\n          }\n          to {\n            opacity: 1;\n            transform: translateY(0) scale(1);\n          }\n        }\n        \n        /* Checkbox styling */\n        .subject-checkbox {\n          transition: all 0.2s ease;\n        }\n        \n        .subject-checkbox:hover {\n          background-color: #f0f9ff;\n        }\n        \n        /* Mobile responsive */\n        @media (max-width: 768px) {\n          .teacher-table {\n            font-size: 12px;\n          }\n          \n          .teacher-table th,\n          .teacher-table td {\n            padding: 8px;\n          }\n        }\n      </style>\n      \n      <div class=\"max-w-6xl md:max-w-7xl mx-auto pt-4 md:pt-6\">\n          <div class=\"flex flex-col sm:flex-row sm:items-center justify-between gap-3 mb-4 md:mb-6\">\n              <div>\n                <h1 class=\"text-2xl md:text-3xl font-semibold text-gray-900\">Teachers Management</h1>\n                <p class=\"text-sm md:text-base text-gray-500 mt-1\">Add teachers and assign their teaching subjects</p>\n              </div>\n              <button onclick=\"toggleAddTeacher()\" class=\"text-sm md:text-base bg-gray-900 text-white px-4 md:px-6 py-2 md:py-2.5 rounded-lg hover:bg-black transition-colors w-full sm:w-auto\">\n                  + Add Teacher\n              </button>\n          </div>\n\n          <!-- Add Teacher Form -->\n          <div id=\"add-teacher-box\" class=\"hidden mb-6 bg-white p-4 md:p-6 border border-gray-200 rounded-lg md:rounded-xl shadow-sm\">\n              <h3 class=\"text-base md:text-lg font-semibold text-gray-900 mb-3 md:mb-4\">Add New Teacher</h3>\n              <form onsubmit=\"addTeacher(event)\" class=\"space-y-4 md:space-y-6\">\n                  \n                  <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                      <div>\n                          <label class=\"block text-xs font-bold text-gray-700 uppercase mb-1\">Full Name</label>\n                          <input type=\"text\" name=\"full_name\" required class=\"w-full border border-gray-300 p-2 rounded text-sm outline-none focus:ring-2 focus:ring-blue-500\">\n                      </div>\n\n                      <div>\n                          <label class=\"block text-xs font-bold text-gray-700 uppercase mb-1\">Email</label>\n                          <input type=\"email\" name=\"email\" required class=\"w-full border border-gray-300 p-2 rounded text-sm outline-none focus:ring-2 focus:ring-blue-500\">\n                      </div>\n                  </div>\n\n                  <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                      <div>\n                          <label class=\"block text-xs font-bold text-gray-700 uppercase mb-1\">Phone (Bangladesh)</label>\n                          <div class=\"flex items-center border border-gray-300 rounded overflow-hidden bg-white\">\n                              <span class=\"bg-gray-100 text-gray-600 px-3 py-2 text-sm font-bold border-r border-gray-300\">+880</span>\n                              <input type=\"text\" id=\"phone-input\" name=\"phone_digits\" required oninput=\"validatePhone(this)\" class=\"w-full p-2 text-sm outline-none font-mono\" placeholder=\"1XXXXXXXXX\" maxlength=\"10\">\n                          </div>\n                          <p id=\"phone-msg\" class=\"text-xs mt-1 h-4 text-red-500\"></p>\n                      </div>\n                      \n                      <div class=\"flex items-end\">\n                          <button type=\"submit\" id=\"submit-btn\" class=\"bg-blue-600 text-white px-6 py-2.5 rounded text-sm font-medium hover:bg-blue-700 transition-colors\">\n                              Add Teacher\n                          </button>\n                      </div>\n                  </div>\n              </form>\n          </div>\n\n          <!-- Teachers Table -->\n          <div class=\"bg-white rounded-lg border border-gray-200 overflow-hidden shadow-sm\">\n              <div class=\"overflow-x-auto\">\n                  <table class=\"min-w-full teacher-table\">\n                      <thead>\n                          <tr class=\"bg-gray-50\">\n                              <th class=\"px-4 md:px-6 py-3 md:py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                                  Teacher\n                              </th>\n                              <th class=\"px-4 md:px-6 py-3 md:py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                                  Subjects\n                              </th>\n                              <th class=\"px-4 md:px-6 py-3 md:py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                                  Phone\n                              </th>\n                              <th class=\"px-4 md:px-6 py-3 md:py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                                  Actions\n                              </th>\n                          </tr>\n                      </thead>\n                      <tbody class=\"bg-white divide-y divide-gray-200\">\n                          ${teacherRows.length > 0 ? teacherRows : `\n                              <tr>\n                                  <td colspan=\"4\" class=\"px-4 py-8 text-center text-gray-500\">\n                                      <div class=\"flex flex-col items-center\">\n                                          <svg class=\"w-12 h-12 text-gray-400 mb-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 016-12h13a6 6 0 016 12v1m-18 0V7a4 4 0 114 0h4a2 2 0 012 2v1a2 2 0 002 2h4a2 2 0 002-2V9a2 2 0 00-2-2h-4a2 2 0 00-2 2v-1z\"></path>\n                                          </svg>\n                                          <p class=\"text-sm font-medium\">No teachers added yet</p>\n                                          <p class=\"text-xs text-gray-400 mt-1\">Click \"Add Teacher\" to get started</p>\n                                      </div>\n                                  </td>\n                              </tr>\n                          `}\n                      </tbody>\n                  </table>\n              </div>\n          </div>\n      </div>\n\n      <!-- Assign Subjects Modal -->\n      <div id=\"assign-subjects-modal\" class=\"fixed inset-0 modal-overlay z-[9999] hidden flex items-center justify-center p-4\">\n          <div class=\"bg-white rounded-lg md:rounded-xl shadow-xl w-full max-w-2xl modal-content\">\n              <div class=\"p-4 md:p-6 border-b border-gray-200\">\n                  <h3 class=\"text-lg font-semibold text-gray-900\">Assign Subjects to Teacher</h3>\n                  <p class=\"text-sm text-gray-600 mt-1\">Select main subject and additional subjects</p>\n              </div>\n              \n              <div class=\"p-4 md:p-6\">\n                  <form id=\"assign-subjects-form\" class=\"space-y-4\">\n                      <input type=\"hidden\" name=\"teacher_id\" id=\"teacher_id\">\n                      <input type=\"hidden\" name=\"teacher_name\" id=\"teacher_name\">\n                      \n                      <div>\n                          <label class=\"block text-sm font-medium text-gray-700 mb-3\">Main Subject (Primary)</label>\n                          <div class=\"border border-gray-200 rounded-lg p-3 max-h-48 overflow-y-auto bg-gray-50\">\n                              ${allSubjects.map(s => `\n                                  <label class=\"flex items-center gap-3 p-2 rounded hover:bg-white cursor-pointer subject-checkbox\">\n                                      <input type=\"radio\" name=\"main_subject\" value=\"${s.id}\" required class=\"w-4 h-4 text-blue-600\">\n                                      <span class=\"text-sm font-medium\">${s.subject_name}</span>\n                                  </label>\n                              `).join('')}\n                              ${allSubjects.length === 0 ? '<p class=\"text-sm text-red-500 p-3\">No subjects found. Add subjects in the Subjects page first.</p>' : ''}\n                          </div>\n                      </div>\n                      \n                      <div>\n                          <label class=\"block text-sm font-medium text-gray-700 mb-3\">Additional Subjects (Optional)</label>\n                          <div class=\"border border-gray-200 rounded-lg p-3 max-h-48 overflow-y-auto bg-gray-50\">\n                              ${allSubjects.map(s => `\n                                  <label class=\"flex items-center gap-3 p-2 rounded hover:bg-white cursor-pointer subject-checkbox\">\n                                      <input type=\"checkbox\" name=\"additional_subjects\" value=\"${s.id}\" class=\"w-4 h-4 text-blue-600\">\n                                      <span class=\"text-sm font-medium\">${s.subject_name}</span>\n                                  </label>\n                              `).join('')}\n                          </div>\n                          <p class=\"text-xs text-gray-500 mt-1\">Select all subjects this teacher can teach</p>\n                      </div>\n                      \n                      <div class=\"flex gap-3 pt-4 border-t border-gray-200\">\n                          <button type=\"submit\" class=\"bg-blue-600 text-white px-4 py-2 rounded text-sm font-medium hover:bg-blue-700 transition-colors\">\n                              Save Assignments\n                          </button>\n                          <button type=\"button\" onclick=\"closeAssignSubjectsModal()\" class=\"bg-gray-200 text-gray-800 px-4 py-2 rounded text-sm font-medium hover:bg-gray-300 transition-colors\">\n                              Cancel\n                          </button>\n                      </div>\n                  </form>\n              </div>\n          </div>\n      </div>\n\n      <script>\n        const SCHOOL_ID = ${school.id};\n\n        // Form functions\n        function toggleAddTeacher() {\n            const box = document.getElementById('add-teacher-box');\n            box.classList.toggle('hidden');\n            if (!box.classList.contains('hidden')) {\n                setTimeout(() => document.querySelector('input[name=\"full_name\"]').focus(), 100);\n            }\n        }\n\n        function validatePhone(input) {\n            const value = input.value.replace(/\\D/g, '');\n            const msg = document.getElementById('phone-msg');\n            \n            if (value.length < 10) {\n                msg.textContent = 'Phone number must be 10 digits';\n                msg.classList.add('text-red-500');\n                msg.classList.remove('text-green-500');\n                input.setCustomValidity('Invalid phone number');\n            } else if (value.length > 10) {\n                msg.textContent = 'Phone number must be exactly 10 digits';\n                msg.classList.add('text-red-500');\n                msg.classList.remove('text-green-500');\n                input.setCustomValidity('Invalid phone number');\n            } else {\n                msg.textContent = '\u2713 Valid Bangladesh number';\n                msg.classList.add('text-green-500');\n                msg.classList.remove('text-red-500');\n                input.setCustomValidity('');\n            }\n            \n            input.value = value;\n        }\n\n        async function addTeacher(e) {\n            e.preventDefault();\n            const submitBtn = document.getElementById('submit-btn');\n            if (submitBtn.disabled) return;\n            \n            submitBtn.disabled = true;\n            submitBtn.textContent = 'Adding...';\n            \n            const formData = new FormData(e.target);\n            const data = Object.fromEntries(formData.entries());\n            data.phone = '+880-' + data.phone_digits;\n            \n            try {\n                const response = await fetch('/school/teachers', {\n                    method: 'POST',\n                    headers: {'Content-Type': 'application/json'},\n                    body: JSON.stringify(data)\n                });\n                \n                const result = await response.json();\n                if (result.success) {\n                    window.location.reload();\n                } else {\n                    alert('Error adding teacher: ' + (result.error || 'Unknown error'));\n                }\n            } catch (error) {\n                alert('Network error. Please try again.');\n            } finally {\n                submitBtn.disabled = false;\n                submitBtn.textContent = 'Add Teacher';\n            }\n        }\n\n        // Subject assignment functions\n        function openAssignSubjectsModal(teacherId, teacherName) {\n            document.getElementById('teacher_id').value = teacherId;\n            document.getElementById('teacher_name').value = teacherName;\n            document.getElementById('assign-subjects-modal').classList.remove('hidden');\n            document.body.style.overflow = 'hidden';\n        }\n\n        function closeAssignSubjectsModal() {\n            document.getElementById('assign-subjects-modal').classList.add('hidden');\n            document.body.style.overflow = '';\n            document.getElementById('assign-subjects-form').reset();\n        }\n\n        async function assignSubjects(e) {\n            e.preventDefault();\n            \n            const formData = new FormData(e.target);\n            const data = Object.fromEntries(formData.entries);\n            \n            // Get additional subjects\n            const additionalSubjects = Array.from(document.querySelectorAll('input[name=\"additional_subjects\"]:checked'))\n                .map(cb => cb.value);\n            \n            data.additional_subjects = additionalSubjects;\n            data.action = 'assign_subjects';\n            \n            try {\n                const response = await fetch('/school/teachers', {\n                    method: 'POST',\n                    headers: {'Content-Type': 'application/json'},\n                    body: JSON.stringify(data)\n                });\n                \n                const result = await response.json();\n                if (result.success) {\n                    closeAssignSubjectsModal();\n                    window.location.reload();\n                } else {\n                    alert('Error assigning subjects: ' + (result.error || 'Unknown error'));\n                }\n            } catch (error) {\n                alert('Network error. Please try again.');\n            }\n        }\n\n        async function removeTeacher(teacherId) {\n            if (!confirm('Are you sure you want to remove this teacher?')) return;\n            \n            try {\n                const response = await fetch('/school/teachers', {\n                    method: 'DELETE',\n                    headers: {'Content-Type': 'application/json'},\n                    body: JSON.stringify({id: teacherId})\n                });\n                \n                const result = await response.json();\n                if (result.success) {\n                    window.location.reload();\n                } else {\n                    alert('Error removing teacher: ' + (result.error || 'Unknown error'));\n                }\n            } catch (error) {\n                alert('Network error. Please try again.');\n            }\n        }\n\n        // Close modal on Escape key\n        document.addEventListener('keydown', function(e) {\n            if (e.key === 'Escape') {\n                closeAssignSubjectsModal();\n            }\n        });\n\n        // Close modal on background click\n        document.getElementById('assign-subjects-modal')?.addEventListener('click', function(e) {\n            if (e.target === this) {\n                closeAssignSubjectsModal();\n            }\n        });\n      </script>\n    `;\n}\n", "// src/ui/institute/classes.js - INSTITUTION ADMIN: Read-Only Classes View\n\nexport function ClassesPageHTML(school, classes = [], groups = [], sections = [], subjects = [], classSubjects = [], groupSubjects = [], scheduleConfig = {}) {\n    \n    // Group data for easier access\n    const classGroups = {};\n    groups.forEach(g => {\n        if (!classGroups[g.class_id]) classGroups[g.class_id] = [];\n        classGroups[g.class_id].push(g);\n    });\n    \n    const classSections = {};\n    sections.forEach(s => {\n        if (!classSections[s.class_id]) classSections[s.class_id] = [];\n        classSections[s.class_id].push(s);\n    });\n\n    // Group subjects by class and group for display\n    const subjectsByClass = {};\n    classSubjects.forEach(cs => {\n        if (!subjectsByClass[cs.class_id]) subjectsByClass[cs.class_id] = [];\n        subjectsByClass[cs.class_id].push(cs);\n    });\n\n    const subjectsByGroup = {};\n    groupSubjects.forEach(gs => {\n        if (!subjectsByGroup[gs.group_id]) subjectsByGroup[gs.group_id] = [];\n        subjectsByGroup[gs.group_id].push(gs);\n    });\n\n    // Calculate capacity for each section based on master schedule\n    const maxClassesPerSection = scheduleConfig.maxClassesPerSection || 40;\n    \n    function calculateSectionCapacity(classId, groupId) {\n        let totalClasses = 0;\n        \n        // Add class-level subjects\n        const classSubjects = subjectsByClass[classId] || [];\n        totalClasses += classSubjects.reduce((sum, s) => sum + (s.classes_per_week || 0), 0);\n        \n        // Add group-level subjects\n        if (groupId) {\n            const groupSubjects = subjectsByGroup[groupId] || [];\n            totalClasses += groupSubjects.reduce((sum, s) => sum + (s.classes_per_week || 0), 0);\n        }\n        \n        return {\n            current: totalClasses,\n            max: maxClassesPerSection,\n            available: maxClassesPerSection - totalClasses,\n            percentage: Math.round((totalClasses / maxClassesPerSection) * 100)\n        };\n    }\n\n    // Build Classes & Groups Tab Content (Read-only view)\n    const classesTabContent = classes.map(cls => {\n        const groups = classGroups[cls.id] || [];\n        const sections = classSections[cls.id] || [];\n        \n        // Group sections by their group\n        const sectionsByGroup = {};\n        groups.forEach(g => {\n            sectionsByGroup[g.id] = {\n                group: g,\n                sections: sections.filter(s => s.group_id === g.id)\n            };\n        });\n        \n        // Sections without groups\n        const sectionsWithoutGroup = sections.filter(s => !s.group_id);\n\n        return `\n            <div class=\"mb-4 border border-gray-300\">\n                <!-- Class Header -->\n                <div class=\"bg-gray-100 px-3 py-2 border-b\">\n                    <div class=\"flex flex-col md:flex-row md:items-center md:justify-between gap-2\">\n                        <div class=\"flex items-center gap-2\">\n                            <span class=\"font-bold text-sm md:text-base\">${cls.class_name}</span>\n                            <span class=\"text-xs text-gray-500\">(${groups.length} groups, ${sections.length} sections)</span>\n                        </div>\n                        <div class=\"text-xs text-gray-500\">\n                            ${cls.has_groups ? 'Has Groups' : 'No Groups'}\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Groups and Sections -->\n                <div class=\"p-2\">\n                    ${groups.length > 0 ? `\n                        <div class=\"space-y-2\">\n                            ${groups.map(g => {\n                                const groupSections = sectionsByGroup[g.id]?.sections || [];\n                                const capacity = calculateSectionCapacity(cls.id, g.id);\n                                \n                                return `\n                                    <div class=\"border-l-2 border-gray-400 pl-2\">\n                                        <div class=\"flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-1\">\n                                            <div class=\"flex flex-col sm:flex-row sm:items-center gap-2\">\n                                                <span class=\"font-semibold text-sm md:text-base\">${g.group_name}</span>\n                                                <span class=\"text-xs text-gray-500\">(${groupSections.length} sections)</span>\n                                                <div class=\"text-xs px-2 py-1 rounded capacity-indicator ${capacity.percentage >= 90 ? 'bg-red-100 text-red-700' : capacity.percentage >= 70 ? 'bg-yellow-100 text-yellow-700' : 'bg-green-100 text-green-700'}\">\n                                                    ${capacity.current}/${capacity.max} classes\n                                                </div>\n                                            </div>\n                                        </div>\n                                        <div class=\"flex flex-wrap gap-1\">\n                                            ${groupSections.map(s => `\n                                                <span class=\"border border-gray-300 px-2 py-1 text-sm\">\n                                                    ${s.section_name}\n                                                </span>\n                                            `).join('')}\n                                        </div>\n                                    </div>\n                                `;\n                            }).join('')}\n                        </div>\n                    ` : ''}\n                    \n                    ${sectionsWithoutGroup.length > 0 ? `\n                        <div class=\"border-l-2 border-gray-400 pl-2\">\n                            <div class=\"mb-1\">\n                                <span class=\"font-semibold\">No Group</span>\n                                <span class=\"text-xs text-gray-500 ml-2\">(${sectionsWithoutGroup.length} sections)</span>\n                                <div class=\"text-xs px-2 py-1 rounded bg-green-100 text-green-700 inline-block ml-2\">\n                                    ${calculateSectionCapacity(cls.id, null).current}/${maxClassesPerSection} classes\n                                </div>\n                            </div>\n                            <div class=\"flex flex-wrap gap-1\">\n                                ${sectionsWithoutGroup.map(s => `\n                                    <span class=\"border border-gray-300 px-2 py-1 text-sm\">\n                                        ${s.section_name}\n                                    </span>\n                                `).join('')}\n                            </div>\n                        </div>\n                    ` : ''}\n                    \n                    ${groups.length === 0 && sectionsWithoutGroup.length === 0 ? `\n                        <div class=\"text-center py-4 text-gray-400 text-sm\">\n                            No groups or sections added yet\n                        </div>\n                    ` : ''}\n                </div>\n            </div>\n        `;\n    }).join('');\n\n    return `\n      <style>\n        /* Mobile responsive design */\n        @media (max-width: 768px) {\n          .capacity-indicator {\n            font-size: 10px;\n            padding: 2px 4px;\n          }\n        }\n        \n        /* Prevent zoom on input focus */\n        input, select, textarea {\n          font-size: 16px !important;\n        }\n      </style>\n      \n      <div>\n         <div class=\"flex items-center gap-2 text-sm text-gray-500 mb-6\">\n            <a href=\"/school/dashboard\" class=\"hover:text-blue-600\">Back to Dashboard</a>\n            <span>/</span>\n            <span class=\"text-gray-900 font-bold\">Classes & Groups</span>\n         </div>\n\n         <!-- Master Schedule Information (Read-only) -->\n         <div class=\"mb-6 bg-gray-50 p-4 border border-gray-300\">\n             <div class=\"flex flex-col md:flex-row md:items-center md:justify-between gap-4\">\n                 <div class=\"flex flex-col md:flex-row md:items-center gap-4\">\n                     <span class=\"font-semibold text-sm md:text-base\">\uD83D\uDCC5 Master Schedule Configuration</span>\n                     <div class=\"flex flex-col sm:flex-row sm:items-center gap-2\">\n                         <span class=\"text-sm\">Working Days: <strong>${scheduleConfig.workingDaysCount || 5}</strong></span>\n                         <span class=\"text-sm\">Class Periods/Day: <strong>${scheduleConfig.actualClassPeriodsPerDay || 8}</strong></span>\n                     </div>\n                 </div>\n                 <div class=\"text-sm text-gray-600\">\n                     <strong>Total Capacity:</strong> ${maxClassesPerSection} classes/week per section\n                     <div class=\"text-xs text-gray-500 mt-1\">\n                         (Calculated from master schedule: ${scheduleConfig.workingDaysCount || 5} days \u00D7 ${scheduleConfig.actualClassPeriodsPerDay || 8} class periods)\n                     </div>\n                 </div>\n             </div>\n             <div class=\"text-xs text-gray-500 mt-2\">\n                 \u26A0\uFE0F Schedule configuration is managed in Master Schedule. This ensures consistency with routine generation.\n             </div>\n         </div>\n\n         <!-- Classes Hierarchy (Read-only) -->\n         <div class=\"space-y-4\">\n             ${classesTabContent.length > 0 ? classesTabContent : `\n                 <div class=\"bg-white border border-gray-200 rounded-lg p-8 text-center\">\n                     <p class=\"text-gray-400\">No classes found</p>\n                 </div>\n             `}\n         </div>\n      </div>\n    `;\n}\n", "// src/ui/institute/subjects.js - NEW STRUCTURE: Subject Bank + Class Curriculum\n\nexport function SubjectsPageHTML(school, subjects = [], classes = [], groups = [], sections = [], classSubjects = [], groupSubjects = [], scheduleConfig = {}) {\n    \n    // Group data for easier access\n    const classGroups = {};\n    groups.forEach(g => {\n        if (!classGroups[g.class_id]) classGroups[g.class_id] = [];\n        classGroups[g.class_id].push(g);\n    });\n    \n    const classSections = {};\n    sections.forEach(s => {\n        if (!classSections[s.class_id]) classSections[s.class_id] = [];\n        classSections[s.class_id].push(s);\n    });\n\n    // Group subjects by class and group\n    const subjectsByClass = {};\n    classSubjects.forEach(cs => {\n        if (!subjectsByClass[cs.class_id]) subjectsByClass[cs.class_id] = [];\n        subjectsByClass[cs.class_id].push(cs);\n    });\n\n    const subjectsByGroup = {};\n    groupSubjects.forEach(gs => {\n        if (!subjectsByGroup[gs.group_id]) subjectsByGroup[gs.group_id] = [];\n        subjectsByGroup[gs.group_id].push(gs);\n    });\n\n    // Calculate capacity for each section based on master schedule\n    const maxClassesPerSection = scheduleConfig.maxClassesPerSection || 40;\n    \n    function calculateSectionCapacity(classId, groupId) {\n        let totalClasses = 0;\n        \n        // Add class-level subjects\n        const classSubjects = subjectsByClass[classId] || [];\n        totalClasses += classSubjects.reduce((sum, s) => sum + (s.classes_per_week || 0), 0);\n        \n        // Add group-level subjects\n        if (groupId) {\n            const groupSubjects = subjectsByGroup[groupId] || [];\n            totalClasses += groupSubjects.reduce((sum, s) => sum + (s.classes_per_week || 0), 0);\n        }\n        \n        return {\n            current: totalClasses,\n            max: maxClassesPerSection,\n            available: maxClassesPerSection - totalClasses,\n            percentage: Math.round((totalClasses / maxClassesPerSection) * 100)\n        };\n    }\n\n    // Build Subject Bank Tab Content\n    const subjectBankContent = `\n        <div class=\"bg-white rounded-lg border border-gray-200\">\n            <div class=\"p-4 border-b border-gray-100\">\n                <h3 class=\"text-lg font-bold text-gray-800 mb-4\">Subject Bank</h3>\n                <div class=\"flex gap-2\">\n                    <input type=\"text\" id=\"new-subject\" placeholder=\"New Subject Name...\" \n                           class=\"flex-1 border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none\">\n                    <button onclick=\"createSubject()\" class=\"bg-gray-900 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-black\">\n                        + Add Subject\n                    </button>\n                </div>\n            </div>\n            <div class=\"p-4\">\n                <div class=\"space-y-2\">\n                    ${subjects.map((sub, index) => `\n                        <div class=\"flex items-center justify-between p-3 hover:bg-gray-50 rounded-lg border border-transparent hover:border-gray-100 transition-all\">\n                            <div class=\"flex items-center gap-3 flex-1\">\n                                <span class=\"text-sm font-mono text-gray-400 w-6\">${index + 1}.</span>\n                                <span id=\"name-${sub.id}\" class=\"text-sm font-medium text-gray-700\">${sub.subject_name}</span>\n                                <form id=\"form-${sub.id}\" onsubmit=\"updateSubject(event, ${sub.id})\" class=\"hidden flex-1 flex gap-2\">\n                                    <input type=\"text\" name=\"name\" value=\"${sub.subject_name}\" class=\"w-full text-sm border rounded px-2 py-1\">\n                                    <button type=\"submit\" class=\"text-green-600 text-xs font-bold\">Save</button>\n                                    <button type=\"button\" onclick=\"toggleEdit(${sub.id})\" class=\"text-gray-400 text-xs\">Cancel</button>\n                                </form>\n                            </div>\n                            <div class=\"flex items-center gap-1\">\n                                <button onclick=\"toggleEdit(${sub.id})\" class=\"p-2 text-gray-400 hover:text-blue-600\">\n                                    <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\"></path></svg>\n                                </button>\n                                <button onclick=\"deleteSubject(${sub.id})\" class=\"p-2 text-gray-400 hover:text-red-600\">\n                                    <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\"></path></svg>\n                                </button>\n                            </div>\n                        </div>\n                    `).join('')}\n                    ${subjects.length === 0 ? '<div class=\"p-8 text-center text-gray-400 text-sm italic\">No subjects added yet.</div>' : ''}\n                </div>\n            </div>\n        </div>\n    `;\n\n    // Build Class Curriculum Tab Content\n    const classCurriculumContent = classes.map(cls => {\n        const groups = classGroups[cls.id] || [];\n        const classSubjects = subjectsByClass[cls.id] || [];\n        \n        return `\n            <div class=\"mb-6 border border-gray-300\">\n                <div class=\"bg-gray-100 px-3 py-2 border-b\">\n                    <div class=\"flex flex-col md:flex-row md:items-center md:justify-between gap-2\">\n                        <span class=\"font-bold text-sm md:text-base\">${cls.class_name}</span>\n                        <button onclick=\"openAddClassSubjectModal(${cls.id}, '${cls.class_name}')\" class=\"text-xs bg-blue-600 text-white px-2 py-1 hover-lift\">\n                            + Add Class Subject\n                        </button>\n                    </div>\n                </div>\n                \n                <!-- Class-Level Subjects -->\n                <div class=\"p-3\">\n                    <div class=\"mb-3\">\n                        <h4 class=\"text-sm font-semibold text-gray-700 mb-2\">\uD83D\uDCDA Common Subjects (All Groups)</h4>\n                        ${classSubjects.length > 0 ? `\n                            <div class=\"space-y-2\">\n                                ${classSubjects.map(cs => `\n                                    <div class=\"flex flex-col md:flex-row md:items-center md:justify-between bg-blue-50 p-2 rounded subject-item\">\n                                        <div class=\"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3\">\n                                            <span class=\"font-medium text-sm\">${cs.subject_name}</span>\n                                            <div class=\"flex flex-wrap gap-2 text-xs\">\n                                                <span class=\"text-gray-600\">${cs.classes_per_week} classes/week</span>\n                                                <span class=\"text-gray-500\">min: ${cs.min_classes}, max: ${cs.max_classes}</span>\n                                            </div>\n                                        </div>\n                                        <button onclick=\"deleteClassSubject(${cs.id})\" class=\"text-xs text-red-600 self-end sm:self-auto\">Remove</button>\n                                    </div>\n                                `).join('')}\n                            </div>\n                        ` : '<p class=\"text-sm text-gray-400\">No common subjects added</p>'}\n                    </div>\n                    \n                    <!-- Group-Level Subjects -->\n                    ${groups.map(g => {\n                        const groupSubjects = subjectsByGroup[g.id] || [];\n                        const capacity = calculateSectionCapacity(cls.id, g.id);\n                        \n                        return `\n                            <div class=\"mb-3 border-l-2 border-purple-300 pl-3\">\n                                <div class=\"flex flex-col md:flex-row md:items-center md:justify-between mb-2\">\n                                    <div class=\"flex flex-col sm:flex-row sm:items-center gap-2\">\n                                        <h4 class=\"text-sm font-semibold text-gray-700\">\uD83C\uDFAF ${g.group_name} Group</h4>\n                                        <span class=\"text-xs text-gray-500\">(${classSections[g.class_id]?.filter(s => s.group_id === g.id).length || 0} sections)</span>\n                                        <div class=\"text-xs px-2 py-1 rounded capacity-indicator ${capacity.percentage >= 90 ? 'bg-red-100 text-red-700' : capacity.percentage >= 70 ? 'bg-yellow-100 text-yellow-700' : 'bg-green-100 text-green-700'}\">\n                                            ${capacity.current}/${capacity.max} classes\n                                        </div>\n                                    </div>\n                                    <button onclick=\"openAddGroupSubjectModal(${g.id}, '${g.group_name}', ${cls.id}, '${cls.class_name}')\" class=\"text-xs bg-purple-600 text-white px-2 py-1\">\n                                        + Add Subject\n                                    </button>\n                                </div>\n                                ${groupSubjects.length > 0 ? `\n                                    <div class=\"space-y-2\">\n                                        ${groupSubjects.map(gs => `\n                                            <div class=\"flex flex-col md:flex-row md:items-center md:justify-between bg-purple-50 p-2 rounded subject-item\">\n                                                <div class=\"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3\">\n                                                    <span class=\"font-medium text-sm\">${gs.subject_name}</span>\n                                                    <div class=\"flex flex-wrap gap-2 text-xs\">\n                                                        <span class=\"text-gray-600\">${gs.classes_per_week} classes/week</span>\n                                                        <span class=\"text-gray-500\">min: ${gs.min_classes}, max: ${gs.max_classes}</span>\n                                                    </div>\n                                                </div>\n                                                <button onclick=\"deleteGroupSubject(${gs.id})\" class=\"text-xs text-red-600 self-end sm:self-auto\">Remove</button>\n                                            </div>\n                                        `).join('')}\n                                    </div>\n                                ` : '<p class=\"text-sm text-gray-400\">No subjects added to this group</p>'}\n                            </div>\n                        `;\n                    }).join('')}\n                </div>\n            </div>\n        `;\n    }).join('');\n\n    return `\n      <style>\n        /* Enhanced animations and transitions */\n        .btn-primary {\n          transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n          transform: translateY(0);\n        }\n        .btn-primary:hover {\n          transform: translateY(-1px);\n          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n        }\n        .btn-primary:active {\n          transform: translateY(0);\n          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n        }\n        \n        /* Tab styling */\n        .tab-button {\n          transition: all 0.2s ease;\n        }\n        .tab-button.active {\n          border-bottom: 2px solid #3b82f6;\n          color: #3b82f6;\n        }\n        \n        /* Mobile responsive design */\n        @media (max-width: 768px) {\n          .tab-button {\n            font-size: 12px;\n            padding: 8px 4px;\n          }\n          \n          .capacity-indicator {\n            font-size: 10px;\n            padding: 2px 4px;\n          }\n          \n          .subject-item {\n            flex-direction: column;\n            align-items: flex-start;\n            gap: 8px;\n          }\n          \n          .subject-item button {\n            align-self: flex-end;\n          }\n          \n          .modal-content {\n            margin: 16px;\n            max-width: calc(100vw - 32px);\n          }\n          \n          .form-grid {\n            grid-template-columns: 1fr !important;\n          }\n        }\n        \n        /* Prevent zoom on input focus */\n        input, select, textarea {\n          font-size: 16px !important;\n        }\n      </style>\n      \n      <div>\n         <div class=\"flex items-center gap-2 text-sm text-gray-500 mb-6\">\n            <a href=\"/school/dashboard\" class=\"hover:text-blue-600\">Back to Dashboard</a>\n            <span>/</span>\n            <span class=\"text-gray-900 font-bold\">Subjects Management</span>\n         </div>\n\n         <!-- Master Schedule Information (Read-only) -->\n         <div class=\"mb-6 bg-gray-50 p-4 border border-gray-300\">\n             <div class=\"flex flex-col md:flex-row md:items-center md:justify-between gap-4\">\n                 <div class=\"flex flex-col md:flex-row md:items-center gap-4\">\n                     <span class=\"font-semibold text-sm md:text-base\">\uD83D\uDCC5 Master Schedule Configuration</span>\n                     <div class=\"flex flex-col sm:flex-row sm:items-center gap-2\">\n                         <span class=\"text-sm\">Working Days: <strong>${scheduleConfig.workingDaysCount || 5}</strong></span>\n                         <span class=\"text-sm\">Class Periods/Day: <strong>${scheduleConfig.actualClassPeriodsPerDay || 8}</strong></span>\n                     </div>\n                 </div>\n                 <div class=\"text-sm text-gray-600\">\n                     <strong>Total Capacity:</strong> ${maxClassesPerSection} classes/week per section\n                     <div class=\"text-xs text-gray-500 mt-1\">\n                         (Calculated from master schedule: ${scheduleConfig.workingDaysCount || 5} days \u00D7 ${scheduleConfig.actualClassPeriodsPerDay || 8} class periods)\n                     </div>\n                 </div>\n             </div>\n             <div class=\"text-xs text-gray-500 mt-2\">\n                 \u26A0\uFE0F Schedule configuration is managed in Master Schedule. This ensures consistency with routine generation.\n             </div>\n         </div>\n\n         <!-- Tab Navigation -->\n         <div class=\"border-b border-gray-300 mb-4\">\n             <div class=\"flex space-x-6\">\n                 <button onclick=\"switchTab('bank')\" id=\"bank-tab\" class=\"tab-button active pb-2 px-1 text-sm font-medium\">\n                     \uD83D\uDCDA Subject Bank\n                 </button>\n                 <button onclick=\"switchTab('curriculum')\" id=\"curriculum-tab\" class=\"tab-button pb-2 px-1 text-sm font-medium text-gray-500\">\n                     \uD83C\uDFAF Class Curriculum\n                 </button>\n             </div>\n         </div>\n\n         <!-- Tab Content -->\n         <div id=\"bank-content\" class=\"tab-content\">\n             ${subjectBankContent}\n         </div>\n\n         <div id=\"curriculum-content\" class=\"tab-content hidden\">\n             <div class=\"space-y-4\">\n                 ${classCurriculumContent.length > 0 ? classCurriculumContent : `\n                     <div class=\"bg-white border border-gray-200 rounded-lg p-8 text-center\">\n                         <p class=\"text-gray-400\">No classes found</p>\n                     </div>\n                 `}\n             </div>\n         </div>\n      </div>\n\n      <!-- Add Class Subject Modal -->\n      <div id=\"addClassSubjectModal\" class=\"fixed inset-0 bg-black/60 z-[9999] hidden flex items-center justify-center px-4\">\n          <div class=\"bg-white border border-gray-300 w-full max-w-md p-4 relative modal-content\">\n              <h3 class=\"font-bold mb-3 text-sm md:text-base\">Add Subject to Class</h3>\n              <form onsubmit=\"addClassSubject(event)\">\n                  <input type=\"hidden\" name=\"class_id\" id=\"class_subject_class_id\">\n                  <div class=\"mb-3\">\n                      <select name=\"subject_id\" required class=\"w-full border border-gray-300 px-2 py-2 text-sm\">\n                          <option value=\"\">Select Subject</option>\n                          ${subjects.map(s => `<option value=\"${s.id}\">${s.subject_name}</option>`).join('')}\n                      </select>\n                  </div>\n                  <div class=\"grid grid-cols-2 gap-2 mb-3 form-grid\">\n                      <div>\n                          <label class=\"text-xs text-gray-600 block mb-1\">Classes/Week</label>\n                          <input type=\"number\" name=\"classes_per_week\" required min=\"1\" max=\"20\" class=\"w-full border border-gray-300 px-2 py-2 text-sm\">\n                      </div>\n                      <div>\n                          <label class=\"text-xs text-gray-600 block mb-1\">Min Classes</label>\n                          <input type=\"number\" name=\"min_classes\" required min=\"1\" max=\"20\" class=\"w-full border border-gray-300 px-2 py-2 text-sm\">\n                      </div>\n                  </div>\n                  <div class=\"mb-3\">\n                      <label class=\"text-xs text-gray-600 block mb-1\">Max Classes</label>\n                      <input type=\"number\" name=\"max_classes\" required min=\"1\" max=\"20\" class=\"w-full border border-gray-300 px-2 py-2 text-sm\">\n                  </div>\n                  <div class=\"flex flex-col sm:flex-row gap-2\">\n                      <button type=\"submit\" class=\"bg-blue-600 text-white px-3 py-2 text-sm\" id=\"addClassSubjectBtn\">Add Subject</button>\n                      <button type=\"button\" onclick=\"closeModal('addClassSubjectModal')\" class=\"bg-gray-200 text-gray-800 px-3 py-2 text-sm\">Cancel</button>\n                  </div>\n              </form>\n          </div>\n      </div>\n\n      <!-- Add Group Subject Modal -->\n      <div id=\"addGroupSubjectModal\" class=\"fixed inset-0 bg-black/60 z-[9999] hidden flex items-center justify-center px-4\">\n          <div class=\"bg-white border border-gray-300 w-full max-w-md p-4 relative modal-content\">\n              <h3 class=\"font-bold mb-3 text-sm md:text-base\">Add Subject to Group</h3>\n              <form onsubmit=\"addGroupSubject(event)\">\n                  <input type=\"hidden\" name=\"group_id\" id=\"group_subject_group_id\">\n                  <input type=\"hidden\" name=\"class_id\" id=\"group_subject_class_id\">\n                  <div class=\"mb-3\">\n                      <select name=\"subject_id\" required class=\"w-full border border-gray-300 px-2 py-2 text-sm\">\n                          <option value=\"\">Select Subject</option>\n                          ${subjects.map(s => `<option value=\"${s.id}\">${s.subject_name}</option>`).join('')}\n                      </select>\n                  </div>\n                  <div class=\"grid grid-cols-2 gap-2 mb-3 form-grid\">\n                      <div>\n                          <label class=\"text-xs text-gray-600 block mb-1\">Classes/Week</label>\n                          <input type=\"number\" name=\"classes_per_week\" required min=\"1\" max=\"20\" class=\"w-full border border-gray-300 px-2 py-2 text-sm\">\n                      </div>\n                      <div>\n                          <label class=\"text-xs text-gray-600 block mb-1\">Min Classes</label>\n                          <input type=\"number\" name=\"min_classes\" required min=\"1\" max=\"20\" class=\"w-full border border-gray-300 px-2 py-2 text-sm\">\n                      </div>\n                  </div>\n                  <div class=\"mb-3\">\n                      <label class=\"text-xs text-gray-600 block mb-1\">Max Classes</label>\n                      <input type=\"number\" name=\"max_classes\" required min=\"1\" max=\"20\" class=\"w-full border border-gray-300 px-2 py-2 text-sm\">\n                  </div>\n                  <div class=\"flex flex-col sm:flex-row gap-2\">\n                      <button type=\"submit\" class=\"bg-purple-600 text-white px-3 py-2 text-sm\" id=\"addGroupSubjectBtn\">Add Subject</button>\n                      <button type=\"button\" onclick=\"closeModal('addGroupSubjectModal')\" class=\"bg-gray-200 text-gray-800 px-3 py-2 text-sm\">Cancel</button>\n                  </div>\n              </form>\n          </div>\n      </div>\n\n      <script>\n        const SCHOOL_ID = ${school.id};\n        const MAX_CLASSES_PER_SECTION = ${maxClassesPerSection};\n\n        // Tab switching\n        function switchTab(tabName) {\n            // Hide all content\n            document.querySelectorAll('.tab-content').forEach(content => {\n                content.classList.add('hidden');\n            });\n            \n            // Remove active class from all tabs\n            document.querySelectorAll('.tab-button').forEach(tab => {\n                tab.classList.remove('active');\n                tab.classList.add('text-gray-500');\n            });\n            \n            // Show selected content\n            document.getElementById(tabName + '-content').classList.remove('hidden');\n            \n            // Add active class to selected tab\n            const activeTab = document.getElementById(tabName + '-tab');\n            activeTab.classList.add('active');\n            activeTab.classList.remove('text-gray-500');\n        }\n\n        // Subject Bank functions\n        function createSubject() {\n            const input = document.getElementById('new-subject');\n            const name = input.value.trim();\n            if (!name) return;\n            \n            fetch('/school/subjects', {\n                method: 'POST',\n                headers: {'Content-Type': 'application/json'},\n                body: JSON.stringify({action: 'create', name: name})\n            }).then(res => res.json()).then(response => {\n                if(response.success) {\n                    window.location.reload();\n                }\n            });\n        }\n\n        function toggleEdit(id) {\n            document.getElementById('name-'+id).classList.toggle('hidden');\n            document.getElementById('form-'+id).classList.toggle('hidden');\n        }\n\n        function updateSubject(e, id) {\n            e.preventDefault();\n            const formData = new FormData(e.target);\n            const name = formData.get('name');\n            \n            fetch('/school/subjects', {\n                method: 'POST',\n                headers: {'Content-Type': 'application/json'},\n                body: JSON.stringify({action: 'rename', id: id, name: name})\n            }).then(res => res.json()).then(response => {\n                if(response.success) {\n                    window.location.reload();\n                }\n            });\n        }\n\n        function deleteSubject(id) {\n            if(!confirm(\"Delete this subject?\")) return;\n            \n            fetch('/school/subjects', {\n                method: 'DELETE',\n                headers: {'Content-Type': 'application/json'},\n                body: JSON.stringify({type: 'bank', id: id})\n            }).then(res => res.json()).then(response => {\n                if(response.success) {\n                    window.location.reload();\n                }\n            });\n        }\n\n        // Curriculum functions\n        function openAddClassSubjectModal(classId, className) {\n            document.getElementById('class_subject_class_id').value = classId;\n            openModal('addClassSubjectModal');\n            setTimeout(() => {\n                document.querySelector('#addClassSubjectModal select[name=\"subject_id\"]').focus();\n            }, 100);\n        }\n\n        function openAddGroupSubjectModal(groupId, groupName, classId, className) {\n            document.getElementById('group_subject_group_id').value = groupId;\n            document.getElementById('group_subject_class_id').value = classId;\n            openModal('addGroupSubjectModal');\n            setTimeout(() => {\n                document.querySelector('#addGroupSubjectModal select[name=\"subject_id\"]').focus();\n            }, 100);\n        }\n\n        function addClassSubject(e) {\n            e.preventDefault();\n            const submitBtn = document.getElementById('addClassSubjectBtn');\n            if (submitBtn.disabled) return;\n            \n            submitBtn.disabled = true;\n            submitBtn.textContent = 'Adding...';\n            \n            const formData = new FormData(e.target);\n            const data = Object.fromEntries(formData.entries());\n            data.action = 'add_class_subject';\n            data.school_id = SCHOOL_ID;\n\n            fetch('/school/subjects', {\n                method: 'POST',\n                headers: {'Content-Type': 'application/json'},\n                body: JSON.stringify(data)\n            }).then(res => res.json()).then(response => {\n                if(response.success) {\n                    window.location.reload();\n                } else {\n                    alert('Error adding subject: ' + (response.error || 'Unknown error'));\n                    submitBtn.disabled = false;\n                    submitBtn.textContent = 'Add Subject';\n                }\n            });\n        }\n\n        function addGroupSubject(e) {\n            e.preventDefault();\n            const submitBtn = document.getElementById('addGroupSubjectBtn');\n            if (submitBtn.disabled) return;\n            \n            submitBtn.disabled = true;\n            submitBtn.textContent = 'Adding...';\n            \n            const formData = new FormData(e.target);\n            const data = Object.fromEntries(formData.entries());\n            data.action = 'add_group_subject';\n            data.school_id = SCHOOL_ID;\n\n            fetch('/school/subjects', {\n                method: 'POST',\n                headers: {'Content-Type': 'application/json'},\n                body: JSON.stringify(data)\n            }).then(res => res.json()).then(response => {\n                if(response.success) {\n                    window.location.reload();\n                } else {\n                    alert('Error adding subject: ' + (response.error || 'Unknown error'));\n                    submitBtn.disabled = false;\n                    submitBtn.textContent = 'Add Subject';\n                }\n            });\n        }\n\n        function deleteClassSubject(id) {\n            if(!confirm(\"Remove this subject from class?\")) return;\n            \n            fetch('/school/subjects', {\n                method: 'DELETE',\n                headers: {'Content-Type': 'application/json'},\n                body: JSON.stringify({action: 'delete_class_subject', id: id})\n            }).then(res => res.json()).then(response => {\n                if(response.success) {\n                    window.location.reload();\n                }\n            });\n        }\n\n        function deleteGroupSubject(id) {\n            if(!confirm(\"Remove this subject from group?\")) return;\n            \n            fetch('/school/subjects', {\n                method: 'DELETE',\n                headers: {'Content-Type': 'application/json'},\n                body: JSON.stringify({action: 'delete_group_subject', id: id})\n            }).then(res => res.json()).then(response => {\n                if(response.success) {\n                    window.location.reload();\n                }\n            });\n        }\n\n        // Modal management\n        function openModal(modalId) {\n            document.getElementById(modalId).classList.remove('hidden');\n            document.body.style.overflow = 'hidden';\n        }\n\n        function closeModal(modalId) {\n            document.getElementById(modalId).classList.add('hidden');\n            document.body.style.overflow = '';\n            const modal = document.getElementById(modalId);\n            const submitBtn = modal.querySelector('button[type=\"submit\"]');\n            if (submitBtn) {\n                submitBtn.disabled = false;\n                submitBtn.textContent = 'Add Subject';\n            }\n            modal.querySelector('form').reset();\n        }\n\n        // Close modal on Escape key\n        document.addEventListener('keydown', function(e) {\n            if (e.key === 'Escape') {\n                const modals = document.querySelectorAll('.fixed.inset-0');\n                modals.forEach(modal => {\n                    if (!modal.classList.contains('hidden')) {\n                        closeModal(modal.id);\n                    }\n                });\n            }\n        });\n\n        // Close modal on background click\n        document.addEventListener('click', function(e) {\n            if (e.target.classList.contains('fixed') && e.target.classList.contains('inset-0')) {\n                closeModal(e.target.id);\n            }\n        });\n      </script>\n    `;\n}\n", "export function SchedulesPageHTML(config = null, existingSlots = []) {\r\n    // Sort slots by start time\r\n    existingSlots.sort((a, b) => a.start_time.localeCompare(b.start_time));\r\n    const initialSchoolStart = existingSlots.length > 0 ? existingSlots[0].start_time : (config?.start_time || \"08:00\");\r\n\r\n    return `\r\n      <div class=\"max-w-7xl xl:max-w-8xl mx-auto pb-24 md:pb-10 select-none\" id=\"schedule-app\">\r\n          \r\n          <div class=\"bg-white sticky top-0 z-30 border-b border-gray-200 shadow-sm\">\r\n              <div class=\"flex justify-between items-center px-4 py-3 md:px-6 md:py-4\">\r\n                  <div>\r\n                    <h2 class=\"text-lg md:text-2xl font-bold text-gray-900\">Master Schedule</h2>\r\n                    <p class=\"text-sm md:text-base text-gray-500 mt-1\">Configure your school's daily routine</p>\r\n                  </div>\r\n                  <div class=\"flex gap-3 md:gap-4\">\r\n                       <button onclick=\"app.save()\" class=\"bg-black text-white px-4 py-2.5 md:px-6 md:py-3 rounded-lg text-sm md:text-base font-bold active:scale-95 transition-transform\">Save</button>\r\n                       <button onclick=\"app.reset()\" class=\"text-red-600 bg-red-50 px-4 py-2.5 md:px-5 md:py-3 rounded-lg text-sm md:text-base font-bold\">Reset</button>\r\n                  </div>\r\n              </div>\r\n          </div>\r\n\r\n          <div class=\"mx-4 md:mx-6 mt-4 md:mt-4 p-4 md:p-4 bg-blue-50 border border-blue-100 rounded-lg\">\r\n              <div class=\"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6\">\r\n                  <div class=\"flex items-center gap-4\">\r\n                      <span class=\"text-sm md:text-base font-bold text-blue-800 uppercase tracking-wide\">Day Starts At:</span>\r\n                      <input type=\"time\" id=\"school_start_time\" value=\"${initialSchoolStart}\" onchange=\"app.updateStartTime(this.value)\" \r\n                             class=\"bg-white border border-blue-200 text-blue-900 text-sm md:text-base font-bold rounded-lg px-4 py-2.5 md:px-4 md:py-2.5 outline-none w-24 md:w-28 text-center focus:ring-2 focus:ring-blue-500\">\r\n                  </div>\r\n                  <div class=\"flex-1\">\r\n                      <div class=\"text-sm md:text-base font-bold text-blue-800 uppercase tracking-wide mb-3\">Working Days:</div>\r\n                      <div class=\"grid grid-cols-7 gap-2\" id=\"weekday-selector\">\r\n                          <div class=\"text-center\">\r\n                              <label class=\"flex flex-col items-center gap-1 cursor-pointer\">\r\n                                  <input type=\"checkbox\" name=\"weekday\" value=\"monday\" class=\"w-4 h-4 text-blue-600 rounded focus:ring-blue-500\">\r\n                                  <span class=\"text-xs font-medium text-gray-700\">Mon</span>\r\n                              </label>\r\n                          </div>\r\n                          <div class=\"text-center\">\r\n                              <label class=\"flex flex-col items-center gap-1 cursor-pointer\">\r\n                                  <input type=\"checkbox\" name=\"weekday\" value=\"tuesday\" class=\"w-4 h-4 text-blue-600 rounded focus:ring-blue-500\">\r\n                                  <span class=\"text-xs font-medium text-gray-700\">Tue</span>\r\n                              </label>\r\n                          </div>\r\n                          <div class=\"text-center\">\r\n                              <label class=\"flex flex-col items-center gap-1 cursor-pointer\">\r\n                                  <input type=\"checkbox\" name=\"weekday\" value=\"wednesday\" class=\"w-4 h-4 text-blue-600 rounded focus:ring-blue-500\">\r\n                                  <span class=\"text-xs font-medium text-gray-700\">Wed</span>\r\n                              </label>\r\n                          </div>\r\n                          <div class=\"text-center\">\r\n                              <label class=\"flex flex-col items-center gap-1 cursor-pointer\">\r\n                                  <input type=\"checkbox\" name=\"weekday\" value=\"thursday\" class=\"w-4 h-4 text-blue-600 rounded focus:ring-blue-500\">\r\n                                  <span class=\"text-xs font-medium text-gray-700\">Thu</span>\r\n                              </label>\r\n                          </div>\r\n                          <div class=\"text-center\">\r\n                              <label class=\"flex flex-col items-center gap-1 cursor-pointer\">\r\n                                  <input type=\"checkbox\" name=\"weekday\" value=\"friday\" class=\"w-4 h-4 text-blue-600 rounded focus:ring-blue-500\">\r\n                                  <span class=\"text-xs font-medium text-gray-700\">Fri</span>\r\n                              </label>\r\n                          </div>\r\n                          <div class=\"text-center\">\r\n                              <label class=\"flex flex-col items-center gap-1 cursor-pointer\">\r\n                                  <input type=\"checkbox\" name=\"weekday\" value=\"saturday\" class=\"w-4 h-4 text-blue-600 rounded focus:ring-blue-500\">\r\n                                  <span class=\"text-xs font-medium text-gray-700\">Sat</span>\r\n                              </label>\r\n                          </div>\r\n                          <div class=\"text-center\">\r\n                              <label class=\"flex flex-col items-center gap-1 cursor-pointer\">\r\n                                  <input type=\"checkbox\" name=\"weekday\" value=\"sunday\" class=\"w-4 h-4 text-blue-600 rounded focus:ring-blue-500\">\r\n                                  <span class=\"text-xs font-medium text-gray-700\">Sun</span>\r\n                              </label>\r\n                          </div>\r\n                      </div>\r\n                      <div class=\"mt-2 text-xs text-gray-600\">\r\n                        <span id=\"working-days-count\">5</span> working days selected\r\n                      </div>\r\n                  </div>\r\n              </div>\r\n          </div>\r\n\r\n          <div class=\"mt-4 md:mt-4 bg-white border-t border-b border-gray-200 md:border md:rounded-lg md:mx-6 md:shadow-md overflow-hidden\">\r\n              \r\n              <div class=\"hidden lg:grid grid-cols-12 gap-3 md:gap-4 p-4 md:p-5 bg-gray-100 text-sm md:text-base uppercase font-bold text-gray-500 border-b border-gray-200\">\r\n                  <div class=\"col-span-1 text-center\">#</div>\r\n                  <div class=\"col-span-2\">Start</div>\r\n                  <div class=\"col-span-2\">End</div>\r\n                  <div class=\"col-span-1\">Mins</div>\r\n                  <div class=\"col-span-4\">Label</div>\r\n                  <div class=\"col-span-1\">Type</div>\r\n                  <div class=\"col-span-1\"></div>\r\n              </div>\r\n\r\n              <div id=\"slot-container\" class=\"divide-y divide-gray-100\"></div>\r\n\r\n              <button id=\"add-btn\" onclick=\"app.addPeriod()\" class=\"w-full py-4 md:py-4 text-center text-blue-600 font-bold text-base md:text-lg hover:bg-gray-50 active:bg-blue-50 transition-colors\">\r\n                  + Add Next Period\r\n              </button>\r\n          </div>\r\n      </div>\r\n\r\n      <div id=\"tutorial-popup\" class=\"fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center px-4 backdrop-blur-sm\">\r\n          <div class=\"bg-white rounded-lg shadow-xl w-full max-w-xs p-5 transform transition-all scale-100\">\r\n              <h3 class=\"text-sm font-bold text-gray-900 mb-2\">\u26A0\uFE0F Cannot Change Start Time</h3>\r\n              <p class=\"text-xs text-gray-600 mb-4 leading-relaxed\">\r\n                  This period starts automatically when the previous one ends.<br>\r\n                  To change this time, adjust the <b>Duration</b> or <b>End Time</b> of the <u>previous period</u>.\r\n              </p>\r\n              <button onclick=\"document.getElementById('tutorial-popup').classList.add('hidden')\" class=\"w-full bg-gray-900 text-white py-2 rounded text-xs font-bold\">Okay, Got it</button>\r\n          </div>\r\n      </div>\r\n\r\n      <script>\r\n        const AppState = {\r\n            slots: ${JSON.stringify(existingSlots)},\r\n            startTime: \"${initialSchoolStart}\",\r\n            workingDays: ${config?.working_days ? JSON.stringify(config.working_days) : '[\"monday\",\"tuesday\",\"wednesday\",\"thursday\",\"friday\"]'}\r\n        };\r\n\r\n        // --- HELPER FUNCTIONS ---\r\n        const Time = {\r\n            add: (time, mins) => {\r\n                if(!time) return \"00:00\";\r\n                let [h, m] = time.split(':').map(Number);\r\n                let date = new Date(2000, 0, 1, h, m);\r\n                date.setMinutes(date.getMinutes() + (parseInt(mins) || 0));\r\n                return date.getHours().toString().padStart(2, '0') + ':' + date.getMinutes().toString().padStart(2, '0');\r\n            },\r\n            diff: (start, end) => {\r\n                let [h1, m1] = start.split(':').map(Number);\r\n                let [h2, m2] = end.split(':').map(Number);\r\n                return Math.round((new Date(2000, 0, 1, h2, m2) - new Date(2000, 0, 1, h1, m1)) / 60000);\r\n            }\r\n        };\r\n\r\n        const app = {\r\n            init: function() {\r\n                if(AppState.slots.length === 0) this.addPeriod(false);\r\n                this.recalculateChain(); \r\n                this.render();\r\n                // Set working days checkboxes\r\n                this.setWorkingDaysCheckboxes();\r\n                this.updateWorkingDaysCount();\r\n            },\r\n\r\n            setWorkingDaysCheckboxes: function() {\r\n                const checkboxes = document.querySelectorAll('input[name=\"weekday\"]');\r\n                checkboxes.forEach(checkbox => {\r\n                    checkbox.checked = AppState.workingDays.includes(checkbox.value);\r\n                });\r\n                \r\n                // Add event listeners\r\n                checkboxes.forEach(checkbox => {\r\n                    checkbox.addEventListener('change', () => {\r\n                        this.updateWorkingDays();\r\n                        this.updateWorkingDaysCount();\r\n                    });\r\n                });\r\n            },\r\n\r\n            updateWorkingDays: function() {\r\n                const checkboxes = document.querySelectorAll('input[name=\"weekday\"]:checked');\r\n                AppState.workingDays = Array.from(checkboxes).map(cb => cb.value);\r\n            },\r\n\r\n            updateWorkingDaysCount: function() {\r\n                const count = document.querySelectorAll('input[name=\"weekday\"]:checked').length;\r\n                document.getElementById('working-days-count').textContent = count;\r\n            },\r\n\r\n            updateStartTime: function(val) {\r\n                AppState.startTime = val;\r\n                this.recalculateChain();\r\n                this.render();\r\n            },\r\n\r\n            addPeriod: function(render = true) {\r\n                AppState.slots.push({\r\n                    id: Date.now(),\r\n                    label: \"\",\r\n                    duration: 40,\r\n                    type: 'class'\r\n                });\r\n                this.recalculateChain();\r\n                if(render) this.render();\r\n            },\r\n\r\n            removePeriod: function(index) {\r\n                if(AppState.slots.length <= 1) return;\r\n                AppState.slots.splice(index, 1);\r\n                this.recalculateChain();\r\n                this.render();\r\n            },\r\n\r\n            // --- CORE LOGIC ---\r\n            handleInput: function(index, field, value) {\r\n                const slot = AppState.slots[index];\r\n\r\n                if(field === 'start_time') {\r\n                    if(index === 0) { this.updateStartTime(value); return; }\r\n                    else {\r\n                        // REVERT & SHOW WARNING\r\n                        document.getElementById('tutorial-popup').classList.remove('hidden');\r\n                        this.render(); // Re-render to revert visually\r\n                        return;\r\n                    }\r\n                }\r\n\r\n                if (field === 'duration') {\r\n                    let mins = parseInt(value) || 0;\r\n                    if(mins < 5) mins = 5; \r\n                    slot.duration = mins;\r\n                } \r\n                else if (field === 'end_time') {\r\n                    const newDiff = Time.diff(slot.start_time, value);\r\n                    if (newDiff > 0) slot.duration = newDiff;\r\n                    else { alert(\"End time must be after start time\"); this.render(); return; }\r\n                }\r\n                else {\r\n                    slot[field] = value;\r\n                }\r\n\r\n                this.recalculateChain();\r\n                this.render();\r\n            },\r\n\r\n            recalculateChain: function() {\r\n                let current = AppState.startTime;\r\n                AppState.slots.forEach(slot => {\r\n                    slot.start_time = current;\r\n                    slot.end_time = Time.add(current, slot.duration);\r\n                    current = slot.end_time; \r\n                });\r\n            },\r\n\r\n            save: async function() {\r\n                try {\r\n                    await fetch('/school/schedules', {\r\n                        method: 'POST',\r\n                        headers: {'Content-Type': 'application/json'},\r\n                        body: JSON.stringify({ \r\n                            action: 'save_schedule', \r\n                            slots: AppState.slots,\r\n                            working_days: AppState.workingDays\r\n                        })\r\n                    });\r\n                    window.location.reload();\r\n                } catch(e) { alert(\"Save failed\"); }\r\n            },\r\n\r\n            reset: async function() {\r\n                if(confirm(\"Reset entire schedule?\")) {\r\n                    await fetch('/school/schedules', { method: 'DELETE' });\r\n                    window.location.reload();\r\n                }\r\n            },\r\n\r\n            // --- RENDER ENGINE ---\r\n            render: function() {\r\n                const container = document.getElementById('slot-container');\r\n                container.innerHTML = AppState.slots.map((slot, i) => this.renderRow(slot, i)).join('');\r\n            },\r\n\r\n            // --- OPTIMIZED ROW DESIGN ---\r\n            renderRow: function(slot, i) {\r\n                const isFirst = i === 0;\r\n                \r\n                return \\`\r\n                <div class=\"group bg-white relative\">\r\n                    <div class=\"hidden lg:grid grid-cols-12 gap-3 md:gap-4 p-4 md:p-5 items-center hover:bg-gray-50\">\r\n                        <div class=\"col-span-1 text-center text-base md:text-lg text-gray-400 font-bold\">\\${i+1}</div>\r\n                        <div class=\"col-span-2\">\r\n                             <input type=\"time\" value=\"\\${slot.start_time}\" onchange=\"app.handleInput(\\${i}, 'start_time', this.value)\" \r\n                             class=\"w-full text-base md:text-lg font-mono font-bold border border-gray-300 rounded-lg px-3 py-2.5 md:px-4 md:py-3 \\${!isFirst ? 'bg-gray-100 text-gray-400 cursor-not-allowed' : 'bg-white text-gray-900'} focus:border-blue-500 focus:ring-2\">\r\n                        </div>\r\n                        <div class=\"col-span-2\">\r\n                             <input type=\"time\" value=\"\\${slot.end_time}\" onchange=\"app.handleInput(\\${i}, 'end_time', this.value)\" class=\"w-full text-base md:text-lg font-mono font-bold border border-gray-300 rounded-lg px-3 py-2.5 md:px-4 md:py-3 bg-white text-gray-900 focus:border-blue-500 focus:ring-2\">\r\n                        </div>\r\n                        <div class=\"col-span-1\">\r\n                             <input type=\"number\" value=\"\\${slot.duration}\" onchange=\"app.handleInput(\\${i}, 'duration', this.value)\" class=\"w-full text-base md:text-lg text-center font-bold bg-blue-50 text-blue-700 rounded-lg px-3 py-2.5 md:px-3 md:py-3 border-none focus:ring-2 focus:ring-blue-500\">\r\n                        </div>\r\n                        <div class=\"col-span-4\">\r\n                             <input type=\"text\" value=\"\\${slot.label}\" onchange=\"app.handleInput(\\${i}, 'label', this.value)\" class=\"w-full text-base md:text-lg border-b-2 border-transparent hover:border-gray-300 focus:border-blue-500 bg-transparent py-2.5 md:py-3 outline-none font-medium placeholder-gray-400\" placeholder=\"Period Name...\">\r\n                        </div>\r\n                        <div class=\"col-span-1\">\r\n                             <select onchange=\"app.handleInput(\\${i}, 'type', this.value)\" class=\"text-sm md:text-base font-bold uppercase bg-transparent outline-none \\${slot.type==='break'?'text-orange-500':'text-blue-600'}\">\r\n                                <option value=\"class\" \\${slot.type==='class'?'selected':''}>Class</option>\r\n                                <option value=\"break\" \\${slot.type==='break'?'selected':''}>Break</option>\r\n                             </select>\r\n                        </div>\r\n                        <div class=\"col-span-1 text-right\">\r\n                             <button onclick=\"app.removePeriod(\\${i})\" class=\"text-gray-300 hover:text-red-500 font-bold text-lg md:text-xl transition-colors p-3 rounded-lg hover:bg-red-50\">&times;</button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div class=\"lg:hidden p-3 border-l-2 \\${slot.type==='break'?'border-orange-300':'border-blue-300'} bg-gray-50\">\r\n                        <div class=\"flex items-center gap-2 mb-2\">\r\n                            <span class=\"text-sm font-bold text-gray-500 w-3\">\\${i+1}</span>\r\n                            \r\n                            <div class=\"flex-1\">\r\n                                <input type=\"time\" value=\"\\${slot.start_time}\" onchange=\"app.handleInput(\\${i}, 'start_time', this.value)\"\r\n                                class=\"w-full text-sm font-mono text-center bg-white border border-gray-200 rounded py-1.5 text-gray-600\">\r\n                            </div>\r\n                            <span class=\"text-gray-400 text-sm mx-1\">\u2192</span>\r\n                            \r\n                            <div class=\"flex-1\">\r\n                                <input type=\"time\" value=\"\\${slot.end_time}\" onchange=\"app.handleInput(\\${i}, 'end_time', this.value)\"\r\n                                class=\"w-full text-sm font-mono font-bold text-center bg-white border border-gray-200 rounded py-1.5 text-gray-900\">\r\n                            </div>\r\n\r\n                            <div class=\"w-12\">\r\n                                <input type=\"number\" value=\"\\${slot.duration}\" onchange=\"app.handleInput(\\${i}, 'duration', this.value)\"\r\n                                class=\"w-full text-sm font-bold text-center bg-blue-50 text-blue-700 rounded py-1.5 border-none\">\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div class=\"flex items-center gap-2\">\r\n                            <input type=\"text\" value=\"\\${slot.label}\" onchange=\"app.handleInput(\\${i}, 'label', this.value)\" \r\n                            class=\"flex-1 text-sm font-medium border-b border-gray-200 focus:border-blue-500 py-1 outline-none bg-white placeholder-gray-400\" placeholder=\"Label...\">\r\n                            \r\n                            <select onchange=\"app.handleInput(\\${i}, 'type', this.value)\" \r\n                            class=\"text-sm font-bold uppercase bg-white border border-gray-200 rounded px-2 py-1 outline-none \\${slot.type==='break'?'text-orange-500':'text-blue-500'}\">\r\n                                <option value=\"class\" \\${slot.type==='class'?'selected':''}>CL</option>\r\n                                <option value=\"break\" \\${slot.type==='break'?'selected':''}>BR</option>\r\n                            </select>\r\n\r\n                            <button onclick=\"app.removePeriod(\\${i})\" class=\"w-6 h-6 flex items-center justify-center text-gray-400 hover:text-red-500 bg-white rounded border border-gray-200\">\r\n                                <span class=\"text-sm leading-none\">&times;</span>\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                \\`;\r\n            }\r\n        };\r\n\r\n        document.addEventListener('DOMContentLoaded', () => app.init());\r\n      </script>\r\n    `;\r\n}\r\n", "import { htmlResponse } from '../core/utils.js';\r\n\r\nexport async function handleTeacherRequest(request, env) {\r\n  return htmlResponse(\"<h1>Teacher Portal Coming Soon</h1>\");\r\n}", "import type { Middleware } from \"./common\";\n\nconst drainBody: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} finally {\n\t\ttry {\n\t\t\tif (request.body !== null && !request.bodyUsed) {\n\t\t\t\tconst reader = request.body.getReader();\n\t\t\t\twhile (!(await reader.read()).done) {}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(\"Failed to drain the unused request body.\", e);\n\t\t}\n\t}\n};\n\nexport default drainBody;\n", "import type { Middleware } from \"./common\";\n\ninterface JsonError {\n\tmessage?: string;\n\tname?: string;\n\tstack?: string;\n\tcause?: JsonError;\n}\n\nfunction reduceError(e: any): JsonError {\n\treturn {\n\t\tname: e?.name,\n\t\tmessage: e?.message ?? String(e),\n\t\tstack: e?.stack,\n\t\tcause: e?.cause === undefined ? undefined : reduceError(e.cause),\n\t};\n}\n\n// See comment in `bundle.ts` for details on why this is needed\nconst jsonError: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} catch (e: any) {\n\t\tconst error = reduceError(e);\n\t\treturn Response.json(error, {\n\t\t\tstatus: 500,\n\t\t\theaders: { \"MF-Experimental-Error-Stack\": \"true\" },\n\t\t});\n\t}\n};\n\nexport default jsonError;\n", "export type Awaitable<T> = T | Promise<T>;\n// TODO: allow dispatching more events?\nexport type Dispatcher = (\n\ttype: \"scheduled\",\n\tinit: { cron?: string }\n) => Awaitable<void>;\n\nexport type IncomingRequest = Request<\n\tunknown,\n\tIncomingRequestCfProperties<unknown>\n>;\n\nexport interface MiddlewareContext {\n\tdispatch: Dispatcher;\n\tnext(request: IncomingRequest, env: any): Awaitable<Response>;\n}\n\nexport type Middleware = (\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tmiddlewareCtx: MiddlewareContext\n) => Awaitable<Response>;\n\nconst __facade_middleware__: Middleware[] = [];\n\n// The register functions allow for the insertion of one or many middleware,\n// We register internal middleware first in the stack, but have no way of controlling\n// the order that addMiddleware is run in service workers so need an internal function.\nexport function __facade_register__(...args: (Middleware | Middleware[])[]) {\n\t__facade_middleware__.push(...args.flat());\n}\nexport function __facade_registerInternal__(\n\t...args: (Middleware | Middleware[])[]\n) {\n\t__facade_middleware__.unshift(...args.flat());\n}\n\nfunction __facade_invokeChain__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tmiddlewareChain: Middleware[]\n): Awaitable<Response> {\n\tconst [head, ...tail] = middlewareChain;\n\tconst middlewareCtx: MiddlewareContext = {\n\t\tdispatch,\n\t\tnext(newRequest, newEnv) {\n\t\t\treturn __facade_invokeChain__(newRequest, newEnv, ctx, dispatch, tail);\n\t\t},\n\t};\n\treturn head(request, env, ctx, middlewareCtx);\n}\n\nexport function __facade_invoke__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tfinalMiddleware: Middleware\n): Awaitable<Response> {\n\treturn __facade_invokeChain__(request, env, ctx, dispatch, [\n\t\t...__facade_middleware__,\n\t\tfinalMiddleware,\n\t]);\n}\n"],
  "mappings": "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AAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4BA0Cc,OAAO,EAAE;AAAA,+BACN,KAAK,UAAU,WAAW,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA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",
  "names": ["HomeHTML", "email", "LOGIN_HTML", "email", "classSubjects", "groupSubjects", "groups", "sections", "classSubjects", "groupSubjects", "groups"]
}
